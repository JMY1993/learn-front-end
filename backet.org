* null undefined åŒºåˆ«
null ç‰¹æ®Šçš„ null å€¼ä¸å±äºä¸Šè¿°ä»»ä½•ä¸€ç§ç±»å‹ï¼Œå®ƒæ„æˆäº†ä¸€ä¸ªç‹¬ç«‹çš„ç±»å‹ï¼ŒåªåŒ…å« null å€¼

undefined ç‰¹æ®Šå€¼ undefined å’Œ null ä¸€æ ·è‡ªæˆç±»å‹ã€‚undefined çš„å«ä¹‰æ˜¯æœªè¢«èµ‹å€¼ã€‚å¦‚æœä¸€ä¸ªå˜é‡å·²è¢«å£°æ˜ï¼Œä½†æœªè¢«èµ‹å€¼ï¼Œé‚£ä¹ˆå®ƒçš„å€¼å°±æ˜¯ undefined
* å¦‚æœæƒ³è¦è·å¾—ä¸€äº›å…³äºæµè§ˆå™¨å’Œå…¶ä»–å¼•æ“çš„å…¼å®¹æ€§ä¿¡æ¯ï¼Œè¯·çœ‹ï¼š

- http://caniuse.com ------ æ¯ä¸ªåŠŸèƒ½éƒ½åˆ—æœ‰ä¸€ä¸ªæ”¯æŒä¿¡æ¯è¡¨æ ¼
  ä¾‹å¦‚æƒ³çœ‹å“ªä¸ªå¼•æ“æ”¯æŒç°ä»£åŠ å¯†ï¼ˆcryptographyï¼‰å‡½æ•°ï¼šhttp://caniuse.com/#feat=cryptographyã€‚
- https://kangax.github.io/compat-table ------ ä¸€ä»½åˆ—æœ‰è¯­è¨€åŠŸèƒ½ä»¥åŠå¼•æ“æ˜¯å¦æ”¯æŒè¿™äº›åŠŸèƒ½çš„è¡¨æ ¼ã€‚

* typeofæ“ä½œç¬¦

typeof xx typeof(xx)

1. typeof null çš„ç»“æœæ˜¯ "object"ã€‚è¿™å…¶å®æ˜¯ä¸å¯¹çš„ã€‚å®˜æ–¹ä¹Ÿæ‰¿è®¤äº†è¿™æ˜¯
   typeof è¿ç®—ç¬¦çš„é—®é¢˜ï¼Œç°åœ¨åªæ˜¯ä¸ºäº†å…¼å®¹æ€§è€Œä¿ç•™äº†ä¸‹æ¥ã€‚å½“ç„¶ï¼Œnull
   ä¸æ˜¯ä¸€ä¸ª objectã€‚null æœ‰è‡ªå·±çš„ç±»å‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªç‰¹æ®Šå€¼ã€‚å†æ¬¡å¼ºè°ƒï¼Œè¿™æ˜¯
   JavaScript è¯­è¨€çš„ä¸€ä¸ªé”™è¯¯ã€‚
2. typeof alert çš„ç»“æœæ˜¯ "function"ï¼Œå› ä¸º alert åœ¨ JavaScript
   è¯­è¨€ä¸­æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚æˆ‘ä»¬ä¼šåœ¨ä¸‹ä¸€ç« å­¦ä¹ å‡½æ•°ï¼Œé‚£æ—¶æˆ‘ä»¬ä¼šäº†è§£åˆ°ï¼Œåœ¨
   JavaScript è¯­è¨€ä¸­æ²¡æœ‰ä¸€ä¸ªç‰¹åˆ«çš„ "function" ç±»å‹ã€‚å‡½æ•°éš¶å±äº object
   ç±»å‹ã€‚ä½†æ˜¯ typeof ä¼šå¯¹å‡½æ•°åŒºåˆ†å¯¹å¾…ã€‚
   è¿™ä¸æ˜¯å¾ˆæ­£ç¡®çš„åšæ³•ï¼Œä½†åœ¨å®é™…ç¼–ç¨‹ä¸­éå¸¸æ–¹ä¾¿ã€‚

* ç±»å‹è½¬æ¢

- String()
- Number()

undefined: NaN //!!! 
null: 0 
true or false: 1 or 0 
string: å»æ‰é¦–å°¾ç©ºæ ¼åçš„çº¯æ•°å­—å­—ç¬¦ä¸²ä¸­å«æœ‰çš„æ•°å­—ã€‚
å¦‚æœå‰©ä½™å­—ç¬¦ä¸²ä¸ºç©ºï¼Œåˆ™è½¬æ¢ç»“æœä¸º0ã€‚
å¦åˆ™ï¼Œå°†ä¼šä»å‰©ä½™å­—ç¬¦ä¸²ä¸­"è¯»å–"æ•°å­—ã€‚å½“ç±»å‹è½¬æ¢å‡ºç° error æ—¶è¿”å›NaNã€‚

#+BEGIN_SRC js
  alert(
  #+begin_quote
  #+end_quote
 Number("   123   ") ); // 123
  alert( Number("123z") );      // NaNï¼ˆä»å­—ç¬¦ä¸²â€œè¯»å–â€æ•°å­—ï¼Œè¯»åˆ° "z" æ—¶å‡ºç°é”™è¯¯ï¼‰
  alert( Number("1 03") );      // NaN
  alert( Number(true) );        // 1
  alert( Number(false) );       // 0
#+END_SRC

- Boolean() 0, null, undefined, NaN, "" =
> false å…¶å®ƒéƒ½æ˜¯true

#+BEGIN_SRC js
  console.log(Boolean("0")," ",Boolean(" ")) //true true !!!
  //å› ä¸ºâ€œ â€å’Œâ€œ0â€éƒ½æ˜¯éç©ºå­—ç¬¦ä¸²
#+END_SRC

** å°†æ•°å­—è½¬æ¢ä¸ºä»»æ„è¿›åˆ¶çš„å­—ç¬¦ä¸²,number.toString(base)
* è¿ç®—ç¬¦å’Œè¿ç®—å…ƒ

- äºŒå…ƒè¿ç®—ç¬¦ "+" å’Œå…¶å®ƒ

  - äºŒå…ƒ"+" å¯ä»¥åšåŠ æ³•ï¼Œä¹Ÿå¯ä»¥è¿æ¥å­—ç¬¦ä¸²

    #+BEGIN_SRC js
      1+1;   //2
      1+"1"; //"11"
      "1"+1; //"11" !!!å­—ç¬¦ä¸²+æ•°å­—ä¼šæŠŠæ•°å­—è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œç„¶åè¿›è¡Œå­—ç¬¦ä¸²è¿æ¥
      1+1+"1"//"21" !!!jsæ˜¯ä»å·¦åˆ°å³è¿ç®—çš„ï¼Œæ‰€ä»¥ä¼šå…ˆè®¡ç®— `1+1 //2`ï¼Œç„¶åè®¡ç®—`2+"1"//"21"`
    #+END_SRC

  - äºŒå…ƒ"-"åŠå…¶å®ƒäºŒå…ƒè¿ç®—ç¬¦ä¼šæŠŠéæ•°å­—è¿ç®—ç¬¦è½¬åŒ–ä¸ºæ•°å­—

    #+BEGIN_SRC js
      2-"1"; //1
    #+END_SRC

  - ä¸€å…ƒè¿ç®—ç¬¦"+"åŠæ•°å­—è½¬åŒ– ç›¸å½“äºè°ƒç”¨äº†=Number()=

    #+BEGIN_SRC js
      +"21"; //21
      //è¦è®¡ç®—â€œ21â€œ+â€21â€œçš„ç®—æ•°å€¼
      +"21" + +"21"; // 42
    #+END_SRC

- å¹‚è¿ç®— **

  #+BEGIN_SRC js
    2**3; //8
  #+END_SRC

- å‡ ä¸ªä¾‹å­

#+BEGIN_SRC js
  "" + 1 + 0;     //"10"
  "" - 1 + 0;     //-1
  true + false;   //1
  6 / "3";        //2
  "2" * "3";      //6
  4 + 5 + "px";   //"9px"
  "$" + 4 + 5;    //"$45"
  "4" - 2;        //2
  "4px" - 2;      //NaN
  7 / 0;          //Infinity
  "  -9  " + 5;   //" -9 5"
  "  -9  " - 5;   //-14
  null + 1;       //1
  undefined + 1;  //NaN
  " \t \n" - 2;   //NaN !!!å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å­—æ—¶ï¼Œä¼šå¿½ç•¥å­—ç¬¦ä¸²çš„é¦–å°¾å¤„çš„ç©ºæ ¼å­—ç¬¦ã€‚åœ¨è¿™é‡Œï¼Œæ•´ä¸ªå­—ç¬¦ä¸²ç”±ç©ºæ ¼å­—ç¬¦ç»„æˆï¼ŒåŒ…æ‹¬ \tã€\n ä»¥åŠå®ƒä»¬ä¹‹é—´çš„â€œå¸¸è§„â€ç©ºæ ¼ã€‚å› æ­¤ï¼Œç±»ä¼¼äºç©ºå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥ä¼šå˜ä¸º 0
#+END_SRC

* å€¼çš„æ¯”è¾ƒ

** å­—ç¬¦ä¸²æ¯”è¾ƒ

åœ¨æ¯”è¾ƒå­—ç¬¦ä¸²çš„å¤§å°æ—¶ï¼ŒJavaScript ä¼šä½¿ç”¨Unicode ç¼–ç é¡ºåºè¿›è¡Œåˆ¤å®šã€‚
å› æ­¤å°å†™å­—æ¯æ°¸è¿œ>å¤§å†™å­—æ¯ã€‚

- é¦–å…ˆæ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²çš„é¦–ä½å­—ç¬¦å¤§å°ã€‚
- å¦‚æœä¸€æ–¹å­—ç¬¦è¾ƒå¤§ï¼ˆæˆ–è¾ƒå°ï¼‰ï¼Œåˆ™è¯¥å­—ç¬¦ä¸²å¤§äºï¼ˆæˆ–å°äºï¼‰å¦ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚ç®—æ³•ç»“æŸã€‚
- å¦åˆ™ï¼Œå¦‚æœä¸¤ä¸ªå­—ç¬¦ä¸²çš„é¦–ä½å­—ç¬¦ç›¸ç­‰ï¼Œåˆ™ç»§ç»­å–å‡ºä¸¤ä¸ªå­—ç¬¦ä¸²å„è‡ªçš„åä¸€ä½å­—ç¬¦è¿›è¡Œæ¯”è¾ƒã€‚
- é‡å¤ä¸Šè¿°æ­¥éª¤è¿›è¡Œæ¯”è¾ƒï¼Œç›´åˆ°æ¯”è¾ƒå®ŒæˆæŸå­—ç¬¦ä¸²çš„æ‰€æœ‰å­—ç¬¦ä¸ºæ­¢ã€‚
- å¦‚æœä¸¤ä¸ªå­—ç¬¦ä¸²çš„å­—ç¬¦åŒæ—¶ç”¨å®Œï¼Œé‚£ä¹ˆåˆ™åˆ¤å®šå®ƒä»¬ç›¸ç­‰ï¼Œå¦åˆ™æœªç»“æŸï¼ˆè¿˜æœ‰æœªæ¯”è¾ƒçš„å­—ç¬¦ï¼‰çš„å­—ç¬¦ä¸²æ›´å¤§ã€‚

** å½“å¯¹/ä¸åŒç±»å‹/çš„å€¼è¿›è¡Œæ¯”è¾ƒæ—¶ï¼ŒJavaScript
ä¼šé¦–å…ˆå°†å…¶è½¬åŒ–ä¸ºæ•°å­—ï¼ˆnumberï¼‰å†åˆ¤å®šå¤§å°

ç›¸å½“äºè¿è¡Œäº†Number()

** å¯¹nullå’Œundefinedæ¯”è¾ƒ

- null == undefined true

- null === undefined false

- ä¸0çš„æ¯”è¾ƒ

  #+BEGIN_SRC js
    alert( null > 0 );  // false
    alert( null == 0 ); // false
    alert( null >= 0 ); // true

    //å› ä¸ºç›¸ç­‰æ€§æ£€æŸ¥ == å’Œæ™®é€šæ¯”è¾ƒç¬¦ > < >= <= çš„ä»£ç é€»è¾‘æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚è¿›è¡Œå€¼çš„æ¯”è¾ƒæ—¶ï¼Œnull ä¼šè¢«è½¬åŒ–ä¸ºæ•°å­—ï¼Œå› æ­¤å®ƒè¢«è½¬åŒ–ä¸ºäº† 0ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆï¼ˆ3ï¼‰ä¸­ null >= 0 è¿”å›å€¼æ˜¯ trueï¼Œï¼ˆ1ï¼‰ä¸­ null > 0 è¿”å›å€¼æ˜¯ falseã€‚
    //å¦ä¸€æ–¹é¢ï¼Œundefined å’Œ null åœ¨ç›¸ç­‰æ€§æ£€æŸ¥ == ä¸­ä¸ä¼šè¿›è¡Œä»»ä½•çš„ç±»å‹è½¬æ¢ï¼Œå®ƒä»¬æœ‰è‡ªå·±ç‹¬ç«‹çš„æ¯”è¾ƒè§„åˆ™ï¼Œæ‰€ä»¥é™¤äº†å®ƒä»¬ä¹‹é—´äº’ç­‰å¤–ï¼Œä¸ä¼šç­‰äºä»»ä½•å…¶ä»–çš„å€¼ã€‚è¿™å°±è§£é‡Šäº†ä¸ºä»€ä¹ˆï¼ˆ2ï¼‰ä¸­ null == 0 ä¼šè¿”å› falseã€‚

    //undefined ä¸åº”è¯¥è¢«ä¸å…¶ä»–å€¼è¿›è¡Œæ¯”è¾ƒï¼š
    alert( undefined > 0 ); // falseï¼Œundefinedè¢«è½¬æ¢æˆäº†NaN
    alert( undefined < 0 ); // falseï¼ŒåŒä¸Š
    alert( undefined == 0 ); // false: undefined==nullï¼Œåªä¸nulléå…¨ç­‰
  #+END_SRC

- è§„é¿å€¼çš„æ¯”è¾ƒå¯èƒ½äº§ç”Ÿçš„é”™è¯¯

  - é™¤äº†ä¸¥æ ¼ç›¸ç­‰ === å¤–ï¼Œå…¶ä»–å‡¡æ˜¯æœ‰ undefined/null
    å‚ä¸çš„æ¯”è¾ƒï¼Œæˆ‘ä»¬éƒ½éœ€è¦é¢å¤–å°å¿ƒã€‚
  - é™¤éä½ éå¸¸æ¸…æ¥šè‡ªå·±åœ¨åšä»€ä¹ˆï¼Œå¦åˆ™æ°¸è¿œä¸è¦ä½¿ç”¨ >= > < <=
    å»æ¯”è¾ƒä¸€ä¸ªå¯èƒ½ä¸º null/undefined çš„å˜é‡ã€‚
  - å¯¹äºå–å€¼å¯èƒ½æ˜¯ null/undefined
    çš„å˜é‡ï¼Œè¯·æŒ‰éœ€è¦/åˆ†åˆ«æ£€æŸ¥å®ƒçš„å–å€¼æƒ…å†µ/ã€‚

* if (...) è¯­å¥ä¼šè®¡ç®—åœ†æ‹¬å·å†…çš„è¡¨è¾¾å¼ï¼Œå¹¶å°†è®¡ç®—ç»“æœè½¬æ¢ä¸ºå¸ƒå°”å‹ã€‚

ç›¸å½“äºå¯¹æ‹¬å·å†…è¿”å›å€¼æ‰§è¡Œ=Boolean()= æ•°å­— 0ã€ç©ºå­—ç¬¦ä¸² ""ã€nullã€undefined
å’Œ NaN éƒ½ä¼šè¢«è½¬æ¢æˆ falseã€‚å› ä¸ºä»–ä»¬è¢«ç§°ä¸º â€œfalsy" å€¼ã€‚

* é€»è¾‘è¿ç®—ç¬¦

|| ï¼šè¿”å›ä¸ºçœŸå€¼çš„æ“ä½œæ•° && ï¼šè¿”å›ä¸ºå‡å€¼çš„æ“ä½œæ•° ! ï¼šå¸ƒå°”éè¿ç®—

- çŸ­è·¯è®¡ç®—

  - =a || b || c || d= è¿”å›ç¬¬ä¸€ä¸ªçœŸå€¼ï¼Œå¦‚æœéƒ½æ˜¯å‡ï¼Œè¿”å›æœ€åä¸€ä¸ªå€¼
  - =a && b && c && d= è¿”å›ç¬¬ä¸€ä¸ªå‡å€¼ï¼Œå¦‚æœéƒ½æ˜¯çœŸï¼Œè¿”å›æœ€åä¸€ä¸ªå€¼

- ä»£æ›¿if

  - =(predicate) || exp=; predicateä¸ºå‡ï¼Œæ‰§è¡Œexpï¼›
  - =(predicate) && exp=; predicateä¸ºçœŸï¼Œæ‰§è¡Œexpï¼›

- è½¬æ¢Booleanå€¼ =!!value= ç›¸å½“äº =Boolean(value)=

  !!! è¿™é‡Œä¸€èµ·è®°å¿†ä¸€ä¸‹=+value=è½¬æ¢ä¸ºæ•°å­—çš„ç”¨æ³•

- å‡ ä¸ªä¾‹å­

  #+BEGIN_SRC js
    console.log(console.log(1) || 2 || console.log(3)) //æ§åˆ¶å°å…ˆæ‰“å°å‡º1ï¼Œç„¶åæ˜¯2
    //console.log()è¿”å›å€¼æ˜¯undefinedï¼Œæ˜¯ä¸€ä¸ªfalsyå€¼ï¼Œæ‰€ä»¥ä¼šè¿›ä¸€æ­¥å‘åå–ä¹‹ï¼Œå–åˆ°2ååœæ­¢
  #+END_SRC

  [[https://zh.javascript.info/task/check-login][ä½¿ç”¨promptçš„ç™»é™†éªŒè¯]]
#+begin_src js
//ä½¿ç”¨promptè¿›è¡Œç™»é™†æ ¡éªŒ
'use strict'
function loginCheck(){
let  userName = prompt("Enter your user name please:");
if (!userName){
  alert("Canceled!");
return 0;
} else if (!(userName === "Admin")) {
  alert("I don't know you");
return 0;
}

  let passwd = prompt("Enter your password please:");

  if (!passwd){ alert("Canceled!");
return 0;
} else if (!(passwd ==  "TheMaster"))
{ alert("Wrong password");
 return 0;
}

  alert("Welcome!");
return 0;
 }
#+end_src
* æ§åˆ¶ç»“æ„

- break
- continue
** label:
  breakæˆ–continueåé¢å¦‚æœæ¥æ ‡ç­¾ï¼Œæ ‡ç­¾å¿…é¡»åœ¨è¯­å¥ä¹‹ä¸Šå®šä¹‰ã€‚
** switch:
  æ¯”è¾ƒswitchå’Œcaseçš„valueæ˜¯å¦/ä¸¥æ ¼ç›¸ç­‰/

  - æ³¨æ„=defaut=çš„ä½¿ç”¨
  - æ³¨æ„æ¯ä¸ªcaseçš„=break=ï¼Œæ²¡æœ‰breakå°±ä¼šç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªcase

- ä¸€ä¸ªä¾‹å­
  [[https://zh.javascript.info/task/list-primes][è¾“å‡ºç´ æ•°ï¼ˆprimeï¼‰]]

#+BEGIN_SRC js
  function isPrime(n) {
      for (let divider = 2 ; divider < n ; divider++) {
          if (n%divider === 0) {
              return false;
          }
      }
      return true;
  }

  function listPrime(n) {
      for (let prime = 2 ; prime <= n ; prime++) {
          if (isPrime(prime)) {
              console.log(`Found ${prime}!`);
          }
      }
      return 0;
  }
#+END_SRC

* forå¾ªç¯çš„å¾ªç¯ä½“å†…letå®šä¹‰çš„å˜é‡ï¼Œåœ¨å¾ªç¯ä½“å¤–æ˜¯ä¸ºå®šä¹‰çš„ï¼ˆä¸å¯è§çš„ï¼‰!!!
* å‡½æ•°ä¸å‡½æ•°è¡¨è¾¾å¼

** è¯­æ³•åŒºåˆ«

å‡½æ•°çš„èŠ±æ‹¬å·åé¢ä¸éœ€è¦=;= å‡½æ•°è¡¨è¾¾å¼çš„èŠ±æ‹¬å·åé¢éœ€è¦=;=
** å¯è§æ€§åŒºåˆ«
=ä¸¥æ ¼æ¨¡å¼ä¸‹= ï¼Œå½“ä¸€ä¸ªå‡½æ•°å£°æ˜åœ¨ä¸€ä¸ªä»£ç å—å†…æ—¶ï¼Œå®ƒåœ¨è¯¥ä»£ç å—å†…çš„ä»»ä½•ä½ç½®éƒ½æ˜¯å¯è§çš„ã€‚ä½†åœ¨ä»£ç å—å¤–ä¸å¯è§ã€‚
å¦‚æœæŠŠå‡½æ•°è¡¨è¾¾å¼èµ‹å€¼ç»™ä¸€ä¸ªåœ¨ä»£ç å—å¤–å£°æ˜çš„å˜é‡æ—¶ï¼Œå¯ä»¥åœ¨ä»£ç å—å¤–è°ƒç”¨

æ³¨æ„è¿™é‡Œè¯´çš„ä»£ç å—æ˜¯èŠ±æ‹¬å·çš„èŒƒå›´ï¼Œä¸æ˜¯/ä½œç”¨åŸŸ/çš„æ¦‚å¿µã€‚

ä¾‹å­ï¼š 
#+begin_src js
  let age = prompt("What is your age?", 18);

  // æœ‰æ¡ä»¶åœ°å£°æ˜ä¸€ä¸ªå‡½æ•°
  if (age < 18) {

    function welcome() {
      alert("Hello!");
    }

  } else {

    function welcome() {
      alert("Greetings!");
    }

  }

  ///ç¨åä½¿ç”¨ welcome(); // Error: welcome is not defined =è€Œ=js let
  age = 16; // æ‹¿ 16 ä½œä¸ºä¾‹å­

  if (age < 18) {
    welcome(); // Â  (è¿è¡Œ) // | function welcome() { // |
    alert("Hello!"); // | å‡½æ•°å£°æ˜åœ¨å£°æ˜å®ƒçš„ä»£ç å—å†…ä»»æ„ä½ç½®éƒ½å¯ç”¨ } // | //
    welcome(); // / (è¿è¡Œ)

  } else {

    function welcome() {
      alert("Greetings!");
    }

  }

  // åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬åœ¨èŠ±æ‹¬å·å¤–éƒ¨è°ƒç”¨å‡½æ•°ï¼Œæˆ‘ä»¬çœ‹ä¸åˆ°å®ƒä»¬å†…éƒ¨çš„å‡½æ•°å£°æ˜ã€‚

  welcome(); // Error: welcome is not defined
#+end_src
* å¯¹è±¡çš„é”®

** =[key]= çš„å½¢å¼ç”¨æ¥è¡¨ç¤ºä¸­é—´æœ‰ç©ºæ ¼çš„é”®åå’Œå˜é‡åé”®å

** è®¡ç®—å±æ€§->å¯¹è±¡å­—é¢é‡ä¸­ä½¿ç”¨æ–¹æ‹¬å·

#+BEGIN_SRC js
  let fruit = prompt("Which fruit to buy?", "apple");

  let bag = {
    [fruit]: 5, // å±æ€§åæ˜¯ä» fruit å˜é‡ä¸­å¾—åˆ°çš„
  };

  alert( bag.apple ); // 5 å¦‚æœ fruit="apple"
#+END_SRC

** å±æ€§å€¼çš„ç®€å†™

#+BEGIN_SRC js
  function makeUser(name, age) {
    return {
      name, // ä¸ name: name ç›¸åŒ
      age,  // ä¸ age: age ç›¸åŒ
      // ...
    };
  }
  //ä¹Ÿå¯ä»¥ä¸æ­£å¸¸é”®å€¼å¯¹çš„æ–¹å¼æ··ç”¨
  let user = {
    name,  // ä¸ name:name ç›¸åŒ
    age: 30
  };  
#+END_SRC

** inæ“ä½œç¬¦å·¦è¾¹æ˜¯å±æ€§åï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªå¸¦å¼•å·çš„å­—ç¬¦ä¸²ï¼‰

** æ£€æµ‹å¯¹è±¡æ˜¯å¦å«æœ‰æŸä¸ªå­—ç¬¦ä¸²

- =obj.key === undefined=
- =key in obj=

ç¬¬ä¸€ç§æ–¹æ³•å­˜åœ¨æ£€æµ‹ä¸åˆ°çš„æƒ…å†µï¼Œå¦‚ä¸‹ä¾‹ï¼š

#+BEGIN_SRC js
  let obj = {
    test: undefined
  };

  alert( obj.test ); // æ˜¾ç¤º undefinedï¼Œæ‰€ä»¥å±æ€§ä¸å­˜åœ¨ï¼Ÿ

  alert( "test" in obj ); // trueï¼Œå±æ€§å­˜åœ¨ï¼
#+END_SRC

* for...in å¾ªç¯ï¼Œ/æ•´æ•°å±æ€§/ä¼šè¢«è¿›è¡Œæ’åºï¼Œå…¶ä»–å±æ€§åˆ™æŒ‰ç…§åˆ›å»ºçš„é¡ºåºæ˜¾ç¤º

è¿™é‡Œçš„"æ•´æ•°å±æ€§"æŒ‡çš„æ˜¯ä¸€ä¸ªå¯ä»¥åœ¨ä¸ä½œä»»ä½•æ›´æ”¹çš„æƒ…å†µä¸‹è½¬æ¢ä¸ºæ•´æ•°çš„å­—ç¬¦ä¸²ï¼ˆåŒ…æ‹¬æ•´æ•°åˆ°æ•´æ•°ï¼‰ã€‚
ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºkeyï¼Œæœ‰Number(key) = key = String( Number(key) )ã€‚
æ¯”å¦‚ï¼Œå¦‚æœæœ‰obj["+49"]ï¼Œkeyæ˜¯"+49"ã€‚Number(key)=49ï¼ŒåŠ å·æ²¡æœ‰äº†ï¼Œä¸æ˜¯æ•´æ•°å±æ€§ã€‚
æ¯”å¦‚ï¼Œå¦‚æœæœ‰obj["1.2"]ï¼Œ1.2ä¸æ˜¯æ•´æ•°ã€‚

* å¯¹è±¡çš„ç›¸ç­‰åˆ¤æ–­ï¼Œå…¨ç­‰===å’Œéå…¨ç­‰==æ²¡æœ‰åŒºåˆ«ã€‚åªæœ‰åœ¨ä¸¤ä¸ªå˜é‡å¼•ç”¨æŒ‡å‘/åŒä¸€ä¸ªå¯¹è±¡/æ—¶ï¼Œæ‰ç›¸ç­‰ã€‚

* å¯¹è±¡çš„æµ…æ‹·è´Object.assign(obj, [src1, src1, src1,...])ï¼Œæ‰€æœ‰çš„srcçš„å±æ€§éƒ½æ‹·è´ç»™objï¼Œé”®åé‡å¤çš„ï¼Œåé¢çš„ä¼šè¦†ç›–å‰é¢çš„
* å¯¹è±¡æ·±æ‹·è´ï¼Œlodashåº“ï¼Œ=_.cloneDeep(obj)=

** æ·±æ‹·è´ç®—æ³• //ï¼šTODO

* æ£€æŸ¥ç©ºå¯¹è±¡

[[https://zh.javascript.info/task/is-empty][æ£€æŸ¥ç©ºå¯¹è±¡]]

#+BEGIN_SRC js
  function isEmpty(obj) {
    for (let key in obj){
      return false;
    }
    return true;
  }
#+END_SRC

* JSåƒåœ¾å›æ”¶ï¼ˆGCï¼‰çš„åŸç† ï¼ˆæè¿°å…¶åŸç†ï¼‰

ä»æ ¹å¼€å§‹éå†æ‰€æœ‰æ ¹å˜é‡çš„å¼•ç”¨å†æ ‡è®°è¿™äº›è¢«å¼•ç”¨çš„å˜é‡ï¼Œå†éå†è¿™äº›æ ‡è®°çš„å˜é‡ï¼Œç›´åˆ°æ‰€æœ‰å¯è¾¾ï¼ˆreachableï¼‰çš„å¼•ç”¨éƒ½è¢«æ ‡è®°ã€‚
æ ‡è®°å®Œæˆåï¼Œåˆ é™¤æ‰€æœ‰æœªè¢«æ ‡è®°çš„å˜é‡ã€‚

* Symbolç±»å‹

** let id = Symbol("id") // æ²¡æœ‰newï¼ŒSymbolçš„å‚æ•°æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²

** Symbolç±»å‹ä¸ä¼šè¢«è‡ªåŠ¨è½¬æ¢ä¸ºå­—ç¬¦ä¸²

** æ˜¾ç¤ºä¸€ä¸ªSymbolï¼šalert ( id.toString() )==> Symbol(id)

** æ˜¾ç¤ºä¸€ä¸ªSymbolæè¿°ï¼šalert (id.description)==>"id"ï¼Œè¿”å›å€¼æ˜¯ä¸€ä¸ªstring

** for...inå¾ªç¯ä¼šè·³è¿‡Symbolç±»å‹çš„é”®å€¼å¯¹ï¼Œä½†!!!Object.assignä¼šå¤åˆ¶Symbolç±»å‹çš„é”®å€¼å¯¹

* å…¨å±€Symbolæ³¨å†Œè¡¨

** Symbol.for()

** Symbol.keyFor()

** ä¸Symbolçš„ä¸åŒï¼š

- Symbol æ€»æ˜¯ä¸åŒçš„å€¼ï¼Œå³ä½¿å®ƒä»¬æœ‰ç›¸åŒçš„åå­—ã€‚
- å¦‚æœæˆ‘ä»¬å¸Œæœ›åŒåçš„ Symbol ç›¸ç­‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥ä½¿ç”¨å…¨å±€æ³¨å†Œè¡¨

  - =Symbol.for(key)= è¿”å›ï¼ˆå¦‚æœéœ€è¦çš„è¯åˆ™åˆ›å»ºï¼‰ä¸€ä¸ªä»¥ keyä½œä¸ºåå­—çš„å…¨å±€ Symbolã€‚
  - ä½¿ç”¨ Symbol.for å¤šæ¬¡è°ƒç”¨ key ç›¸åŒçš„ Symbol æ—¶ï¼Œè¿”å›çš„å°±æ˜¯åŒä¸€ä¸ªSymbolã€‚

* ç³»ç»ŸSymbol

#+BEGIN_SRC js
  Symbol.hasInstance
  Symbol.isConcatSpreadable
  Symbol.iterator
  Symbol.toPrimitive
#+END_SRC

* è·å–Symbolçš„æ–¹æ³•

** Object.getOwnPropertySymbols(obj)

** Reflect.ownKeys(obj)

** Symbolç±»å‹çš„å±æ€§ä¸æ˜¯ç™¾åˆ†ç™¾éšè—çš„

* å¤±å»thisçš„åŸå› 

** åŸç†

=.=æˆ–=[]=çš„æ–¹å¼è°ƒç”¨æ–¹æ³•æ—¶ï¼Œä¼šè¿”å›ä¸€ä¸ªç‰¹æ®Šçš„å¼•ç”¨ç±»å‹çš„å€¼ï¼š=(base, name, strict)= -
base æ˜¯å¯¹è±¡ - name æ˜¯å±æ€§å - strictæ˜¯æ˜¯å¦ä¸º=use strict=æ¨¡å¼
è¿™ä¸ªè¿‡ç¨‹ç¡®å®šäº†å‡½æ•°ä½“ä»£ç å’Œthisã€‚è¿™ä¸ªå¼•ç”¨ç±»å‹çš„å€¼ä»…åœ¨æ–¹æ³•è°ƒç”¨æ—¶ä½¿ç”¨ï¼Œå…¶å®ƒçš„èµ‹å€¼ç­‰æ“ä½œç­‰éƒ½ä¼šä¸¢å¤±è¿™ä¸ªå€¼ã€‚

å¦‚æœå°†è¿™ä¸ªå¼•ç”¨ç±»å‹ä½œä¸ºå³å€¼èµ‹å€¼ç»™å…¶å®ƒå˜é‡ï¼Œè¿™ä¸ªå¼•ç”¨ç±»å‹çš„å€¼ä¼šè¢«æ•´ä½“ä¸¢å¼ƒï¼ŒåªæŠŠå‡½æ•°å¼•ç”¨èµ‹å€¼ç»™äº†æ–°çš„å˜é‡ï¼Œè¿™ä¸ªæ—¶å€™å¯¹æ–°çš„å˜é‡æ‰§è¡Œå‡½æ•°å°±ä¼šå¤±å»thisã€‚å› ä¸ºthisæ ¹æœ¬æ²¡æœ‰ä¼ è¿‡æ¥
** ä¸€ä¸ªä¾‹å­ï¼šå¤æ‚è¿ç®—å¤±å»this

#+BEGIN_SRC js
  let user = {
    name: "Jesse",
    sayName(){
      console.log(this.name);
    }
  }

  user.sayName(); //"Jesse"

  let sayName = user.sayName();
  sayName(); // ç©ºç™½ï¼Œå› ä¸ºthisæŒ‡å‘undefined

  (false||user.sayName)(); // ç©ºç™½ã€‚å› ä¸ºæˆ–æ“ä½œç¬¦æŸ¥æ‰¾ç¬¬ä¸€ä¸ªçœŸå€¼å¹¶è¿”å›ï¼Œè¿”å›åçš„sayNameä¸¢å¤±äº†ç‰¹æ®Šå¼•ç”¨ç±»å‹ï¼ŒthisæŒ‡å‘undefined

  (user.sayName)(); //"Jesse"ã€‚å› ä¸ºç¬¬ä¸€å¯¹æ‹¬å·å¯æœ‰å¯æ— ï¼Œè¿™é‡Œæ˜¯è®¾å®šè®¡ç®—é¡ºåºçš„ï¼Œæ²¡æœ‰è¿”å›å€¼çš„è¿™ä¸ªç¯èŠ‚ã€‚
  // ä¸ä¸Šä¸€ä¸ªä¾‹å­çš„åŒºåˆ«
  (false||user.sayName)(); //user.sayNameè¿”å›ä¸€ä¸ªå¼•ç”¨ç±»å‹ï¼Œè¿™ä¸ªå¼•ç”¨ç±»å‹å‚ä¸äº†`||`è®¡ç®—ï¼Œè¿™é‡Œä¸¢å¤±äº†å¼•ç”¨ç±»å‹
  (user.sayName)(); //user.sayNameè¿”å›äº†ä¸€ä¸ªå¼•ç”¨ç±»å‹ï¼Œè¿™ä¸ªå¼•ç”¨ç±»å‹éšåè¢«è°ƒç”¨ï¼Œæ‰€ä»¥æ²¡æœ‰ä¸¢å¤±å¼•ç”¨ç±»å‹ã€‚
#+END_SRC

** å¦ä¸€ä¸ªä¾‹å­ï¼šå¯¹è±¡å­—é¢é‡ä¸­ä½¿ç”¨this

#+BEGIN_SRC js
  let outerObj = {
    name: "outer",
    makeInner() {
      return {
        name: "inner",
        ref: this
      }
    }
  }
  outerObj.makeInner().ref.name; //"outer"
  outerObj.makeInner().name; //"inner"
#+END_SRC

* é“¾å¼è°ƒç”¨çš„å®ç°ï¼šæ¯æ¬¡è°ƒç”¨åè¿”å›è¿™ä¸ªå¯¹è±¡çš„è‡ªèº«

#+BEGIN_SRC js
  let ladder = {
    step: 0,
    up() {
      this.step++;
      return this;
    },
    down() {
      this.step--;
      return this;
    },
    showStep() {
      alert( this.step );
      return this;
    }
  }

  ladder.up().up().down().up().down().showStep(); // 1
#+END_SRC

* å¯¹è±¡è½¬æ¢

** æ‰€æœ‰å¯¹è±¡åœ¨å¸ƒå°”ä¸Šä¸‹æ–‡ä¸­å‡ä¸º=true=

** æ•°å€¼è½¬æ¢å‘ç”Ÿåœ¨å¯¹è±¡ç›¸å‡æˆ–åº”ç”¨æ•°å­¦å‡½æ•°æ—¶ï¼ˆå¯¹è±¡ç›¸åŠ ä¸æ˜¯ï¼‰

** å­—ç¬¦ä¸²è½¬æ¢é€šå¸¸å‘ç”Ÿåœ¨=alert(obj)=è¿™æ ·ä¸€ä¸ªè¾“å‡ºå¯¹è±¡æˆ–ç±»ä¼¼çš„ä¸Šä¸‹æ–‡ä¸­

** å¯¹è±¡è½¬æ¢çš„hint

*** "string"

#+begin_src js
  // è¾“å‡º
  alert(obj);

  // å°†å¯¹è±¡ä½œä¸ºå±æ€§é”®
  anotherObj[obj] = 123;
#+end_src

*** "number"
#+begin_src js
  // æ˜¾å¼è½¬æ¢
  let num = Number(obj);

  // æ•°å­¦è¿ç®—ï¼ˆé™¤äº†äºŒè¿›åˆ¶åŠ æ³•ï¼‰
  let n = +obj; // ä¸€å…ƒåŠ æ³•
  let delta = date1 - date2;

  // å°äº/å¤§äºçš„æ¯”è¾ƒ
  let greater = user1 > user2;
#+end_src

*** "default"
åœ¨å°‘æ•°æƒ…å†µä¸‹å‘ç”Ÿï¼Œå½“è¿ç®—ç¬¦â€œä¸ç¡®å®šâ€æœŸæœ›å€¼çš„ç±»å‹æ—¶ã€‚

ä¾‹å¦‚ï¼ŒäºŒè¿›åˆ¶åŠ æ³• + å¯ç”¨äºå­—ç¬¦ä¸²ï¼ˆè¿æ¥ï¼‰ï¼Œä¹Ÿå¯ä»¥ç”¨äºæ•°å­—ï¼ˆç›¸åŠ ï¼‰ï¼Œæ‰€ä»¥å­—ç¬¦ä¸²å’Œæ•°å­—è¿™ä¸¤ç§ç±»å‹éƒ½å¯ä»¥ã€‚å› æ­¤ï¼Œå½“äºŒå…ƒåŠ æ³•å¾—åˆ°å¯¹è±¡ç±»å‹çš„å‚æ•°æ—¶ï¼Œå®ƒå°†ä¾æ® "default" hint æ¥å¯¹å…¶è¿›è¡Œè½¬æ¢ã€‚

æ­¤å¤–ï¼Œå¦‚æœå¯¹è±¡è¢«ç”¨äºä¸å­—ç¬¦ä¸²ã€æ•°å­—æˆ– symbol è¿›è¡Œ == æ¯”è¾ƒï¼Œè¿™æ—¶åˆ°åº•åº”è¯¥è¿›è¡Œå“ªç§è½¬æ¢ä¹Ÿä¸æ˜¯å¾ˆæ˜ç¡®ï¼Œå› æ­¤ä½¿ç”¨ "default" hintã€‚

  #+BEGIN_SRC js
    // äºŒå…ƒåŠ æ³•ä½¿ç”¨é»˜è®¤ hint
    let total = obj1 + obj2;

    // obj == number ä½¿ç”¨é»˜è®¤ hint
    if (user == 1) { ... };
  #+END_SRC

* å¯¹è±¡è½¬æ¢çš„åŸç†

** è°ƒç”¨è½¬æ¢é¡ºåº

è°ƒç”¨ obj[Symbol.toPrimitive](hint) â€” å¸¦æœ‰ symbol é”® Symbol.toPrimitiveï¼ˆç³»ç»Ÿ symbolï¼‰çš„æ–¹æ³•ï¼Œå¦‚æœè¿™ä¸ªæ–¹æ³•å­˜åœ¨çš„è¯ï¼Œ
å¦åˆ™ï¼Œå¦‚æœ hint æ˜¯ "string" â€” å°è¯• obj.toString() å’Œ obj.valueOf()ï¼Œæ— è®ºå“ªä¸ªå­˜åœ¨ã€‚
å¦åˆ™ï¼Œå¦‚æœ hint æ˜¯ "number" æˆ– "default" â€” å°è¯• obj.valueOf() å’Œ obj.toString()ï¼Œæ— è®ºå“ªä¸ªå­˜åœ¨ã€‚

*** ä¸€ä¸ªå®šä¹‰obj[[file:hint][Symbol.toPrimitive]]æ–¹æ³•çš„ä¾‹å­
#+begin_src js
  let user = {
    name: "John",
    money: 1000,

    [Symbol.toPrimitive](hint) {
      alert(`hint: ${hint}`);
      return hint == "string" ? `{name: "${this.name}"}` : this.money;
    }
  };

  // è½¬æ¢æ¼”ç¤ºï¼š
  alert(user); // hint: string -> {name: "John"}
  alert(+user); // hint: number -> 1000
  alert(user + 500); // hint: default -> 1500
#+end_src
* æ„é€ å‡½æ•°ã€newå…³é”®å­—åŠæ„é€ å‡½æ•°çš„return
** newå…³é”®å­—è°ƒç”¨äº†æ„é€ å‡½æ•°æ—¶ï¼Œå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ

- ä¸€ä¸ªæ–°çš„ç©ºå¯¹è±¡è¢«åˆ›å»ºå¹¶åˆ†é…ç»™ thisã€‚

- å‡½æ•°ä½“æ‰§è¡Œã€‚é€šå¸¸å®ƒä¼šä¿®æ”¹ thisï¼Œä¸ºå…¶æ·»åŠ æ–°çš„å±æ€§ã€‚

- è¿”å› this çš„å€¼
** æ„é€ å™¨æ¨¡å¼æµ‹è¯•ï¼šnew.targetã€‚è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œæµ‹è¯•å‡½æ•°æ˜¯å¦ä¸ºnewè°ƒç”¨

** æ„é€ å‡½æ•°çš„return

7. å¦‚æœ return è¿”å›çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œåˆ™è¿”å›è¿™ä¸ªå¯¹è±¡ï¼Œè€Œä¸æ˜¯ thisã€‚

8. å¦‚æœ return è¿”å›çš„æ˜¯ä¸€ä¸ªåŸå§‹ç±»å‹ï¼Œåˆ™å¿½ç•¥ã€‚

* æ•°å­—è¿›åˆ¶ä¸å‰ç¼€
** 16è¿›åˆ¶ 0x hexademical - x
** 2è¿›åˆ¶ 0b binary - b
** 8è¿›åˆ¶ 0o octal - o
* num.toString(base)ï¼Œbaseæ˜¯è¿›åˆ¶æ•°å­—numberç±»å‹ã€‚è¿”å›å€¼æ˜¯è¿›åˆ¶è½¬åŒ–åçš„å­—ç¬¦ä¸²åŒ–çš„æ•°å­—ï¼Œç±»å‹æ˜¯string
* æ•°å­—åç›´æ¥åŠ ç‚¹è°ƒç”¨æ–¹æ³•ä¼šäº§ç”Ÿé”™è¯¯
#+begin_src js
123456.toString(2) //é”™è¯¯ï¼Œå› ä¸ºæµ®ç‚¹æ•°æ ¼å¼æ˜¯1234.5678ï¼Œç¼–è¯‘å™¨ä¼šæŠŠ123456.å½“æˆæµ®ç‚¹æ•°çš„å°æ•°ç‚¹
123456..toString(2) //æ­£ç¡®
#+end_src

* æ•°å­—èˆå…¥
** Math.floor() //å‘ä¸‹èˆå…¥3.7=>3, -2.1=>-3
** Math.ceil()  //å‘ä¸Šæ‘„å…¥3.1=>4, -2.5=>-2 
** Math.round() //å››èˆäº”å…¥
** Math.trunc() //ç›´æ¥èˆå¼ƒå°æ•°ä½ï¼Œieä¸æ”¯æŒ

** ä¿ç•™nä½å°æ•° num.toFix(n)ï¼Œè¿”å›å­—ç¬¦ä¸²ç±»å‹ï¼Œè‹¥è¦æ•°å­—ï¼Œå‰é¢åŠ ä¸Š=+=

* isNaN()
  
åˆ¤æ–­æ˜¯ä¸æ˜¯NaN
* typeof NaN // number
* isFinite(str)ï¼Œå‚æ•°æ˜¯string
åˆ¤æ–­æ˜¯ä¸æ˜¯å¸¸è§„æ•°å­—ã€‚
- å¦‚æœæ˜¯-Infinity Infinityæˆ–è€…å…¶å®ƒå­—ç¬¦ä¸²ï¼Œè¿”å›falseã€‚
- å¦‚æœæ˜¯æ•°å­—å­—ç¬¦ä¸² //true
- nullå’Œ"" //true
- boolean //true
- undefined //false
#+begin_src js
console.log(isFinite(null),isFinite(""), isFinite("null"), isFinite(false), isFinite(undefined));
//true true false true false
#+end_src
* å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å­—
** Number()å’Œ+
æ˜¯ä¸¥æ ¼çš„ï¼Œé™¤äº†å¼€å¤´å’Œç»“å°¾çš„ç©ºæ ¼ï¼Œå‡ºç°éæ•°å­—å°±æ˜¯NaN
** parseInt(numstr, base)ï¼Œå‚æ•°numchræ˜¯æ•°å­—å­—ç¬¦ä¸²
** parseFloat(numstr, base)
** å‡ ä¸ªä¾‹å­
[[https://zh.javascript.info/task/why-rounded-down][ä¸ºä»€ä¹ˆ 6.35.toFixed(1) == 6.3ï¼Ÿ]]
#+begin_src js
  alert( 6.35.toFixed(1) ); // 6.3
  //åŸå› å¦‚ä¸‹
  alert( 6.35.toFixed(20) ); // 6.34999999999999964473
  //æ‰€ä»¥ä½¿ç”¨.toFixed()ä¼šæŠ¥é”™ï¼Œå› ä¸ºç²¾åº¦æœ‰æŸå¤±
  console.log( Math.round(6.35 * 10) / 10); // 6.35 -> 63.5 -> 64(rounded) -> 6.4ï¼Œé—®é¢˜è§£å†³
#+end_src

[[https://zh.javascript.info/task/endless-loop-error][å¶å‘çš„æ— é™å¾ªç¯]]
#+begin_src js
let i = 0;
while (i != 10) {
  i += 0.2;
}

let i = 0;
while (i < 11) {
  i += 0.2;
  if (i > 9.8 && i < 10.2) console.log( i );
}
//9.999999999999996
//10.199999999999996
#+end_src
** éšæœºæ•°å’Œéšæœºæ•´æ•°
[[https://zh.javascript.info/task/random-min-max][éšæœºæ•°]]
#+begin_src js
  //ç”Ÿæˆmin åˆ° maxä¹‹é—´çš„éšæœºæ•°ï¼ˆä¸åŒ…æ‹¬maxï¼‰
  function random (min, max) {
    let seed = Math.random();
    let seedAmp = seed * (max-min);
    return min+seedAmp;
  }
#+end_src
[[https://zh.javascript.info/task/random-int-min-max][éšæœºæ•´æ•°]]
åˆ›å»ºä¸€ä¸ªå‡½æ•° randomInteger(minï¼Œmax)ï¼Œè¯¥å‡½æ•°ä¼šç”Ÿæˆä¸€ä¸ªèŒƒå›´åœ¨ min åˆ° max ä¸­çš„éšæœºæ•´æ•°ï¼ŒåŒ…æ‹¬ min å’Œ maxã€‚

åœ¨ min..max èŒƒå›´ä¸­çš„æ‰€æœ‰æ•°å­—çš„*å‡ºç°æ¦‚ç‡*å¿…é¡»ç›¸åŒã€‚

#+begin_src js
//ä»”ç»†æ€è€ƒè¿™ä¸ªå‡ºç°æ¦‚ç‡
  function randomInteger(min, max) {
    // here rand is from min to (max+1)
    let rand = min + Math.random() * (max + 1 - min);
    return Math.floor(rand);
  }
#+end_src
* å­—ç¬¦ä¸²é•¿åº¦å±æ€§str.lengthåé¢æ²¡æœ‰æ‹¬å·ï¼Œä¸æ˜¯æ–¹æ³•
* éå†å­—ç¬¦ä¸²ç”¨for...of
* æ”¹å˜å­—ç¬¦ä¸²å¤§å°å†™(æ–¹æ³•)
** str.toUpperCase()
** str.toLowerCase()
* æŸ¥æ‰¾å­*å­—ç¬¦ä¸²*ä½ç½®str.indexOf(substr, pos)ï¼Œè¿”å›-1ï¼Œ0ï¼Œæˆ–index
ç¬¬äºŒä¸ªå‚æ•°æ˜¯å¼€å§‹æ£€ç´¢çš„ä½ç½®
** å€’åºstr.lastIndexOf(substr, pos)
** ç›´æ¥å°†indexOf()æ–¹æ³•çš„è¿”å›å€¼ä½œä¸ºifï¼ˆæˆ–å…¶å®ƒéœ€è¦Booleançš„ä¸Šä¸‹æ–‡ï¼‰æ˜¯ä¸é è°±çš„
å› ä¸ºindexOf()æ–¹æ³•çš„è¿”å›å€¼å¯èƒ½æ˜¯0ï¼Œä»£è¡¨åœ¨å­—ç¬¦ä¸²çš„èµ·å§‹ä½ç½®å°±æ‰¾åˆ°äº†substrï¼Œè€Œ0æ˜¯falsyçš„ï¼Œä¼šè¢«Booleanç›´æ¥è½¬æ¢ä¸ºfalseã€‚
æ­£ç¡®çš„æ–¹æ³•æ˜¯ç”¨~if (str.indexOf("Widget") != -1)~çš„å½¢å¼
* å­—ç¬¦ä¸²æŸ¥æ‰¾çš„ç°ä»£æ–¹æ³• 
** str.includes(substr)
** str.startsWith(substr)
** str.endsWith(substr)
* è·å–å­å­—ç¬¦ä¸²ï¼ˆæ³¨æ„ä¸arrayçš„æ–¹æ³•åŒºåˆ†ï¼‰
** str.slice(start [, end])ï¼Œä»startå¼€å§‹åˆ°endç»“æŸï¼Œä¸åŒ…æ‹¬endã€‚å…è®¸è´Ÿå€¼ã€‚
** str.substring(start [, end])ï¼Œä»startå¼€å§‹åˆ°endç»“æŸï¼Œä¸åŒ…æ‹¬*ä¸¤å¤´*ã€‚start/endå¯ä»¥æ¢ä½ç½®ï¼Œä½†æ˜¯ä¸å…è®¸è´Ÿå€¼
** str.substr(start [, length])ï¼Œå…è®¸startä¸ºè´Ÿæ•°
* å­—ç¬¦ä¸²ä¸UTF-16
** str.codePointAt(pos)ï¼Œè·å¾—poså¤„å­—ç¬¦çš„UTF-16ç¼–ç ï¼ˆè¿”å›å€¼ï¼š10è¿›åˆ¶æ•°å­—ï¼‰
** str.fromCodePoint(code)ï¼Œç”¨åˆ›å»ºä¸€ä¸ªUTF-16ç¼–ç å¯¹åº”çš„å­—ç¬¦ï¼Œå‚æ•°codeæ˜¯10è¿›åˆ¶æ•°å­—çš„UTF-16ç¼–ç 
** ä½¿ç”¨16è¿›åˆ¶çš„UTF-16ç¼–ç ç›´æ¥åˆ›å»ºå­—ç¬¦ï¼Œ'\u005a'
* åˆ é™¤å­—ç¬¦ä¸²å‰åç©ºæ ¼ str.trim()
* é‡å¤å­—ç¬¦ä¸²næ¬¡ï¼Œstr.repeat(n)
* å‡ ä¸ªå­—ç¬¦ä¸²çš„ä¾‹å­
** è½¬æ¢é¦–å­—æ¯å¤§å†™çš„å‘
[[https://zh.javascript.info/task/ucfirst][é¦–å­—æ¯è½¬æ¢]]
#+begin_src js
  function ucFirst(str) {
    if (!str) return str;//åˆ¤æ–­æ˜¯å¦æ˜¯ç©ºå­—ç¬¦ä¸²

    //å¦‚æœä¸åŠ ä¸Šä¸€ä¸ªifï¼Œä¹Ÿå¯ä»¥ï¼š
    //ä½¿ç”¨ str.charAt(0)ï¼Œå› ä¸ºå®ƒæ€»æ˜¯ä¼šè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆå¯èƒ½ä¸ºç©ºï¼‰

    return str[0].toUpperCase() + str.slice(1);
  }
    //æŒ‰ç†è¯´ï¼Œè¿™ä¸ªå‡½æ•°åº”è¯¥è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²
    //å¦‚æœè¯´stræœ¬èº«æ˜¯ç©ºçš„ï¼Œé‚£ä¹ˆè¿”å›å€¼ä¹Ÿåº”è¯¥æ˜¯ä¸€ä¸ªç©ºå­—ç¬¦ä¸²
    //ä½†æ˜¯å¦‚æœè¿™ä¸ªreternä¸­å¤„ç†å¤§å°å†™è½¬æ¢çš„éƒ¨åˆ†ç”¨çš„æ˜¯str[0]çš„è¯ï¼Œå¦‚æœstræœ¬èº«å°±æ˜¯ä¸€ä¸ªç©ºçš„å­—ç¬¦ä¸²ï¼Œstr[0]è¿”å›çš„æ˜¯undefinedã€‚é‚£ä¹ˆundefined+Stringç±»å‹ä¼šè¿”å›"undefinestrâ€ï¼Œå¯¼è‡´æœ€ç»ˆè¿”å›â€œundefinedâ€ã€‚
    //é—®é¢˜è§£å†³ã€‚
#+end_src
** æˆªæ–­æ–‡æœ¬
#+begin_src js
  //åˆ›å»ºå‡½æ•° truncate(str, maxlength) æ¥æ£€æŸ¥ str çš„é•¿åº¦ï¼Œå¦‚æœè¶…è¿‡ maxlength â€”â€” åº”ä½¿ç”¨ "â€¦" æ¥ä»£æ›¿ str çš„ç»“å°¾éƒ¨åˆ†ï¼Œé•¿åº¦ä»ç„¶ç­‰äº maxlengthã€‚

  //å‡½æ•°çš„ç»“æœåº”è¯¥æ˜¯æˆªæ–­åçš„æ–‡æœ¬ï¼ˆå¦‚æœéœ€è¦çš„è¯ï¼‰ã€‚
  function truncate(str, maxlength) {
    if (str.length > maxlength) {
      return str.slice(0, maxlength-1) + "...";
    }
    return str;
  }
#+end_src
* æ¸…ç©ºæ•°ç»„æœ€ç®€å•çš„æ–¹æ³• arr.length = 0
* æ•°ç»„çš„è½¬æ¢
** æ•°ç»„æ²¡æœ‰ Symbol.toPrimitiveï¼Œä¹Ÿæ²¡æœ‰ valueOfï¼Œå®ƒä»¬åªèƒ½æ‰§è¡Œ toString è¿›è¡Œè½¬æ¢
** æ•°ç»„çš„toString()æ–¹æ³•ä¼šè¿”å›ä»¥~,~éš”å¼€çš„å…ƒç´ åˆ—è¡¨çš„å­—ç¬¦ä¸²
** äºŒå…ƒæ•°ç»„ï¼Œç›¸å½“äºå¯¹æ‰€æœ‰å…ƒç´ æ•°ç»„ä¹Ÿæ‰§è¡ŒtoString()
#+begin_src js
    let testArr = [
      [1,2,3],
      [2,3,4],
      [3,4,5]
    ]
  //1,2,3,2,3,4,3,4,5
#+end_src
** è¾“å…¥æ•°å­—æ±‚å’Œ
å†™å‡ºå‡½æ•° sumInput()ï¼Œè¦æ±‚å¦‚ä¸‹ï¼š

ä½¿ç”¨ prompt å‘ç”¨æˆ·ç´¢è¦å€¼ï¼Œå¹¶å­˜åœ¨æ•°ç»„ä¸­ã€‚
å½“ç”¨æˆ·è¾“å…¥äº†éæ•°å­—ã€ç©ºå­—ç¬¦ä¸²æˆ–è€…ç‚¹å‡»â€œå–æ¶ˆâ€æŒ‰é’®çš„æ—¶å€™ï¼Œé—®è¯¢ç»“æŸã€‚
è®¡ç®—å¹¶è¿”å›æ•°ç»„æ‰€æœ‰é¡¹ä¹‹å’Œã€‚
P.S. 0 æ˜¯æœ‰æ•ˆçš„æ•°å­—ï¼Œä¸è¦å› ä¸ºæ˜¯ 0 å°±åœæ­¢é—®è¯¢ã€‚
#+begin_src js
function sumInput() {

  let numbers = [];

  while (true) {

    let value = prompt("A number please?", 0);

    // åº”è¯¥ç»“æŸäº†å—ï¼Ÿ
    if (value === "" || value === null || !isFinite(value)) break;

    numbers.push(+value);
  }

  let sum = 0;
  for (let number of numbers) {
    sum += number;
  }
  return sum;
}

alert( sumInput() );
// ä½¿ç”¨isFiniteè€Œä¸æ˜¯isNaNçš„åŸå› ï¼š

// isFinite: if the argument is positive or negative Infinity or NaN or undefined return false
// isNaN: if the argument is NaN return true

// isNaNä¸åŒ…å«è¶…é™æ£€æµ‹ï¼Œç„¶è€Œæ•°å€¼è¶…é™å°†å¯¼è‡´åŠ æ³•è®¡ç®—ä¸å‡†ç¡®ï¼Œå› æ­¤éœ€è¦è€ƒè™‘è¶…é™çš„æƒ…å†µã€‚
#+end_src
** æœ€å¤§å­æ•°ç»„
[[https://zh.javascript.info/task/maximal-subarray][æœ€å¤§å­æ•°ç»„]]
è¾“å…¥æ˜¯ä»¥æ•°å­—ç»„æˆçš„æ•°ç»„ï¼Œä¾‹å¦‚ arr = [1, -2, 3, 4, -9, 6].

ä»»åŠ¡æ˜¯ï¼šæ‰¾å‡ºæ‰€æœ‰é¡¹çš„å’Œæœ€å¤§çš„ arr æ•°ç»„çš„è¿ç»­å­æ•°ç»„ã€‚

å†™å‡ºå‡½æ•° getMaxSubSum(arr)ï¼Œç”¨å…¶æ‰¾å‡ºå¹¶è¿”å›æœ€å¤§å’Œã€‚
#+begin_src js
  function getMaxSubSum(arr) {
    let maxSum = 0;
    let partialSum = 0;

    for (let item of arr) { // arr ä¸­çš„æ¯ä¸ª item
      partialSum += item; // å°†å…¶åŠ åˆ° partialSum
      maxSum = Math.max(maxSum, partialSum); // è®°ä½æœ€å¤§å€¼
      if (partialSum < 0) partialSum = 0; // å¦‚æœæ˜¯è´Ÿæ•°å°±ç½®ä¸º 0
    }

    return maxSum;
  }

  alert( getMaxSubSum([-1, 2, 3, -9]) ); // 5
  alert( getMaxSubSum([-1, 2, 3, -9, 11]) ); // 11
  alert( getMaxSubSum([-2, -1, 1, 2]) ); // 3
  alert( getMaxSubSum([100, -9, 2, -3, 5]) ); // 100
  alert( getMaxSubSum([1, 2, 3]) ); // 6
  alert( getMaxSubSum([-1, -2, -3]) ); // 0
#+end_src
ç®—æ³•æ€æƒ³ï¼š
ä¸€åˆ—æ•°ç»„å¯ä»¥ç®€åŒ–ä¸ºå¦‚ä¸‹æƒ…å†µï¼š
[leftSum,minusMin,rightSum]

å¦‚æœ leftSum>minusMin && rightSum>minusMinï¼Œè¿”å›leftSum+minusMinx+rightSum
å¦‚æœ leftSum>rightSumï¼Œä¸”rightSum+minusMin<0ï¼Œè¿”å›leftSum
å¦‚æœ leftSum>rightSumï¼Œä¸”rightSum+minusMin=0ï¼Œè¿”å›leftSum
å¦‚æœ leftSum+minusMin <0, rightSum+minusMin <0, è¿”å›å·¦å³å’Œçš„æœ€å¤§å€¼

è¿™ä¸ªç®—æ³•åœ¨å¾ªç¯è¿‡ç¨‹ä¸­å°†æ•°å­—ç´¯åŠ ï¼Œå¹¶è®°ä½æœ€å¤§å€¼
å¦‚æœé‡åˆ°è´Ÿæ•°ï¼Œä¸”æ­¤æš‚æ—¶æœ€å¤§å€¼å°äºè´Ÿæ•°ï¼Œåˆ™ä»è´Ÿæ•°ä¹‹åé‡æ–°å¼€å§‹è®¡ç®—ã€‚
å› ä¸ºè¿™è¯æ˜å·¦æœ€å¤§å€¼å°äºæ­¤è´Ÿæ•°äº†ï¼Œåœ¨è¿™é‡Œæ‰“ä¸€ä¸ªæ–­ç‚¹ã€‚

* æ•°ç»„æ–¹æ³•
** arr.splice(index[, deleteCount, elem1, ..., elemN])
** arr.slice(star[, end])ï¼Œä¸åŒ…æ‹¬end
** arr.concat(arg1,arg2)ï¼Œå¦‚æœarg1æˆ–è€…arg2æ˜¯ä¸€ä¸ªarrayï¼Œä¼šè¢«å±•å¼€
*** å¦‚æœç±»ä¼¼æ•°ç»„çš„å¯¹è±¡å…·æœ‰ Symbol.isConcatSpreadable å±æ€§ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šè¢« concat å½“ä½œä¸€ä¸ªæ•°ç»„æ¥å¤„ç†ï¼ˆæ³¨æ„æ˜¯array_likeï¼‰
** arr.forEach()æ–¹æ³•ï¼Œä¸ºæ•°ç»„æ¯ä¸ªå…ƒç´ æ‰§è¡Œä¸€ä¸ªå‡½æ•°ã€‚å‡½æ•°æ‰§è¡Œç»“æœä¼šè¢«æŠ›å¼ƒ
è¯­æ³•ï¼š
#+begin_src js
  arr.forEach(function(item, index, array) {
    // ... do something with item
  });
#+end_src
** indexOf & includes
~arr.indexOf(item, from)~ -  ä»ç´¢å¼• from å¼€å§‹æœç´¢ itemï¼Œå¦‚æœæ‰¾åˆ°åˆ™è¿”å›ç´¢å¼•ï¼Œå¦åˆ™è¿”å› -1ã€‚
~arr.lastIndexOf(item, from)~ â€” å’Œä¸Šé¢ç›¸åŒï¼Œåªæ˜¯ä»å³å‘å·¦æœç´¢ã€‚
~arr.includes(item, from)~ â€” ä»ç´¢å¼• from å¼€å§‹æœç´¢ itemï¼Œå¦‚æœæ‰¾åˆ°åˆ™è¿”å› trueï¼ˆè¯‘æ³¨ï¼šå¦‚æœæ²¡æ‰¾åˆ°ï¼Œåˆ™è¿”å› falseï¼‰ã€‚
- è¯·æ³¨æ„ï¼Œè¿™äº›æ–¹æ³•ä½¿ç”¨çš„æ˜¯ä¸¥æ ¼ç›¸ç­‰ === æ¯”è¾ƒã€‚æ‰€ä»¥å¦‚æœæˆ‘ä»¬æœç´¢ falseï¼Œä¼šç²¾ç¡®åˆ°çš„ç¡®æ˜¯ false è€Œä¸æ˜¯æ•°å­— 0ã€‚
- æ­¤å¤–ï¼Œincludes çš„ä¸€ä¸ªéå¸¸å°çš„å·®åˆ«æ˜¯å®ƒèƒ½æ­£ç¡®å¤„ç†NaNï¼Œè€Œä¸åƒ indexOf/lastIndexOfï¼š
#+begin_src js
  const arr = [NaN];
  alert( arr.indexOf(NaN) ); // -1ï¼ˆåº”è¯¥ä¸º 0ï¼Œä½†æ˜¯ä¸¥æ ¼ç›¸ç­‰ === equality å¯¹ NaN æ— æ•ˆï¼‰
  alert( arr.includes(NaN) );// trueï¼ˆè¿™ä¸ªç»“æœæ˜¯å¯¹çš„ï¼‰
#+end_src
** åœ¨æ•°ç»„ä¸­æœç´¢
*** arr.find()
    #+begin_src js
      let result = arr.find(function(item, index, array) {
        // å¦‚æœè¿”å› trueï¼Œåˆ™è¿”å› item å¹¶åœæ­¢è¿­ä»£
        // å¯¹äº falsy åˆ™è¿”å› undefined
      })
     #+end_src
*** arr.findIndex()
    è¯­æ³•ä¸findç›¸åŒï¼Œä½†æ˜¯è¿”å›çš„æ˜¯å…ƒç´ çš„index
*** arr.filter()ï¼Œè¯­æ³•ä¸findç›¸åŒï¼Œä½†æ˜¯è¿”å›æ»¡è¶³æ¡ä»¶çš„å…ƒç´ ç»„æˆçš„æ–°æ•°ç»„
** è½¬æ¢æ•°ç»„
*** arr.map()
*** arr.sort() æœ‰å‰¯ä½œç”¨ï¼Œæ”¹å˜arræœ¬èº«ï¼Œå›è°ƒå‡½æ•°ä¸­çš„aï¼Œbï¼šbæ˜¯ç¬¬ä¸€ä¸ªæ•°ï¼Œè€Œaæ˜¯ç¬¬äºŒä¸ªæ•°!!!
*** arr.reverse() æœ‰å‰¯ä½œç”¨ï¼Œæ”¹å˜arræœ¬èº«
* ä½¿ç”¨ localeCompare for strings
å¯¹äºè®¸å¤šå­—æ¯ï¼Œæœ€å¥½ä½¿ç”¨ str.localeCompare æ–¹æ³•æ­£ç¡®åœ°å¯¹å­—æ¯è¿›è¡Œæ’åºï¼Œä¾‹å¦‚ Ã–ã€‚
ä¾‹å¦‚ï¼Œè®©æˆ‘ä»¬ç”¨å¾·è¯­å¯¹å‡ ä¸ªå›½å®¶/åœ°åŒºè¿›è¡Œæ’åºï¼š

str.localeCompare(str2)è¯­æ³•ï¼š
str.localeCompare(str2) ä¼šæ ¹æ®è¯­è¨€è§„åˆ™è¿”å›ä¸€ä¸ªæ•´æ•°ï¼Œè¿™ä¸ªæ•´æ•°èƒ½è¡¨æ˜ str æ˜¯å¦åœ¨ str2 å‰ï¼Œåæˆ–è€…ç­‰äºå®ƒï¼š
str.localeCompare(str2)æ¯”è¾ƒçš„æ˜¯stræ˜¯å¦å¤§äºstr2!!!

å¦‚æœ str å°äº str2 åˆ™è¿”å›è´Ÿæ•°ã€‚
å¦‚æœ str å¤§äº str2 åˆ™è¿”å›æ­£æ•°ã€‚
å¦‚æœå®ƒä»¬ç›¸ç­‰åˆ™è¿”å› 0ã€‚

#+begin_src js
    let countries = ['Ã–sterreich', 'Andorra', 'Vietnam'];

    alert( countries.sort( (a, b) => a > b ? 1 : -1) ); // Andorra, Vietnam, Ã–sterreichï¼ˆé”™çš„ï¼‰

    alert( countries.sort( (a, b) => a.localeCompare(b) ) ); // Andorra,Ã–sterreich,Vietnamï¼ˆå¯¹çš„ï¼ï¼‰
   #+end_src
* åˆ†å‰²å­—ç¬¦ä¸² / ç²˜åˆæ•°ç»„
** str.split(delim[, arrLength])
** array.join(glue) glueæ˜¯ç”¨æ¥â€œç²˜åˆâ€æ•°ç»„å­—ç¬¦ä¸²çš„å­—ç¬¦
* reduce / reduceRight
  è¯­æ³•ï¼š
  #+begin_src js
    let value = arr.reduce(function(accumulator, item, index, array) {
      // ...
    }, [initial]);
  #+end_src

 -  å¦‚æœæ²¡æœ‰åˆå§‹å€¼ï¼Œé‚£ä¹ˆ reduce ä¼šå°†æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä½œä¸ºåˆå§‹å€¼ï¼Œå¹¶ä»ç¬¬äºŒä¸ªå…ƒç´ å¼€å§‹è¿­ä»£ã€‚
 -  ä½†æ˜¯è¿™ç§ä½¿ç”¨éœ€è¦éå¸¸å°å¿ƒã€‚å¦‚æœæ•°ç»„ä¸ºç©ºï¼Œé‚£ä¹ˆåœ¨æ²¡æœ‰åˆå§‹å€¼çš„æƒ…å†µä¸‹è°ƒç”¨ reduce ä¼šå¯¼è‡´é”™è¯¯ã€‚
* Array.isArray(arr)ã€‚åˆ¤æ–­æ˜¯å¦ä¸ºæ•°ç»„ä¸èƒ½ç”¨typeofï¼Œå› ä¸ºæ— è®ºæ˜¯æ•°ç»„è¿˜æ˜¯å¯¹è±¡ï¼Œè¿”å›å€¼éƒ½æ˜¯object
* æ•°ç»„çš„è½¬æ¢å’Œreduceæ–¹æ³•éƒ½æ”¯æŒthisArgï¼Œæ˜¯æœ€åä¸€ä¸ªå‚æ•°ã€‚
* æ•°ç»„æ–¹æ³•å¤‡å¿˜å•ï¼š

** æ·»åŠ /åˆ é™¤å…ƒç´ ï¼š

push(...items) â€” å‘å°¾ç«¯æ·»åŠ å…ƒç´ ï¼Œ
pop() â€” ä»å°¾ç«¯æå–ä¸€ä¸ªå…ƒç´ ï¼Œ
shift() â€” ä»é¦–ç«¯æå–ä¸€ä¸ªå…ƒç´ ï¼Œ
unshift(...items) â€” å‘é¦–ç«¯æ·»åŠ å…ƒç´ ï¼Œ
splice(pos, deleteCount, ...items) â€” ä» index å¼€å§‹åˆ é™¤ deleteCount ä¸ªå…ƒç´ ï¼Œå¹¶åœ¨å½“å‰ä½ç½®æ’å…¥ itemsã€‚
slice(start, end) â€” åˆ›å»ºä¸€ä¸ªæ–°æ•°ç»„ï¼Œå°†ä»ä½ç½® start åˆ°ä½ç½® endï¼ˆä½†ä¸åŒ…æ‹¬ endï¼‰çš„å…ƒç´ å¤åˆ¶è¿›å»ã€‚
concat(...items) â€” è¿”å›ä¸€ä¸ªæ–°æ•°ç»„ï¼šå¤åˆ¶å½“å‰æ•°ç»„çš„æ‰€æœ‰å…ƒç´ ï¼Œå¹¶å‘å…¶ä¸­æ·»åŠ  itemsã€‚å¦‚æœ items ä¸­çš„ä»»æ„ä¸€é¡¹æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œé‚£ä¹ˆå°±å–å…¶å…ƒç´ ã€‚
** æœç´¢å…ƒç´ ï¼š

indexOf/lastIndexOf(item, pos) â€” ä»ä½ç½® pos å¼€å§‹æœç´¢ itemï¼Œæœç´¢åˆ°åˆ™è¿”å›è¯¥é¡¹çš„ç´¢å¼•ï¼Œå¦åˆ™è¿”å› -1ã€‚
includes(value) â€” å¦‚æœæ•°ç»„æœ‰ valueï¼Œåˆ™è¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚
find/filter(func) â€” é€šè¿‡ func è¿‡æ»¤å…ƒç´ ï¼Œè¿”å›ä½¿ func è¿”å› true çš„ç¬¬ä¸€ä¸ªå€¼/æ‰€æœ‰å€¼ã€‚
findIndex å’Œ find ç±»ä¼¼ï¼Œä½†è¿”å›ç´¢å¼•è€Œä¸æ˜¯å€¼ã€‚
** éå†å…ƒç´ ï¼š

forEach(func) â€” å¯¹æ¯ä¸ªå…ƒç´ éƒ½è°ƒç”¨ funcï¼Œä¸è¿”å›ä»»ä½•å†…å®¹ã€‚
** è½¬æ¢æ•°ç»„ï¼š

map(func) â€” æ ¹æ®å¯¹æ¯ä¸ªå…ƒç´ è°ƒç”¨ func çš„ç»“æœåˆ›å»ºä¸€ä¸ªæ–°æ•°ç»„ã€‚
sort(func) â€” å¯¹æ•°ç»„è¿›è¡ŒåŸä½ï¼ˆin-placeï¼‰æ’åºï¼Œç„¶åè¿”å›å®ƒã€‚
reverse() â€” åŸä½ï¼ˆin-placeï¼‰åè½¬æ•°ç»„ï¼Œç„¶åè¿”å›å®ƒã€‚
split/join â€” å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°ç»„å¹¶è¿”å›ã€‚
reduce(func, initial) â€” é€šè¿‡å¯¹æ¯ä¸ªå…ƒç´ è°ƒç”¨ func è®¡ç®—æ•°ç»„ä¸Šçš„å•ä¸ªå€¼ï¼Œå¹¶åœ¨è°ƒç”¨ä¹‹é—´ä¼ é€’ä¸­é—´ç»“æœã€‚
** å…¶ä»–ï¼š  â€“ Array.isArray(arr) æ£€æŸ¥ arr æ˜¯å¦æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚

** è¯·æ³¨æ„ï¼Œsortï¼Œreverse å’Œ splice æ–¹æ³•ä¿®æ”¹çš„æ˜¯æ•°ç»„æœ¬èº«ã€‚!!!

** è¾ƒä¸ºä¸å¸¸ç”¨çš„æ–¹æ³•ï¼š

~arr.some(fn) / arr.every(fn)~ æ£€æŸ¥æ•°ç»„ã€‚

ä¸ map ç±»ä¼¼ï¼Œå¯¹æ•°ç»„çš„æ¯ä¸ªå…ƒç´ è°ƒç”¨å‡½æ•° fnã€‚å¦‚æœä»»ä½•/æ‰€æœ‰ç»“æœä¸º trueï¼Œåˆ™è¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚

~arr.fill(value, start, end)~ â€” ä»ç´¢å¼• start åˆ° endï¼Œç”¨é‡å¤çš„ value å¡«å……æ•°ç»„ã€‚

~arr.copyWithin(target, start, end)~ â€” å°†ä»ä½ç½® start åˆ° end çš„æ‰€æœ‰å…ƒç´ å¤åˆ¶åˆ° è‡ªèº« çš„ target ä½ç½®ï¼ˆè¦†ç›–ç°æœ‰å…ƒç´ ï¼‰ã€‚
* åŸä½ï¼ˆin placeï¼‰çš„æ¦‚å¿µã€‚ä¿®æ”¹åŸæ•°ç»„çš„æ•°æ®ï¼Œäº§ç”Ÿäº†å‰¯ä½œç”¨ã€‚ï¼ˆåŸä½è¿‡æ»¤ã€åŸä½æ’åºç­‰ï¼‰
* æ•°ç»„æ–¹æ³•çš„å‡ ä¸ªä¾‹å­
** è½¬æ¢ä¸ºé©¼å³°å‘½åæ³•
#+begin_src js
function camelize(str) {
  return str
    .split('-') // splits 'my-long-word' into array ['my', 'long', 'word']
    .map(
      // capitalizes first letters of all array items except the first one
      // converts ['my', 'long', 'word'] into ['my', 'Long', 'Word']
      (word, index) => index == 0 ? word : word[0].toUpperCase() + word.slice(1)
    )
    .join(''); // joins ['my', 'Long', 'Word'] into 'myLongWord'
}
// æ³¨æ„è¿™ä¸ªè§£å†³æ–¹æ¡ˆæ²¡æœ‰è€ƒè™‘åˆ†å‰²å¼€çš„å­stringå¯èƒ½ä¸ºç©ºå­—ç¬¦ä¸²çš„æƒ…å†µï¼Œå› ä¸ºé»˜è®¤ä¸ä¼šå‡ºç°è¿™æ ·çš„æƒ…å†µã€‚
// ä½†æ˜¯å¦‚æœç”¨ debug-mode--ver-1ï¼Œè¿™ç§ï¼Œå‡ºç°åŒä¸‹åˆ’çº¿çš„æƒ…å†µï¼Œå°±ä¼šå‡ºç°å‰æ–‡è¯´åˆ°çš„undefinedé—®é¢˜
#+end_src

** éåŸä½æ’åºæ•°ç»„ï¼ˆæ— å‰¯ä½œç”¨çš„sortï¼‰
   #+begin_src js
     function copySorted(arr) {
       return arr.slice().sort();
     }

     let arr = ["HTML", "JavaScript", "CSS"];

     let sorted = copySorted(arr);

     alert( sorted );
     alert( arr );
     // str.sliceç›´æ¥æµ…æ‹·è´ä¸€ä¸ªarray
   #+end_src
** å¯æ‰©å±•çš„calculator
#+begin_src js
function Calculator() {

  this.methods = {
    "-": (a, b) => a - b,
    "+": (a, b) => a + b
  };

  this.calculate = function(str) {

    let split = str.split(' '),
      a = +split[0],
      op = split[1],
      b = +split[2]

    if (!this.methods[op] || isNaN(a) || isNaN(b)) {
      return NaN;
    } //*

    return this.methods[op](a, b);
  }

  this.addMethod = function(name, func) {
    this.methods[name] = func;
  };
}
// æ³¨æ„*è¡Œçš„æ¡ä»¶åˆ¤æ–­ï¼šå¦‚æœä¸å­˜åœ¨æ–¹æ³•ã€æ“ä½œæ•°éæ•°å­—ï¼Œç›´æ¥è¿”å›NaNã€‚
// è¿™é‡Œç”¨isFinite()æ›´å¥½ï¼Œå¯ä»¥å¤„ç†infinityçš„æƒ…å†µ
#+end_src
** æ˜ å°„åˆ°å¯¹è±¡
#+begin_src js
let john = { name: "John", surname: "Smith", id: 1 };
let pete = { name: "Pete", surname: "Hunt", id: 2 };
let mary = { name: "Mary", surname: "Key", id: 3 };

let users = [ john, pete, mary ];

let usersMapped = users.map(user => ({
  fullName: `${user.name} ${user.surname}`,
  id: user.id
}));//æ³¨æ„ç®­å¤´å‡½æ•°è¿”å›å€¼å¸¦å¤§æ‹¬å·æ—¶éœ€è¦ç”¨å°æ‹¬å·æ‰©èµ·æ¥ï¼Œä¸ç„¶ç®­å¤´å‡½æ•°ä¼šè®¤ä¸ºå¤§æ‹¬å·å†…æ˜¯å‡½æ•°ä½“

/*
usersMapped = [
  { fullName: "John Smith", id: 1 },
  { fullName: "Pete Hunt", id: 2 },
  { fullName: "Mary Key", id: 3 }
]
*/

alert( usersMapped[0].id ); // 1
alert( usersMapped[0].fullName ); // John Smith
#+end_src
** éšæœºæ’åˆ—æ•°ç»„ï¼ˆshuffleï¼‰
[[https://en.wikipedia.org/wiki/Fisher%E2%80%93Yates_shuffle][Fisher-yates shuffle]] ç®—æ³•
ä¼˜ç‚¹ï¼šæ²¡æœ‰æ’åºï¼ˆsortæ–¹æ³•ï¼‰å¼€é”€ï¼Œå„ç§ç»„åˆå‡ºç°çš„æ¦‚ç‡ç›¸ç­‰

æ™®é€šç®—æ³•ï¼š
#+begin_src js
function shuffle(array) {
  array.sort(() => Math.random() - 0.5);
} //ç”Ÿæˆ-0.5ï½0.5çš„éšæœºæ•°ï¼Œä½œä¸ºæ’åºå› å­

let arr = [1, 2, 3];
shuffle(arr);
alert(arr);
#+end_src
è¿™ç§ç®—æ³•ä¼šé€ æˆå„ç§ç»„åˆå‡ºç°æ¦‚ç‡ä¸ç›¸ç­‰çš„é—®é¢˜ï¼Œå¦‚ä¸‹æµ‹è¯•ä»£ç ï¼š
#+begin_src js
function shuffle(array) {
  array.sort(() => Math.random() - 0.5);
}

// æ‰€æœ‰å¯èƒ½æ’åˆ—çš„å‡ºç°æ¬¡æ•°
let count = {
  '123': 0,
  '132': 0,
  '213': 0,
  '231': 0,
  '321': 0,
  '312': 0
};

for (let i = 0; i < 1000000; i++) {
  let array = [1, 2, 3];
  shuffle(array);
  count[array.join('')]++;
}

// æ˜¾ç¤ºæ‰€æœ‰å¯èƒ½æ’åˆ—çš„å‡ºç°æ¬¡æ•°
for (let key in count) {
  alert(`${key}: ${count[key]}`);
}
#+end_src
ç»“æœï¼š
123: 250706
132: 124425
213: 249618
231: 124880
312: 125148
321: 125223
123å’Œ213å‡ºç°çš„æ¦‚ç‡è¿œé«˜äºå…¶å®ƒã€‚ä¸åŒç»„åˆçš„å‡ºç°æ¦‚ç‡ä¸ä¸åŒå¼•æ“çš„ä¸åŒå®ç°ç›¸å…³
** æ•°ç»„å»é‡çš„æ€§èƒ½é—®é¢˜
#+begin_src js
function unique(arr) {
  let result = [];

  for (let str of arr) {
    if (!result.includes(str)) {
      result.push(str);
    }
  }

  return result;
}

let strings = ["Hare", "Krishna", "Hare", "Krishna",
  "Krishna", "Krishna", "Hare", "Hare", ":-O"
];

alert( unique(strings) ); // Hare, Krishna, :-O
#+end_src
å­˜åœ¨æ½œåœ¨çš„æ€§èƒ½é—®é¢˜ã€‚

æ–¹æ³• result.includes(str) åœ¨å†…éƒ¨éå†æ•°ç»„ resultï¼Œå¹¶å°†æ¯ä¸ªå…ƒç´ ä¸ str è¿›è¡Œæ¯”è¾ƒä»¥æ‰¾åˆ°åŒ¹é…é¡¹ã€‚

æ‰€ä»¥å¦‚æœ result ä¸­æœ‰ 100 ä¸ªå…ƒç´ ï¼Œå¹¶ä¸”æ²¡æœ‰ä»»ä½•ä¸€é¡¹ä¸ str åŒ¹é…ï¼Œé‚£ä¹ˆå®ƒå°†éå†æ•´ä¸ª result å¹¶è¿›è¡Œ 100 æ¬¡æ¯”è¾ƒã€‚å¦‚æœ result å¾ˆå¤§ï¼Œæ¯”å¦‚ 10000ï¼Œé‚£ä¹ˆå°±ä¼šæœ‰ 10000 æ¬¡çš„æ¯”è¾ƒã€‚

è¿™æœ¬èº«å¹¶ä¸æ˜¯é—®é¢˜ï¼Œå› ä¸º JavaScript å¼•æ“é€Ÿåº¦éå¸¸å¿«ï¼Œæ‰€ä»¥éå†ä¸€ä¸ªæœ‰ 10000 ä¸ªå…ƒç´ çš„æ•°ç»„åªéœ€è¦å‡ å¾®ç§’ã€‚

ä½†æ˜¯æˆ‘ä»¬åœ¨ forå¾ªç¯ä¸­å¯¹ arr çš„æ¯ä¸ªå…ƒç´ éƒ½è¿›è¡Œäº†ä¸€æ¬¡æ£€æµ‹ã€‚

å› æ­¤ï¼Œå¦‚æœ arr.length æ˜¯ 10000ï¼Œæˆ‘ä»¬ä¼šæœ‰ 10000 * 10000 = 1 äº¿æ¬¡çš„æ¯”è¾ƒã€‚é‚£çœŸçš„å¤ªå¤šäº†ã€‚

æ‰€ä»¥è¯¥è§£å†³æ–¹æ¡ˆä»…é€‚ç”¨äºå°å‹æ•°ç»„ã€‚

[[https://zh.javascript.info/map-set][é›†åˆå’Œæ˜ å°„]]èƒ½å¤Ÿè§£å†³è¿™ä¸ªæ€§èƒ½é—®é¢˜

* åŒºåˆ†iterable objectå’Œarray like
** Iterable å¦‚ä¸Šæ‰€è¿°ï¼Œæ˜¯å®ç° Symbol.iterator æ–¹æ³•çš„å¯¹è±¡ã€‚
** Array-like æ˜¯æœ‰ç´¢å¼•å’Œ length å±æ€§çš„å¯¹è±¡ï¼Œæ‰€ä»¥å®ƒä»¬çœ‹èµ·æ¥å¾ˆåƒæ•°ç»„ã€‚

* Symbol.iterator
  ä¸€ä¸ªä¸“é—¨ç”¨äºä½¿å¯¹è±¡å¯è¿­ä»£çš„å†…ç½® symbol:

1. å½“ for..of å¾ªç¯å¯åŠ¨æ—¶ï¼Œå®ƒä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼ˆå¦‚æœæ²¡æ‰¾åˆ°ï¼Œå°±ä¼šæŠ¥é”™ï¼‰ã€‚è¿™ä¸ªæ–¹æ³•å¿…é¡»è¿”å›ä¸€ä¸ª è¿­ä»£å™¨ï¼ˆiteratorï¼‰ â€”â€” ä¸€ä¸ªæœ‰ next æ–¹æ³•çš„å¯¹è±¡ã€‚
2. ä»æ­¤å¼€å§‹ï¼Œfor..of ä»…é€‚ç”¨äºè¿™ä¸ªè¢«è¿”å›çš„å¯¹è±¡ã€‚
3. å½“ for..of å¾ªç¯å¸Œæœ›å–å¾—ä¸‹ä¸€ä¸ªæ•°å€¼ï¼Œå®ƒå°±è°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„ next() æ–¹æ³•ã€‚
next() æ–¹æ³•è¿”å›çš„ç»“æœçš„æ ¼å¼å¿…é¡»æ˜¯ {done: Boolean, value: any}ï¼Œå½“ done=true æ—¶ï¼Œè¡¨ç¤ºè¿­ä»£ç»“æŸï¼Œå¦åˆ™ value æ˜¯ä¸‹ä¸€ä¸ªå€¼ã€‚

#+begin_src js
  let range = {
    from: 1,
    to: 5
  };

  // æˆ‘ä»¬å¸Œæœ› for..of è¿™æ ·è¿è¡Œï¼š
  // for(let num of range) ... num=1,2,3,4,5

  range[Symbol.iterator] = function() {

    // â€¦â€¦å®ƒè¿”å›è¿­ä»£å™¨å¯¹è±¡ï¼ˆiterator objectï¼‰ï¼š
    // 2. æ¥ä¸‹æ¥ï¼Œfor..of ä»…ä¸æ­¤è¿­ä»£å™¨ä¸€èµ·å·¥ä½œï¼Œè¦æ±‚å®ƒæä¾›ä¸‹ä¸€ä¸ªå€¼
    return {
      current: this.from,
      last: this.to,

      // 3. next() åœ¨ for..of çš„æ¯ä¸€è½®å¾ªç¯è¿­ä»£ä¸­è¢«è°ƒç”¨
      next() {
        // 4. å®ƒå°†ä¼šè¿”å› {done:.., value :...} æ ¼å¼çš„å¯¹è±¡
        if (this.current <= this.last) {
          return { done: false, value: this.current++ };
        } else {
          return { done: true };
        }
      }
    };
  };

  // ç°åœ¨å®ƒå¯ä»¥è¿è¡Œäº†ï¼
  for (let num of range) {
    alert(num); // 1, ç„¶åæ˜¯ 2, 3, 4, 5
  }
#+end_src

ä»æŠ€æœ¯ä¸Šè¯´ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒä»¬åˆå¹¶ï¼Œå¹¶ä½¿ç”¨ range è‡ªèº«ä½œä¸ºè¿­ä»£å™¨æ¥ç®€åŒ–ä»£ç ã€‚
ä½†ç¼ºç‚¹æ˜¯ï¼Œç°åœ¨ä¸å¯èƒ½åŒæ—¶åœ¨å¯¹è±¡ä¸Šè¿è¡Œä¸¤ä¸ª for..of å¾ªç¯äº†ï¼šå®ƒä»¬å°†å…±äº«è¿­ä»£çŠ¶æ€ï¼Œå› ä¸ºåªæœ‰ä¸€ä¸ªè¿­ä»£å™¨ï¼Œå³å¯¹è±¡æœ¬èº«ã€‚ä½†æ˜¯ä¸¤ä¸ªå¹¶è¡Œçš„ for..of æ˜¯å¾ˆç½•è§çš„ï¼Œå³ä½¿åœ¨å¼‚æ­¥æƒ…å†µä¸‹ã€‚
#+begin_src js
  let range = {
    from: 1,
    to: 5,

    [Symbol.iterator]() {
      this.current = this.from;
      return this;
    },

    next() {
      if (this.current <= this.to) {
        return { done: false, value: this.current++ };
      } else {
        return { done: true };
      }
    }
  };

  for (let num of range) {
    alert(num); // 1, ç„¶åæ˜¯ 2, 3, 4, 5
 #+end_src

** æ˜¾å¼è°ƒç”¨è¿­ä»£å™¨
 #+begin_src js
 let str = "Hello";

// å’Œ for..of åšç›¸åŒçš„äº‹
// for (let char of str) alert(char);

let iterator = str[Symbol.iterator]();

while (true) {
  let result = iterator.next();
  if (result.done) break;
  alert(result.value); // ä¸€ä¸ªæ¥ä¸€ä¸ªåœ°è¾“å‡ºå­—ç¬¦
}
#+end_src

* Array.from(arrayLike/iterable)å¯ä»¥ä»å¯è¿­ä»£å¯¹è±¡å’Œç±»æ•°ç»„å¯¹è±¡ä¸­ç”Ÿæˆä¸€ä¸ªçœŸæ­£çš„æ•°ç»„ï¼Œä»è€Œå¯ä»¥åˆ©ç”¨pop pushç­‰æ•°ç»„çš„æ–¹æ³•ã€‚å¯é€‰å‚æ•°ä¸­å¯ä»¥ä¼ å…¥ä¸€ä¸ªmapFnï¼Œè®¾ç½®æ˜ å°„æ–¹å¼
å®Œæ•´è¯­æ³•ï¼š ~Array.from(obj[, mapFn, thisArg])~

* åŸç”Ÿå­—ç¬¦ä¸²æ–¹æ³•çš„å‘

** str.split()ä¸èƒ½æ­£ç¡®å¤„ç†â€œä»£ç†å¯¹â€å³UTF-16æ‰©å±•å­—ç¬¦ï¼Œè€ŒArray.fromå¯ä»¥ã€‚for...ofä¹Ÿå¯ä»¥
   Array.from()çš„å®ç°æ–¹å¼å¦‚ä¸‹ï¼š
   #+begin_src js
     let str = 'ğ’³ğŸ˜‚';

     let chars = []; // Array.from å†…éƒ¨æ‰§è¡Œç›¸åŒçš„å¾ªç¯
     for (let char of str) {
       chars.push(char);
     }

     alert(chars);
    #+end_src
** åˆ›å»ºæ”¯æŒä»£ç†å¯¹çš„sliceå‡½æ•°
   #+begin_src js
     function slice(str, start, end) {
       return Array.from(str).slice(start, end).join('');
     }

     let str = 'ğ’³ğŸ˜‚ğ©·¶';

     alert( slice(str, 1, 3) ); // ğŸ˜‚ğ©·¶

     // åŸç”Ÿæ–¹æ³•ä¸æ”¯æŒè¯†åˆ«ä»£ç†å¯¹ï¼ˆè¯‘æ³¨ï¼šUTF-16 æ‰©å±•å­—ç¬¦ï¼‰
     alert( str.slice(1, 3) ); // ä¹±ç ï¼ˆä¸¤ä¸ªä¸åŒ UTF-16 æ‰©å±•å­—ç¬¦ç¢ç‰‡æ‹¼æ¥çš„ç»“æœï¼‰
    #+end_src
* map
  è¯­æ³•ï¼š~let testMap = new Map([ key1, value1 ], [ key2, value2])~
  å¯ä»¥æ˜¯ä¸€ä¸ªå¸¦é”®å€¼å¯¹çš„æ•°ç»„ï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶å®ƒå¯è¿­ä»£å¯¹è±¡ã€‚!!!

  æ–¹æ³•å’Œå±æ€§å¦‚ä¸‹ï¼š

  new Map() â€”â€” åˆ›å»º mapã€‚
  map.set(key, value) â€”â€” æ ¹æ®é”®å­˜å‚¨å€¼,è¿”å›ä¿®æ”¹åçš„map
  map.get(key) â€”â€” æ ¹æ®é”®æ¥è¿”å›å€¼ï¼Œå¦‚æœ map ä¸­ä¸å­˜åœ¨å¯¹åº”çš„ keyï¼Œåˆ™è¿”å› =undefined= ã€‚
  map.has(key) â€”â€” å¦‚æœ key å­˜åœ¨åˆ™è¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚
  map.delete(key) â€”â€” åˆ é™¤æŒ‡å®šé”®çš„å€¼ï¼Œå¦‚æœè¢«åˆ é™¤çš„entryå­˜åœ¨ï¼Œè¿”å›trueï¼Œå¦‚æœä¸å­˜åœ¨è¿”å›false
  map.clear() â€”â€” æ¸…ç©º mapã€‚æ²¡æœ‰è¿”å›å€¼
  map.size â€”â€” è¿”å›å½“å‰å…ƒç´ ä¸ªæ•°ã€‚

  æ³¨æ„
  map[key] ä¸æ˜¯ä½¿ç”¨ Map çš„æ­£ç¡®æ–¹å¼
  è™½ç„¶ map[key] ä¹Ÿæœ‰æ•ˆï¼Œä¾‹å¦‚æˆ‘ä»¬å¯ä»¥è®¾ç½® map[key] = 2ï¼Œè¿™æ ·ä¼šå°† map è§†ä¸º JavaScript çš„ plain objectï¼Œå› æ­¤å®ƒæš—å«äº†æ‰€æœ‰ç›¸åº”çš„é™åˆ¶ï¼ˆæ²¡æœ‰å¯¹è±¡é”®ç­‰ï¼‰ã€‚

  æ‰€ä»¥æˆ‘ä»¬åº”è¯¥ä½¿ç”¨ map æ–¹æ³•ï¼šset å’Œ get ç­‰ã€‚
** Map æ˜¯æ€ä¹ˆæ¯”è¾ƒé”®çš„ï¼Ÿ
Map ä½¿ç”¨ SameValueZero ç®—æ³•æ¥æ¯”è¾ƒé”®æ˜¯å¦ç›¸ç­‰ã€‚å®ƒå’Œä¸¥æ ¼ç­‰äºâ€œ===â€å·®ä¸å¤šï¼Œä½†åŒºåˆ«æ˜¯ NaN è¢«çœ‹æˆæ˜¯ç­‰äº NaNã€‚æ‰€ä»¥ NaN ä¹Ÿå¯ä»¥è¢«ç”¨ä½œé”®ã€‚

è¿™ä¸ªç®—æ³•ä¸èƒ½è¢«æ”¹å˜æˆ–è€…è‡ªå®šä¹‰ã€‚
** é“¾å¼è°ƒç”¨ï¼šæ¯ä¸€æ¬¡ map.set è°ƒç”¨éƒ½ä¼šè¿”å› map æœ¬èº«ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¿›è¡Œâ€œé“¾å¼â€è°ƒç”¨
** mapè¿­ä»£
*** è¿”å›å¯è¿­ä»£å¯¹è±¡çš„æ–¹æ³•ï¼š
   map.keys() â€”â€” éå†å¹¶è¿”å›æ‰€æœ‰çš„é”®ï¼ˆreturns an iterable for keysï¼‰ï¼Œ
   map.values() â€”â€” éå†å¹¶è¿”å›æ‰€æœ‰çš„å€¼ï¼ˆreturns an iterable for valuesï¼‰ï¼Œ
   map.entries() â€”â€” éå†å¹¶è¿”å›æ‰€æœ‰çš„å®ä½“ï¼ˆreturns an iterable for entriesï¼‰[key, value]ï¼Œfor..of åœ¨é»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨çš„å°±æ˜¯è¿™ä¸ªã€‚
*** mapçš„è¿­ä»£é¡ºåºï¼Œä¸æ’å…¥å€¼çš„é¡ºåºç›¸åŒ
    è¿­ä»£çš„é¡ºåºä¸æ’å…¥å€¼çš„é¡ºåºç›¸åŒã€‚ä¸æ™®é€šçš„ Object ä¸åŒï¼ŒMap ä¿ç•™äº†æ­¤é¡ºåºã€‚
*** mapçš„forEach()æ–¹æ³•
    #+begin_src js
      // å¯¹æ¯ä¸ªé”®å€¼å¯¹ (key, value) è¿è¡Œ forEach å‡½æ•°
      recipeMap.forEach( (value, key, map) => {
        alert(`${key}: ${value}`); // cucumber: 500 etc
      });
     #+end_src
** mapä¸æ•°ç»„çš„è½¬æ¢
   
*** Object.entries() è¿”å›å¯¹è±¡çš„é”®å€¼å¯¹æ•°ç»„
*** Object.fromEntries() ä»é”®å€¼å¯¹æ•°ç»„åˆ›å»ºå¯¹è±¡
*** ä»å¯¹è±¡åˆ›å»ºmap
    #+begin_src js
      let fruitsObj = {
        apple: 10,
        banana: 11,
        orange: 3,
        tomato: 5
      };
      let fruitsEntries = Object.entries(fruitsObj);
      let fruitsMap = new Map(fruitsEntries);

      fruitsMap.get("orange");
     #+end_src
*** ä»mapåˆ›å»ºå¯¹è±¡
    #+begin_src js
      let hard = "***";
      let medium = "**-";
      let easy = "*--";
      let editorsMap = new Map([
        ["emacs", hard],
        ["vim", hard],
        ["vscode", medium],
        ["notepad", easy]
      ])
      let editorsObj = Object.fromEntries(editorsMap.entries());
      //let editorsObj = Object.fromEntries(editorsMap);
      //ä¸Šé¢çš„ä»£ç ä½œç”¨ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œå› ä¸º Object.fromEntries æœŸæœ›å¾—åˆ°ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œè€Œä¸ä¸€å®šæ˜¯æ•°ç»„ã€‚å¹¶ä¸” map çš„æ ‡å‡†è¿­ä»£ä¼šè¿”å›è·Ÿ map.entries() ä¸€æ ·çš„é”®/å€¼å¯¹ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥è·å¾—ä¸€ä¸ªæ™®é€šå¯¹è±¡ï¼ˆplain objectï¼‰ï¼Œå…¶é”®/å€¼å¯¹ä¸ map ç›¸åŒã€‚

      for (let editorName in editorsObj) {
        console.log(`the editor ${editorName} has the hardness of ${editorsObj[editorName]}`);
      }
     #+end_src
* set
  new Set(iterable) â€”â€” åˆ›å»ºä¸€ä¸ª setï¼Œå¦‚æœæä¾›äº†ä¸€ä¸ª iterable å¯¹è±¡ï¼ˆé€šå¸¸æ˜¯æ•°ç»„ï¼‰ï¼Œå°†ä¼šä»æ•°ç»„é‡Œé¢å¤åˆ¶å€¼åˆ° set ä¸­ã€‚
  set.add(value) â€”â€” æ·»åŠ ä¸€ä¸ªå€¼ï¼Œè¿”å› set æœ¬èº«
  set.delete(value) â€”â€” åˆ é™¤å€¼ï¼Œå¦‚æœ value åœ¨è¿™ä¸ªæ–¹æ³•è°ƒç”¨çš„æ—¶å€™å­˜åœ¨åˆ™è¿”å› true ï¼Œå¦åˆ™è¿”å› falseã€‚
  set.has(value) â€”â€” å¦‚æœ value åœ¨ set ä¸­ï¼Œè¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚
  set.clear() â€”â€” æ¸…ç©º setã€‚
  set.size â€”â€” è¿”å›å…ƒç´ ä¸ªæ•°ã€‚
** setçš„æ€§èƒ½ä¼˜åŠ¿ï¼šSet çš„æ›¿ä»£æ–¹æ³•å¯ä»¥æ˜¯ä¸€ä¸ªç”¨æˆ·æ•°ç»„ï¼Œç”¨ arr.find åœ¨æ¯æ¬¡æ’å…¥å€¼æ—¶æ£€æŸ¥æ˜¯å¦é‡å¤ã€‚ä½†æ˜¯è¿™æ ·æ€§èƒ½ä¼šå¾ˆå·®ï¼Œå› ä¸ºè¿™ä¸ªæ–¹æ³•ä¼šéå†æ•´ä¸ªæ•°ç»„æ¥æ£€æŸ¥æ¯ä¸ªå…ƒç´ ã€‚Set å†…éƒ¨å¯¹å”¯ä¸€æ€§æ£€æŸ¥è¿›è¡Œäº†æ›´å¥½çš„ä¼˜åŒ–ã€‚
** setè¿­ä»£!!!
   set.keys() â€”â€” éå†å¹¶è¿”å›æ‰€æœ‰çš„å€¼ï¼ˆreturns an iterable object for valuesï¼‰ï¼Œ
   set.values() â€”â€” ä¸ set.keys() ä½œç”¨ç›¸åŒï¼Œè¿™æ˜¯ä¸ºäº†å…¼å®¹ Mapï¼Œ
   set.entries() â€”â€” éå†å¹¶è¿”å›æ‰€æœ‰çš„å®ä½“ï¼ˆreturns an iterable object for entriesï¼‰[value, value]ï¼Œå®ƒçš„å­˜åœ¨ä¹Ÿæ˜¯ä¸ºäº†å…¼å®¹ Mapã€‚!!!
*** forEach()
    è¯­æ³•
    #+begin_src js
      let set = new Set(["oranges", "apples", "bananas"]);

      for (let value of set) console.log(value);

      // ä¸ forEach ç›¸åŒï¼š
      set.forEach((value, valueAgain, set) => {
        console.log(value);
      });
     #+end_src
    forEach çš„å›è°ƒå‡½æ•°æœ‰ä¸‰ä¸ªå‚æ•°ï¼šä¸€ä¸ª valueï¼Œç„¶åæ˜¯ åŒä¸€ä¸ªå€¼ valueAgainï¼Œæœ€åæ˜¯ç›®æ ‡å¯¹è±¡ã€‚æ²¡é”™ï¼ŒåŒä¸€ä¸ªå€¼åœ¨å‚æ•°é‡Œå‡ºç°äº†ä¸¤æ¬¡ã€‚

    forEach çš„å›è°ƒå‡½æ•°æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œæ˜¯ä¸ºäº†ä¸ Map å…¼å®¹ã€‚å½“ç„¶ï¼Œè¿™çœ‹èµ·æ¥ç¡®å®æœ‰äº›å¥‡æ€ªã€‚ä½†æ˜¯è¿™å¯¹åœ¨ç‰¹å®šæƒ…å†µä¸‹è½»æ¾åœ°ç”¨ Set ä»£æ›¿ Map å¾ˆæœ‰å¸®åŠ©ï¼Œåä¹‹äº¦ç„¶ã€‚
** å‡ ä¸ªä¾‹å­
*** è¿‡æ»¤å­—è°œ
    [[https://zh.javascript.info/task/filter-anagrams][anagrams]]
    #+begin_src js
      function aclean(arr) {
        let map = new Map();

        for (let word of arr) {
          // å°†å•è¯ split æˆå­—æ¯ï¼Œå¯¹å­—æ¯è¿›è¡Œæ’åºï¼Œä¹‹åå† join å›æ¥
          let sorted = word.toLowerCase().split('').sort().join(''); // (*)
          map.set(sorted, word);
        }

        return Array.from(map.values());
      }

      let arr = ["nap", "teachers", "cheaters", "PAN", "ear", "era", "hectares"];

      alert( aclean(arr) );

      // ä¸ç”¨mapçš„æ–¹å¼

      function aclean(arr) {
        let obj = {};

        for (let i = 0; i < arr.length; i++) {
          let sorted = arr[i].toLowerCase().split("").sort().join("");
          obj[sorted] = arr[i];
        }

        return Object.values(obj);
      }

      let arr = ["nap", "teachers", "cheaters", "PAN", "ear", "era", "hectares"];

      alert( aclean(arr) );
    #+end_src

* set/map.keys()è¿”å›çš„æ˜¯å¯è¿­ä»£å¯¹è±¡ä¸æ˜¯æ•°ç»„ï¼Œæ‰€ä»¥ä¸èƒ½ç”¨pushç­‰æ–¹æ³•ã€‚å¦‚æœæƒ³ç”¨ï¼Œå¯ä»¥ç”¨Array.from()è½¬æ¢åç”¨
* è·å–å¯¹è±¡çš„keysã€valuesã€entriesï¼šObject.keys(obj), Object.values(obj), Object.entries(obj)ï¼Œä¸èƒ½ç›´æ¥ç”¨obj.valuesè¿™ç§å½¢å¼!!!
* for...ofï¼ŒforEachéå†çš„å‘
  å¦‚æœæ•°ç»„æ˜¯ç©ºçš„ï¼Œä¸ä¼šæ‰§è¡Œéå†ã€‚æ¯”å¦‚æˆ‘ä¹‹å‰åšçš„æ³¨å†Œè¡¨çš„ä¾‹å­ï¼š
  å¦‚æœéå†æ³¨å†Œè¡¨ï¼Œå¦‚æœæ³¨å†Œè¡¨å†…æ²¡æœ‰å…ƒç´ ï¼Œæ³¨å†Œè¿›å»ã€‚
  è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘å¯¹æ³¨å†Œè¡¨éå†ã€‚
  éå†å®Œæˆåï¼Œreturn ä¸€ä¸ªtrueã€‚
  æ³¨å†Œè¡¨åˆå§‹å€¼æ˜¯{},ç»“æœæ‰€æœ‰ç»“æœéƒ½è¿”å›trueï¼Œå› ä¸ºç©ºå¯¹è±¡for...ofæ˜¯ä¸æ‰§è¡Œéå†çš„ã€‚
  æ‰€ä»¥ç›´æ¥è¿”å›trueäº†ã€‚
  è¿™æ—¶å€™è¦åœ¨éå†ä¹‹å‰åŠ ä¸Šä¸€ä¸ªåˆ¤æ–­æ¡ä»¶ï¼Œå¦‚æœæ³¨å†Œè¡¨æ˜¯ç©ºçš„ï¼Œç›´æ¥è¿”å›falseã€‚
* weakMap & weakSet
** ä¸¤ä¸ªweakç±»å‹éƒ½åªèƒ½å­˜å‚¨å¯¹è±¡é”®ï¼Œä¸èƒ½å­˜å‚¨primitiveç±»å‹çš„å€¼
** ä¸¤ä¸ªweakç±»å‹çš„æ–¹æ³•æœ‰é™åˆ¶ï¼Œæ— æ³•æ˜¾ç¤ºé•¿åº¦ï¼Œæ— æ³•è¿­ä»£ï¼ˆä¹Ÿå°±æ— æ³•åˆ—å‡ºkeyså’Œvaluesï¼‰
- weakMapçš„æ–¹æ³•
  weakMap.get(key)
  weakMap.set(key, value)
  weakMap.delete(key)
  weakMap.has(key)
- è·Ÿ Set ä¸€æ ·ï¼ŒWeakSet æ”¯æŒ addï¼Œhas å’Œ delete æ–¹æ³•ï¼Œä½†ä¸æ”¯æŒ size å’Œ keys()ï¼Œå¹¶ä¸”ä¸å¯è¿­ä»£ã€‚
** ç”¨ä¾‹ï¼šé¢å¤–çš„æ•°æ®å­˜å‚¨å’Œç¼“å­˜
- å‡å¦‚æˆ‘ä»¬æ­£åœ¨å¤„ç†ä¸€ä¸ªâ€œå±äºâ€å¦ä¸€ä¸ªä»£ç çš„ä¸€ä¸ªå¯¹è±¡ï¼Œä¹Ÿå¯èƒ½æ˜¯ç¬¬ä¸‰æ–¹åº“ï¼Œå¹¶æƒ³å­˜å‚¨ä¸€äº›ä¸ä¹‹ç›¸å…³çš„æ•°æ®ï¼Œé‚£ä¹ˆè¿™äº›æ•°æ®å°±åº”è¯¥ä¸è¿™ä¸ªå¯¹è±¡å…±å­˜äº¡ â€” è¿™æ—¶å€™ WeakMap æ­£æ˜¯æˆ‘ä»¬æ‰€éœ€è¦çš„åˆ©å™¨ã€‚
æˆ‘ä»¬å°†è¿™äº›æ•°æ®æ”¾åˆ° WeakMap ä¸­ï¼Œå¹¶ä½¿ç”¨è¯¥å¯¹è±¡ä½œä¸ºè¿™äº›æ•°æ®çš„é”®ï¼Œé‚£ä¹ˆå½“è¯¥å¯¹è±¡è¢«åƒåœ¾å›æ”¶æœºåˆ¶å›æ”¶åï¼Œè¿™äº›æ•°æ®ä¹Ÿä¼šè¢«è‡ªåŠ¨æ¸…é™¤ã€‚
- å¦å¤–ä¸€ä¸ªæ™®éçš„ä¾‹å­æ˜¯ç¼“å­˜ï¼šå½“ä¸€ä¸ªå‡½æ•°çš„ç»“æœéœ€è¦è¢«è®°ä½ï¼ˆâ€œç¼“å­˜â€ï¼‰ï¼Œè¿™æ ·åœ¨åç»­çš„å¯¹åŒä¸€ä¸ªå¯¹è±¡çš„è°ƒç”¨æ—¶ï¼Œå°±å¯ä»¥é‡ç”¨è¿™ä¸ªè¢«ç¼“å­˜çš„ç»“æœã€‚
#+begin_src js
  // ğŸ“ cache.js
  let cache = new WeakMap();

  // è®¡ç®—å¹¶è®°ç»“æœ
  function process(obj) {
    if (!cache.has(obj)) {
      let result = /* calculate the result for */ obj;

      cache.set(obj, result);
    }

    return cache.get(obj);
  }

  // ğŸ“ main.js
  let obj = {/* some object */};

  let result1 = process(obj);
  let result2 = process(obj);

  // â€¦â€¦ç¨åï¼Œæˆ‘ä»¬ä¸å†éœ€è¦è¿™ä¸ªå¯¹è±¡æ—¶ï¼š
  obj = null;

  // æ— æ³•è·å– cache.sizeï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ª WeakMapï¼Œ
  // è¦ä¹ˆæ˜¯ 0ï¼Œæˆ–å³å°†å˜ä¸º 0
  // å½“ obj è¢«åƒåœ¾å›æ”¶ï¼Œç¼“å­˜çš„æ•°æ®ä¹Ÿä¼šè¢«æ¸…é™¤
#+end_src
* å¯¹è±¡çš„è¿­ä»£å’Œmap/setè¿­ä»£
** è¯­æ³•åŒºåˆ«ï¼šobjectçš„è¿­ä»£æ˜¯Object.keys(obj)ï¼Œmapæ˜¯mapVar.keys()
** è¿”å›å€¼åŒºåˆ«
   |          | Map        | Object        |
   |----------+------------+---------------|
   | è°ƒç”¨è¯­æ³• | map.keys() | Object.keys() |
   | è¿”å›å€¼   | å¯è¿­ä»£é¡¹   | â€œçœŸæ­£çš„æ•°ç»„â€        |
** Object.keys/values/entries ä¼šå¿½ç•¥ symbol å±æ€§
*** å¦‚æœæƒ³è¦å¾—åˆ°symbolå±æ€§
- Object.getOwnPropertySymbolsï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªåªåŒ…å« Symbol ç±»å‹çš„é”®çš„æ•°ç»„
- Reflect.ownKeys(obj)ï¼Œå®ƒä¼šè¿”å› =æ‰€æœ‰= é”®
* æ•°ç»„è§£æ„èµ‹å€¼
** æ·»åŠ é¢å¤–é€—å·ä»¥å¿½ç•¥ä¸è¦çš„å…ƒç´ 
#+begin_src js
// ä¸éœ€è¦ç¬¬äºŒä¸ªå…ƒç´ 
let [firstName, , title] = ["Julius", "Caesar", "Consul", "of the Roman Republic"];

alert( title ); // Consul
#+end_src
** ç­‰å·å³ä¾§å¯ä»¥æ˜¯ä»»ä½•å¯è¿­ä»£å¯¹è±¡
#+begin_src js
let [a, b, c] = "abc"; // ["a", "b", "c"]
let [one, two, three] = new Set([1, 2, 3]);
#+end_src
** ç­‰å·å·¦ä¾§å¯ä»¥ä½¿ç”¨ä»»ä½•å¯ä»¥è¢«èµ‹å€¼çš„â€œä¸œè¥¿â€
#+begin_src js
let user = {};
[user.name, user.surname] = "Ilya Kantor".split(' ');

alert(user.name); // Ilya
#+end_src
** ä¸Object.entries()è”åŠ¨ï¼Œè¿›è¡Œå¾ªç¯æ“ä½œ
#+begin_src js
let user = {
  name: "John",
  age: 30
};

// å¾ªç¯éå†é”®â€”å€¼å¯¹
for (let [key, value] of Object.entries(user)) {
  alert(`${key}:${value}`); // name:John, then age:30
}
#+end_src
** ä¸mapå¯¹è±¡è”åŠ¨ï¼Œè¿›è¡Œå¾ªç¯æ“ä½œ
#+begin_src js
let user = new Map();
user.set("name", "John");
user.set("age", "30");

for (let [key, value] of user) {
  alert(`${key}:${value}`); // name:John, then age:30
}
#+end_src
!!!mapæœ¬èº«å°±æ˜¯å¯è¿­ä»£å¯¹è±¡ï¼Œè¿™é‡Œä¸éœ€è¦ä½¿ç”¨egMap.entries()ï¼Œç›´æ¥ä½¿ç”¨egMapå°±å¯ä»¥
** ...æ“ä½œç¬¦ï¼Œå–å¾—å‰©ä½™å…ƒç´ 
#+begin_src js
let [name1, name2, ...rest] = ["Julius", "Caesar", "Consul", "of the Roman Republic"];

alert(name1); // Julius
alert(name2); // Caesar

// è¯·æ³¨æ„ï¼Œ`rest` çš„ç±»å‹æ˜¯æ•°ç»„
alert(rest[0]); // Consul
alert(rest[1]); // of the Roman Republic
alert(rest.length); // 2
#+end_src
** åŸºäºå¤æ‚è¡¨è¾¾å¼çš„é»˜è®¤å€¼
é»˜è®¤å€¼ç­‰å·å³è¾¹å¯ä»¥æ˜¯ä»»ä½•å¤æ‚è¡¨è¾¾å¼ï¼Œåªæœ‰æ²¡æœ‰è¢«èµ‹å€¼çš„å˜é‡ç­‰å·å³ä¾§çš„è¡¨è¾¾å¼ä¼šè¢«æ±‚å€¼
#+begin_src js
// åªä¼šæç¤ºè¾“å…¥å§“æ°
let [name = prompt('name?'), surname = prompt('surname?')] = ["Julius"];

alert(name);    // Juliusï¼ˆæ¥è‡ªæ•°ç»„ï¼‰
alert(surname); // ä½ è¾“å…¥çš„å€¼
#+end_src
* å¯¹è±¡çš„è§£æ„èµ‹å€¼
** å¦å¤–æŒ‡å®šå˜é‡å
#+begin_src js
let options = {
  title: "Menu",
  width: 100,
  height: 200
};

// { sourceProperty: targetVariable }
let {width: w, height: h, title} = options;

// width -> w
// height -> h
// title -> title

alert(title);  // Menu
alert(w);      // 100
alert(h);      // 200
#+end_src
** å¯¹è±¡è§£æ„èµ‹å€¼é»˜è®¤å€¼è¯­æ³•
#+begin_src js
let options = {
  title: "Menu"
};

let {width: w = 100, height: h = 200, title} = options;

alert(title);  // Menu
alert(w);      // 100
alert(h);      // 200
#+end_src
** å‰©ä½™æ¨¡å¼
ä¸æ•°ç»„çš„å‰©ä½™æ¨¡å¼ä¸åŒï¼Œå¯¹è±¡è§£æ„èµ‹å€¼çš„restæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè€Œæ•°ç»„çš„restæ˜¯ä¸€ä¸ªæ•°ç»„
#+begin_src js
let options = {
  title: "Menu",
  height: 200,
  width: 100
};

// title = åä¸º title çš„å±æ€§
// rest = å­˜æœ‰å‰©ä½™å±æ€§çš„å¯¹è±¡
let {title, ...rest} = options;

// ç°åœ¨ title="Menu", rest={height: 200, width: 100}
alert(rest.height);  // 200
alert(rest.width);   // 100
#+end_src
** ä¸ä½¿ç”¨letæ—¶ä½¿ç”¨è§£æ„èµ‹å€¼çš„å‘
#+begin_src js
let title, width, height;

// è¿™ä¸€è¡Œå‘ç”Ÿäº†é”™è¯¯
{title, width, height} = {title: "Menu", width: 200, height: 100};
#+end_src
å› ä¸ºç­‰å·å‰é¢çš„å¤§æ‹¬å·è¢«jsè§£é‡Šå™¨è®¤ä¸ºæ˜¯ä¸€ä¸ªä»£ç å—ï¼Œå¦‚æœè¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåªè¦ç”¨æ‹¬å·æ‰©èµ·æ¥å°±å¯ä»¥äº†ï¼ˆä¸ç®­å¤´å‡½æ•°çš„ä¾‹å­ç›¸åŒï¼‰ï¼š
#+begin_src js
let title, width, height;

// ç°åœ¨å¯ä»¥äº†
({title, width, height}) = {title: "Menu", width: 200, height: 100};
#+end_src
** åµŒå¥—è§£æ„ï¼ˆæ·±å±‚è§£æ„ï¼‰
- æµ…å±‚çš„å¯¹è±¡æ²¡æœ‰è¢«èµ‹å€¼ï¼Œè§ä¸‹ä¾‹çš„itemså’Œsize
- åµŒå¥—è§£æ„ä»ç„¶å¯ä»¥é‡å‘½åå˜é‡
- åµŒå¥—è§£æ„çš„æ—¶å€™ç­‰å·å·¦ä¾§å’Œå³ä¾§å¿…é¡»æœ‰ç›¸åŒçš„ç»“æ„ï¼ˆæŒ‡çš„æ˜¯å±‚æ¬¡ï¼Œä¸æ˜¯å˜é‡å¤šå°‘ï¼‰
#+begin_src js
  let options = {
    size: {
      width: 100,
      height: 200
    },
    items: ["Cake", "Donut"],
    extra: true
  };

  // ä¸ºäº†æ¸…æ™°èµ·è§ï¼Œè§£æ„èµ‹å€¼è¯­å¥è¢«å†™æˆå¤šè¡Œçš„å½¢å¼
  let {
    size: { // æŠŠ size èµ‹å€¼åˆ°è¿™é‡Œ
      width : w,
      height
    },
    items: [item1, item2], // æŠŠ items èµ‹å€¼åˆ°è¿™é‡Œ
    title = "Menu" // åœ¨å¯¹è±¡ä¸­ä¸å­˜åœ¨ï¼ˆä½¿ç”¨é»˜è®¤å€¼ï¼‰
  } = options;

  console.log(title);  // Menu
  console.log(width);  // 100
  console.log(height); // 200
  console.log(item1);  // Cake
  console.log(item2);  // Donut
  console.log(items);  //error
  console.log(w);      //100
  console.log(size);   //error
#+end_src
* æ—¶é—´ï¼ˆDateç±»å‹ï¼‰
** åŸºç¡€è¯­æ³•
- let testDate = new Date(ms)
å¦‚æœä¸å¸¦å‚æ•°ï¼Œè¿”å›ç°åœ¨çš„æ—¶é—´
- let testDate = new Date(str)
å­—ç¬¦ä¸²çš„å†…å®¹ä¼šè¢«è‡ªåŠ¨è§£æï¼Œç›¸å½“äºå°†ä½¿ç”¨äº†Date.parse(str)çš„è¿”å›å€¼å¸¦å…¥ms
!!!æ‰€ä»¥å¯ä»¥ç›´æ¥ç”¨å¦ä¸€ä¸ªDateç±»å‹æ•°æ®ä½œä¸ºå‚æ•°ä¼ ç»™new Date(date)ï¼Œè¿™åœ¨æ‹·è´æ—¥æœŸçš„æ—¶å€™éå¸¸æœ‰ç”¨

- let testDate = new Date(year, month, date, hours, minutes, seconds, ms)
ä½¿ç”¨å½“å‰æ—¶åŒºä¸­çš„ç»™å®šç»„ä»¶åˆ›å»ºæ—¥æœŸã€‚åªæœ‰å‰ä¸¤ä¸ªå‚æ•°æ˜¯å¿…é¡»çš„
  + year å¿…é¡»æ˜¯å››ä½æ•°ï¼š2013 æ˜¯åˆæ³•çš„ï¼Œ98 æ˜¯ä¸åˆæ³•çš„ã€‚
  + month è®¡æ•°ä» 0ï¼ˆä¸€æœˆï¼‰å¼€å§‹ï¼Œåˆ° 11ï¼ˆåäºŒæœˆï¼‰ç»“æŸã€‚
  + date æ˜¯å½“æœˆçš„å…·ä½“æŸä¸€å¤©ï¼Œå¦‚æœç¼ºå¤±ï¼Œåˆ™ä¸ºé»˜è®¤å€¼ 1ã€‚
  + å¦‚æœ hours/minutes/seconds/ms ç¼ºå¤±ï¼Œåˆ™å‡ä¸ºé»˜è®¤å€¼ 0ã€‚

** æ—¶é—´åŸºå‡†1970-1-1ï¼ŒmsæŒ‡çš„æ˜¯æ—¶é—´åŸºå‡†åˆ°æŒ‡å®šçš„æ—¶é—´çš„æ¯«ç§’æ•°ï¼Œ1970-1-1ä¹‹å‰çš„æ—¶é—´æ˜¯è´Ÿçš„æ—¶é—´æˆ³
** è®¿é—®æ—¥æœŸç»„ä»¶
  -  getFullYear()
     è·å–å¹´ä»½ï¼ˆ4 ä½æ•°ï¼‰
  -  getMonth()
     è·å–æœˆä»½ï¼Œä» 0 åˆ° 11ã€‚
  -  getDate()
     è·å–å½“æœˆçš„å…·ä½“æ—¥æœŸï¼Œä» 1 åˆ° 31ï¼Œè¿™ä¸ªæ–¹æ³•åç§°å¯èƒ½çœ‹èµ·æ¥æœ‰äº›ä»¤äººç–‘æƒ‘ã€‚
  -  getHours()ï¼ŒgetMinutes()ï¼ŒgetSeconds()ï¼ŒgetMilliseconds()
     è·å–ç›¸åº”çš„æ—¶é—´ç»„ä»¶ã€‚
  !!! æ˜¯getFullYear()ï¼Œä¸æ˜¯getYear()
  -  getDay()
     è·å–ä¸€å‘¨ä¸­çš„ç¬¬å‡ å¤©ï¼Œä» 0ï¼ˆæ˜ŸæœŸæ—¥ï¼‰åˆ° 6ï¼ˆæ˜ŸæœŸå…­ï¼‰ã€‚ç¬¬ä¸€å¤©å§‹ç»ˆæ˜¯æ˜ŸæœŸæ—¥ï¼Œåœ¨æŸäº›å›½å®¶å¯èƒ½ä¸æ˜¯è¿™æ ·çš„ä¹ æƒ¯ï¼Œä½†æ˜¯è¿™ä¸èƒ½è¢«æ”¹å˜ã€‚
!!! ä»¥ä¸Šçš„æ‰€æœ‰æ–¹æ³•è¿”å›çš„ç»„ä»¶éƒ½æ˜¯åŸºäºå½“åœ°æ—¶åŒºçš„ã€‚
** è®¿é—®æ—¥æœŸç»„ä»¶çš„UTCå˜ä½“
ä¸å½“åœ°æ—¶åŒºçš„ UTC å¯¹åº”é¡¹ï¼Œå®ƒä»¬ä¼šè¿”å›åŸºäº UTC+0 æ—¶åŒºçš„æ—¥ã€æœˆã€å¹´ç­‰ï¼šgetUTCFullYear()ï¼ŒgetUTCMonth()ï¼ŒgetUTCDay()ã€‚åªéœ€è¦åœ¨ "get" ä¹‹åæ’å…¥ "UTC" å³å¯ã€‚
** æ²¡æœ‰utcå˜ä½“çš„è®¿é—®æ—¥æœŸç»„ä»¶
getTime()
è¿”å›æ—¥æœŸçš„æ—¶é—´æˆ³ â€”â€” ä» 1970-1-1 00:00:00 UTC+0 å¼€å§‹åˆ°ç°åœ¨æ‰€ç»è¿‡çš„æ¯«ç§’æ•°ã€‚

getTimezoneOffset()
è¿”å› UTC ä¸æœ¬åœ°æ—¶åŒºä¹‹é—´çš„æ—¶å·®ï¼Œä»¥ =åˆ†é’Ÿ= ä¸ºå•ä½ï¼š
** è®¾ç½®æ—¥æœŸç»„ä»¶
setFullYear(year, [month], [date])
setMonth(month, [date])
setDate(date)
setHours(hour, [min], [sec], [ms])
setMinutes(min, [sec], [ms])
setSeconds(sec, [ms])
setMilliseconds(ms)
setTime(milliseconds)ï¼ˆä½¿ç”¨è‡ª 1970-01-01 00:00:00 UTC+0 ä»¥æ¥çš„æ¯«ç§’æ•°æ¥è®¾ç½®æ•´ä¸ªæ—¥æœŸï¼‰

é™¤äº†setTime(ms)éƒ½æœ‰utcå˜ä½“

** æ—¶é—´çš„è‡ªåŠ¨æ ¡å‡†ï¼ˆå¿«é€Ÿè·å¾—æŸä¸€æ—¥æœŸåçš„æ—¥æœŸï¼‰
*** æ—¶é—´è¶…å‡ºèŒƒå›´ä¼šè¢«è‡ªåŠ¨è°ƒæ•´
#+begin_src js
let date = new Date(2013, 0, 32); // 32 Jan 2013 ?!?
alert(date); // â€¦â€¦æ˜¯ 1st Feb 2013!
#+end_src
*** å¿«é€Ÿè·å¾—æ—¶é—´
#+begin_src js
let date = new Date(2016, 1, 28);
date.setDate(date.getDate() + 2);

alert( date ); // 1 Mar 2016
#+end_src
*** æ—¶é—´å¯ä»¥è®¾ç½®ä¸ºè´Ÿå€¼
#+begin_src js
let date = new Date(2016, 0, 2); // 2016 å¹´ 1 æœˆ 2 æ—¥

date.setDate(1); // è®¾ç½®ä¸ºå½“æœˆçš„ç¬¬ä¸€å¤©
alert( date );

date.setDate(0); // å¤©æ•°æœ€å°å¯ä»¥è®¾ç½®ä¸º 1ï¼Œæ‰€ä»¥è¿™é‡Œè®¾ç½®çš„æ˜¯ä¸Šä¸€æœˆçš„æœ€åä¸€å¤©
alert( date ); // 31 Dec 2015
#+end_src
** æ—¥æœŸè½¬åŒ–ä¸ºæ•°å­—å’Œæ—¥æœŸå·®å€¼
*** è½¬åŒ–ä¸ºæ•°å­—
#+begin_src js
let date = new Date();
alert(+date); // ä»¥æ¯«ç§’ä¸ºå•ä½çš„æ•°å€¼ï¼Œä¸ä½¿ç”¨ date.getTime() çš„ç»“æœç›¸åŒ
#+end_src
*** æ—¶é—´å·®å€¼
æ—¥æœŸç›¸å‡çš„ç»“æœæ˜¯ä»¥msä¸ºå•ä½çš„æ—¶é—´å·®
#+begin_src js
let start = new Date(); // å¼€å§‹æµ‹é‡æ—¶é—´

// do the job
for (let i = 0; i < 100000; i++) {
  let doSomething = i * i * i;
}

let end = new Date(); // ç»“æŸæµ‹é‡æ—¶é—´

alert( `The loop took ${end - start} ms` );
#+end_src
** Date.now()ä¸ä¼šåˆ›å»ºå¯¹è±¡ï¼Œä¼šåˆ›å»ºä¸€ä¸ª1970-1-1åˆ°ç°åœ¨çš„æ—¶é—´æˆ³ï¼ˆnumberç±»å‹ï¼‰
å› æ­¤å®ƒæ›´å¿«ï¼Œè€Œä¸”ä¸ä¼šå¯¹åƒåœ¾å¤„ç†é€ æˆé¢å¤–çš„å‹åŠ›ã€‚

è¿™ç§æ–¹æ³•å¾ˆå¤šæ—¶å€™å› ä¸ºæ–¹ä¾¿ï¼Œåˆæˆ–æ˜¯å› æ€§èƒ½æ–¹é¢çš„è€ƒè™‘è€Œè¢«é‡‡ç”¨ï¼Œä¾‹å¦‚ä½¿ç”¨ JavaScript ç¼–å†™æ¸¸æˆæˆ–å…¶ä»–çš„ç‰¹æ®Šåº”ç”¨åœºæ™¯ã€‚
** Date.parse()
å­—ç¬¦ä¸²çš„æ ¼å¼åº”è¯¥ä¸ºï¼šYYYY-MM-DDTHH:mm:ss.sssZï¼Œå…¶ä¸­ï¼š

- YYYY-MM-DD â€”â€” æ—¥æœŸï¼šå¹´-æœˆ-æ—¥ã€‚
- å­—ç¬¦ "T" æ˜¯ä¸€ä¸ªåˆ†éš”ç¬¦ã€‚
- HH:mm:ss.sss â€”â€” æ—¶é—´ï¼šå°æ—¶ï¼Œåˆ†é’Ÿï¼Œç§’ï¼Œæ¯«ç§’ã€‚
- å¯é€‰å­—ç¬¦ 'Z' ä¸º +-hh:mm æ ¼å¼çš„æ—¶åŒºã€‚å•ä¸ªå­—ç¬¦ Z ä»£è¡¨ UTC+0 æ—¶åŒºã€‚
- ç®€çŸ­å½¢å¼ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œæ¯”å¦‚ YYYY-MM-DD æˆ– YYYY-MMï¼Œç”šè‡³å¯ä»¥æ˜¯ YYYYã€‚

Date.parse(str) è°ƒç”¨ä¼šè§£æç»™å®šæ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œå¹¶è¿”å›æ—¶é—´æˆ³ï¼ˆè‡ª 1970-01-01 00:00:00 èµ·æ‰€ç»è¿‡çš„æ¯«ç§’æ•°ï¼‰ã€‚å¦‚æœç»™å®šå­—ç¬¦ä¸²çš„æ ¼å¼ä¸æ­£ç¡®ï¼Œåˆ™è¿”å› NaNã€‚
** performance.now()æ–¹æ³•æ¥ç»™å‡ºä»é¡µé¢åŠ è½½å¼€å§‹çš„ä»¥æ¯«ç§’ä¸ºå•ä½çš„å¾®ç§’æ•°ï¼ˆç²¾ç¡®åˆ°æ¯«ç§’çš„å°æ•°ç‚¹åä¸‰ä½ï¼‰
* JSON
** JSON.stringify()
ä¼šè¢«è·³è¿‡javascriptæ•°æ®ç±»å‹
- å‡½æ•°ã€æ–¹æ³•
- Symbolå±æ€§
- undefinedæ•°æ®

!!!ä¸å¾—æœ‰å¾ªç¯å¼•ç”¨
*** JSON.stringify(value[, replacer, space])çš„replacerè¯­æ³•
#+begin_src js
let room = {
  number: 23
};

let meetup = {
  title: "Conference",
  participants: [{name: "John"}, {name: "Alice"}],
  place: room // meetup å¼•ç”¨äº† room
};

room.occupiedBy = meetup; // room å¼•ç”¨äº† meetup

alert( JSON.stringify(meetup, function replacer(key, value) {
  alert(`${key}: ${value}`);
  return (key == 'occupiedBy') ? undefined : value;
}));

/* key:value pairs that come to replacer:
:             [object Object]
title:        Conference
participants: [object Object],[object Object]
0:            [object Object]
name:         John
1:            [object Object]
name:         Alice
place:        [object Object]
number:       23
*/
#+end_src
*** ä¸Šä¾‹ä¸­æ­ç¤ºäº†JSON.stringify()replacerçš„è½¬æ¢é¡ºåºï¼š
- å…ˆæŠŠå¯¹è±¡æ•´ä¸ªå¸¦å…¥ï¼Œkeyæ˜¯ç©ºçš„ï¼Œvalueæ˜¯è‡ªèº«
- ç„¶åæ˜¯entries
- é‡åˆ°å¤æ‚æ•°æ®ç±»å‹ï¼Œå…ˆæŠŠæ•°æ®æœ¬èº«å¸¦å…¥ï¼Œç„¶åæ·±å…¥

å¦‚æœå€¼è¢«è·³è¿‡äº†ï¼Œreturnä¸º undefinedã€‚
*** è‡ªå®šä¹‰toJSON()æ–¹æ³•
- JSON.stringify()é‡åˆ°è‡ªå®šä¹‰toJSONä»£ç æ—¶ï¼Œä¼šç›´æ¥è°ƒç”¨ï¼Œå¹¶æŠŠtoJSONçš„è¿”å›å€¼ä½œä¸ºè½¬æ¢ç»“æœï¼ˆæˆ–æ˜¯ç›¸åº”keyçš„valueï¼‰
** JSON.parse()
*** reviver
ä¾‹å­ï¼š
#+begin_src js
let str = '{"title":"Conference","date":"2017-11-30T12:00:00.000Z"}';

let meetup = JSON.parse(str, function(key, value) {
  if (key == 'date') return new Date(value);
  return value;
});

alert( meetup.date.getDate() ); //è½¬æ¢åçš„dateé”®ç°åœ¨å¯¹åº”çš„valueæ˜¯Dateæ•°æ®ç±»å‹äº†
#+end_src
** ä¾‹å­ï¼šæ’é™¤å¾ªç¯å¼•ç”¨
#+begin_src js
  let room = {
    number: 23
  };

  let meetup = {
    title: "Conference",
    occupiedBy: [{name: "John"}, {name: "Alice"}],
    place: room
  };

  // å¾ªç¯å¼•ç”¨
  room.occupiedBy = meetup;
  meetup.self = meetup;


  alert( JSON.stringify(meetup, function replacer(key, value) {
    return (key != "" && value == meetup) ? undefined : value;
  }));
  //è¿™é‡Œé™¤äº†åˆ¤æ–­valueæ˜¯ä¸æ˜¯meetupï¼Œè¿˜è¦åˆ¤æ–­æ˜¯ä¸æ˜¯ç©ºé”®ã€‚å› ä¸ºJSON.stringify()çš„replaceræ˜¯ä» ~"":meetup~ å¼€å§‹è¿­ä»£çš„ !!!
  /* ç»“æœåº”è¯¥æ˜¯ï¼š
  {
    "title":"Conference",
    "occupiedBy":[{"name":"John"},{"name":"Alice"}],
    "place":{"number":23}
  }
  ,*/
#+end_src
* è¾“å‡ºä¸€ä¸ªå•é“¾è¡¨
#+begin_src js
  let list = {
    value: 1,
    next: {
      value: 2,
      next: {
        value: 3,
        next: {
          value: 4,
          next: null
        }
      }
    }
  };
  //æ­£å‘è¾“å‡ºé€’å½’è§£æ³•
  function printList(list) {

    alert(list.value); // è¾“å‡ºå½“å‰å…ƒç´ 

    if (list.next) {
      printList(list.next); // é“¾è¡¨ä¸­å…¶ä½™éƒ¨åˆ†åŒç†
    }

  }

  printList(list);
  //æ­£å‘è¾“å‡ºå¾ªç¯è§£æ³•
  function printList(list) {
    let tmp = list;

    while (tmp) {
      alert(tmp.value);
      tmp = tmp.next;
    }

  }

  printList(list);
  //åå‘è¾“å‡ºé€’å½’è§£æ³•
  function printBackward(list) {
    if (list.next) {
      printBackward(list.next)
    }
    console.log(list.value);
  }
  //åå‘è¾“å‡ºå¾ªç¯è§£æ³•
  function printReverseList(list) {
    let arr = [];
    let tmp = list;

    while (tmp) {
      arr.push(tmp.value);
      tmp = tmp.next;
    }

    for (let i = arr.length - 1; i >= 0; i--) {
      alert( arr[i] );
    }
  }

  printReverseList(list);
  //é€’å½’è§£æ³•å®é™…ä¸Šä¹Ÿæ˜¯è¿™æ ·åšçš„ï¼šå®ƒé¡ºç€é“¾è¡¨ï¼Œè®°å½•æ¯ä¸€ä¸ªåµŒå¥—è°ƒç”¨é‡Œé“¾è¡¨çš„å…ƒç´ ï¼ˆåœ¨æ‰§è¡Œä¸Šä¸‹æ–‡å †æ ˆé‡Œï¼‰ï¼Œç„¶åè¾“å‡ºå®ƒä»¬ã€‚
#+end_src
* restå‚æ•°å¿…é¡»æ”¾åˆ°å‚æ•°åˆ—è¡¨æœ€åï¼šfunction testFun(arg1, arg2, ...argN){}
* argumentsç±»ä¼¼restå‚æ•°ï¼Œä½†æ˜¯argumentsä¸æ˜¯æ•°ç»„å¯¹è±¡ã€‚ç®­å¤´å‡½æ•°æ²¡æœ‰arguments
* spreadè¯­æ³•
** æŠŠæ•°ç»„è½¬æ¢ä¸ºå‚æ•°åˆ—è¡¨
#+begin_src js
let arr = [3, 5, 1];

alert( Math.max(...arr) ); // 5ï¼ˆspread è¯­æ³•æŠŠæ•°ç»„è½¬æ¢ä¸ºå‚æ•°åˆ—è¡¨ï¼‰
#+end_src
** spreadè¯­æ³•æ¥æ”¶çš„å‚æ•°ä¼šè¢«ä¿å­˜åœ¨arrï¼Œarræ˜¯ä¸€ä¸ªçœŸæ­£çš„æ•°ç»„ã€‚è¿™ä¸€ç‚¹ä¸arugmentså˜é‡ä¸åŒ
** ä¼ é€’å¤šä¸ªå¯è¿­ä»£å¯¹è±¡
#+begin_src js
let arr1 = [1, -2, 3, 4];
let arr2 = [8, 3, -8, 1];

alert( Math.max(...arr1, ...arr2) ); // 8
#+end_src
** spreadä¸å¸¸è§„å€¼ç»“åˆä½¿ç”¨
#+begin_src js
let arr1 = [1, -2, 3, 4];
let arr2 = [8, 3, -8, 1];

alert( Math.max(1, ...arr1, 2, ...arr2, 25) ); // 25
#+end_src
** ä½¿ç”¨ spread è¯­æ³•æ¥åˆå¹¶æ•°ç»„
#+begin_src js
let arr = [3, 5, 1];
let arr2 = [8, 9, 15];

let merged = [0, ...arr, 2, ...arr2];

alert(merged); // 0,3,5,1,2,8,9,15ï¼ˆ0ï¼Œç„¶åæ˜¯ arrï¼Œç„¶åæ˜¯ 2ï¼Œç„¶åæ˜¯ arr2ï¼‰
#+end_src
** spreadè¯­æ³•ä¸­ ~...~ åé¢å¯ä»¥æ˜¯ä»»ä½•å¯è¿­ä»£å¯¹è±¡ï¼Œä¸åªæ˜¯æ•°ç»„ï¼Œä¾‹å¦‚å­—ç¬¦ä¸²ã€å®šä¹‰äº†Symbol.iteratorçš„æ™®é€šå¯¹è±¡ç­‰ã€‚
** spreadè¯­æ³•å’ŒArray.from()çš„åŒºåˆ«ï¼šArray.from()å¯ä»¥è½¬åŒ–array-likeå¯¹è±¡ï¼Œè€Œspreadè¯­æ³•ä¸èƒ½ã€‚æ‰€ä»¥Array.from()åº”ç”¨èŒƒå›´æ›´å¹¿
** spreadè¯­æ³•ä»£æ›¿Object.assign()å†™æ³•æ›´ç®€æ´
*** Object.assign([], arr) <==> [...arr]
*** Object.assign({}, obj) <==> {...obj}
* ä»£ç å—å†…å£°æ˜çš„å˜é‡ä»…åœ¨ä»£ç å—å†…å¯è§
ä»£ç å—æœ‰å…¶è‡ªèº«çš„è¯æ³•ç¯å¢ƒï¼Œå—ä¹‹å¤–ï¼ˆæˆ–å¦ä¸€ä¸ªè„šæœ¬å†…ï¼‰çš„ä»£ç è®¿é—®ä¸åˆ°ä»£ç å—å†…çš„å˜é‡
#+begin_src js
{
  // ä½¿ç”¨åœ¨ä»£ç å—å¤–ä¸å¯è§çš„å±€éƒ¨å˜é‡åšä¸€äº›å·¥ä½œ

  let message = "Hello"; // åªåœ¨æ­¤ä»£ç å—å†…å¯è§

  alert(message); // Hello
}

alert(message); // Error: message is not defined
#+end_src
æ‰€ä»¥å¯ä»¥ä½¿ç”¨ä»£ç å—éš”ç¦»å˜é‡å£°æ˜
* é—­åŒ…ä¸v8å¼•æ“ä¼˜åŒ–
ç†è®ºä¸Šå½“å‡½æ•°å¯è¾¾æ—¶ï¼Œå®ƒå¤–éƒ¨çš„æ‰€æœ‰å˜é‡ä¹Ÿéƒ½å°†å­˜åœ¨ã€‚

ä½†åœ¨å®é™…ä¸­ï¼ŒJavaScript å¼•æ“ä¼šè¯•å›¾ä¼˜åŒ–å®ƒã€‚å®ƒä»¬ä¼šåˆ†æå˜é‡çš„ä½¿ç”¨æƒ…å†µï¼Œå¦‚æœä»ä»£ç ä¸­å¯ä»¥æ˜æ˜¾çœ‹å‡ºæœ‰æœªä½¿ç”¨çš„å¤–éƒ¨å˜é‡ï¼Œé‚£ä¹ˆå°±ä¼šå°†å…¶åˆ é™¤ã€‚

åœ¨ V8ï¼ˆChromeï¼ŒOperaï¼‰ä¸­çš„ä¸€ä¸ªé‡è¦çš„å‰¯ä½œç”¨æ˜¯ï¼Œæ­¤ç±»å˜é‡åœ¨è°ƒè¯•ä¸­å°†ä¸å¯ç”¨ã€‚
#+begin_src js
let value = "Surprise!";

function f() {
  let value = "the closest value";

  function g() {
    debugger; // åœ¨ console ä¸­ï¼šè¾“å…¥ alert(value); Surprise!
  }

  return g;
}

let g = f();
g();
#+end_src

è¾“å‡ºsurpriseæ˜¯å› ä¸ºv8å¼•æ“ä¼˜åŒ–æ‰äº†f()å‡½æ•°å†…çš„valueå˜é‡

#+begin_src js
let value = "Surprise!";

function f() {
  let value = "the closest value";

  function g() {
    let valueCopy = value;
    debugger; // åœ¨ console ä¸­ï¼šè¾“å…¥ alert(value); the closest value
  }

  return g;
}

let g = f();
g();
#+end_src

è¿™æ®µä¿®æ”¹åçš„ä»£ç ä¸­ä½¿ç”¨äº†fè¯æ³•ç¯å¢ƒä¸­çš„valueå˜é‡ï¼Œæ‰€ä»¥v8å¼•æ“æ²¡æœ‰æŠŠvalueå›æ”¶ã€‚

** ä¸€ä¸ªå˜é‡å¯è§æ€§çš„å‘!!!
[[https://zh.javascript.info/task/let-scope][å˜é‡å­˜åœ¨å—ï¼Ÿ]]
#+begin_src js
  //çœ‹è¿™æ®µä»£ç 
  let x = 1;
  function func() {
    console.log(x);
    let x = 2;
  }
  func();//é”™è¯¯

  /* ä»ç¨‹åºæ‰§è¡Œè¿›å…¥ä»£ç å—ï¼ˆæˆ–å‡½æ•°ï¼‰çš„é‚£ä¸€åˆ»èµ·ï¼Œå˜é‡å°±å¼€å§‹è¿›å…¥â€œæœªåˆå§‹åŒ–â€çŠ¶æ€ã€‚å®ƒä¸€ç›´ä¿æŒæœªåˆå§‹åŒ–çŠ¶æ€ï¼Œç›´è‡³ç¨‹åºæ‰§è¡Œåˆ°ç›¸åº”çš„ let è¯­å¥ã€‚
     æ¢å¥è¯è¯´ï¼Œæ‰§è¡Œåˆ°funcçš„æ—¶å€™ï¼Œè§£é‡Šå™¨çŸ¥é“æœ¬è¯æ³•ç¯å¢ƒä¸­æœ‰xè¿™ä¸ªå˜é‡ï¼Œæ‰€ä»¥ä¸å¾€ä¸Šæ‰¾äº†ï¼Œä½†æ˜¯æœ¬è¯æ³•ç¯å¢ƒä¸­çš„å˜é‡è¿˜æ²¡æœ‰å£°æ˜ï¼Œæ‰€ä»¥å®ƒåˆæ‰¾ä¸åˆ°äº†ã€‚å°±ä¼šå‡ºç°é”™è¯¯: Cannot access 'x' before initialization
  ,*/
#+end_src
** å‡½æ•°å¤§å†›!!!
   #+begin_src js
     function makeFun() {
       i = 1;
       let fun = function() {
         console.log(i);
       };
       i++;
       return fun;
     }
     makeFun()();//è¾“å‡º4ï¼Œå› ä¸ºè°ƒç”¨makeFun()()æ—¶ï¼ŒmakeFunå·²ç»æ‰§è¡Œå®Œæ¯•äº†ï¼Œi=4
   #+end_src

   å‡½æ•°å¤§å†›çš„ä¾‹å­ï¼š
   #+begin_src js
   function makeArmy() {
  let shooters = [];

  let i = 0;
  while (i < 10) {
    let shooter = function() { // shooter å‡½æ•°
      alert( i ); // åº”è¯¥æ˜¾ç¤ºå…¶ç¼–å·
    };
    shooters.push(shooter);
    i++;
  }

  return shooters;
}

let army = makeArmy();

army[0](); // ç¼–å·ä¸º 0 çš„ shooter å€¼ä¸º 10
army[5](); // ç¼–å·ä¸º 5 çš„ shooter å€¼ä¹Ÿæ˜¯ 10â€¦â€¦
// ... æ‰€æœ‰çš„ shooter çš„å€¼éƒ½æ˜¯ 10ï¼Œè€Œä¸æ˜¯ä»–ä»¬çš„ç¼–å· 0, 1, 2, 3...
   #+end_src
å‡ºç°é—®é¢˜çš„åŸå› ä¸ä¸Šä¾‹makeFunç›¸åŒï¼Œå‡½æ•°æ‰§è¡Œå®Œæ¯•çš„æ—¶å€™ï¼Œi=10ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¦æŠŠiæŒªåˆ°æ›´å†…éƒ¨çš„ä½œç”¨åŸŸä¸­ï¼š
#+begin_src js
function makeArmy() {
  let shooters = [];

  for (let i = 0; i < 10; i++) { //æ­¤æ—¶iä½œç”¨åŸŸæ˜¯forçš„å¤§æ‹¬å·ï¼Œç”Ÿæˆçš„æ¯ä¸ªshooteréƒ½è®°ä½äº†å…¶outerä½œç”¨åŸŸä¸­çš„å•ç‹¬çš„iå€¼
    let shooter = function() { // shooter å‡½æ•°
      alert( i ); // åº”è¯¥æ˜¾ç¤ºå…¶ç¼–å·
    };
    shooters.push(shooter);
  }

  return shooters;
}

let army = makeArmy();

army[0](); // ç¼–å·ä¸º 0 çš„ shooter å€¼ä¸º 10
army[5](); // ç¼–å·ä¸º 5 çš„ shooter å€¼ä¹Ÿæ˜¯ 10â€¦â€¦
// ... æ‰€æœ‰çš„ shooter çš„å€¼éƒ½æ˜¯ 10ï¼Œè€Œä¸æ˜¯ä»–ä»¬çš„ç¼–å· 0, 1, 2, 3...
#+end_src
* varå’Œlet
** varï¼šå˜é‡æå‡ï¼Œç”¨æ¨¡ä»¿å—çº§ä½œç”¨åŸŸæ¥è§„é¿
** letï¼šä¸æ˜¯å…¨å±€å¯¹è±¡çš„å±æ€§
* å…¨å±€å¯¹è±¡ï¼šwindow/global/globalThis
** ä½¿ç”¨å…¨å±€å¯¹è±¡æ¥æµ‹è¯•å¯¹ç°ä»£è¯­è¨€åŠŸèƒ½çš„æ”¯æŒ
   #+begin_src js
   if (!window.Promise) {
  alert("Your browser is really old!");
}
    #+end_src
* å‡½æ•°å¯¹è±¡åŠå‘½åå‡½æ•°è¡¨è¾¾å¼
** åˆ©ç”¨å‡½æ•°å¯¹è±¡åŠå±æ€§åˆ¶ä½œè®¡æ—¶å™¨ï¼Œä»£æ›¿é—­åŒ…è®¡æ—¶å™¨
#+begin_src js
  function makeCounterC(){
    //é—­åŒ…çš„è®¡æ—¶å™¨ç”Ÿæˆå™¨
    let counter = 0;
    return function(){
      return counter++;
    }

  }

  function makeCounterE(){
    //è‡ªå®šä¹‰è®¡æ—¶å™¨ç”Ÿæˆå™¨
    let counterFun = function(){
      return counterFun.counter++;
    }
    counterFun.counter = 0;
    return counterFun;
  }
#+end_src
!!!äºŒè€…çš„ä¸åŒæ˜¯è‡ªå®šä¹‰å±æ€§è®¡æ—¶å™¨çš„counterå±æ€§å¯ä»¥åœ¨å¤–éƒ¨ä¿®æ”¹ï¼Œç›´æ¥ä¿®æ”¹counterE.counterå°±å¯ä»¥äº†ã€‚
ä½†æ˜¯é—­åŒ…ä¹Ÿå¯ä»¥é€šè¿‡è‡ªå®šä¹‰å‚æ•°æ¥è¾¾åˆ°è¿™ä¸ªæ•ˆæœï¼š
#+begin_src js
  function makeCounter(){
    let count = 0;
    return function(option) {
      switch (option) {
      case undefined:
        return count++;
        break;
      case "restore":
        count = 0;
        return count;
        break;
      }
    }
  }
#+end_src
ä¸€æ ·çš„ä¸æ˜¯å˜›ï¼Ÿè€Œä¸”å¯ä»¥é€šè¿‡é—­åŒ…ç®¡ç†è®¡æ•°å˜é‡ï¼Œé˜²æ­¢å¤–éƒ¨ä¿®æ”¹ã€‚
* !!!å‘½åå‡½æ•°è¡¨è¾¾å¼ï¼šå‡½æ•°å†…éƒ¨è°ƒç”¨è‡ªå·±æ—¶éå¸¸å¥½çš„æ–¹å¼
#+begin_src js
  let funcName = function realFuncName(helloStr) {
    if (helloStr) {
      console.log(helloStr);
    } else {
      realFuncName("you have entered nothing babe!");
    }
  };
#+end_src
** å…è®¸å‡½æ•°é€šè¿‡NFEè°ƒç”¨è‡ªå·±
** NFEå¤–éƒ¨ä¸å¯è§ï¼Œåªæœ‰å‡½æ•°å†…éƒ¨æ‰å¯è§
å¥½å¤„æ˜¯å¦‚æœå‡½æ•°è¢«èµ‹å€¼ç»™äº†åˆ«çš„å˜é‡åï¼Œä¸å½±å“å†…éƒ¨è°ƒç”¨
** ä¸ºcounteræ·»åŠ setå’Œdecreaseæ–¹æ³•ï¼ˆé—­åŒ…æ³•ï¼‰
!!!è¿™é‡Œçš„é‡ç‚¹æ˜¯ï¼Œå‡½æ•°çš„æ–¹æ³•å’Œå‡½æ•°å…±äº«ä¸€ä¸ªå¤–éƒ¨è¯æ³•ç¯å¢ƒ
#+begin_src js
function makeCounter() {
  let count = 0;

  function counter() {
    return count++;
  }

  counter.set = value => count = value;

  counter.decrease = () => count--;

  return counter;
}
#+end_src
** !!ä»»æ„æ•°é‡æ‹¬å·æ±‚å’Œ
#+begin_src js
  function sum(numInit) {
    let accu = numInit;
    adder.toString = () => accu;
    function adder(num){
      accu+=num;
      return adder;
    }
    return adder;
  }
#+end_src
*** !!!è¿™ä¸ªä¾‹å­ä¸­æ²¡æœ‰é€’å½’ï¼returnçš„æ˜¯å‡½æ•°adderï¼Œä½†æ˜¯å¹¶æ²¡æœ‰è°ƒç”¨å®ƒï¼Œè¿™åªæ˜¯é—­åŒ…ï¼Œä¸æ˜¯é€’å½’ã€‚
* new Function()è¯­æ³•
è¯­æ³•ï¼š
#+begin_src js
let func = new Function ([arg1, arg2, ...argN], functionBody);
#+end_src
** ä¸‹åˆ—ä¸‰ç§å£°æ˜ä½œç”¨ç›¸åŒ
#+begin_src js
new Function('a', 'b', 'return a + b'); // åŸºç¡€è¯­æ³•
new Function('a,b', 'return a + b'); // é€—å·åˆ†éš”
new Function('a , b', 'return a + b'); // é€—å·å’Œç©ºæ ¼åˆ†éš”
#+end_src
** !!!new Functionè¯­æ³•æ²¡æœ‰é—­åŒ…
#+begin_src js
function getFunc() {
  let value = "test";

  let func = new Function('alert(value)');

  return func;
}

getFunc()(); // error: value is not defined
#+end_src
!!!å¦‚æœæˆ‘ä»¬ä½¿ç”¨ new Function åˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆè¯¥å‡½æ•°çš„ [[Environment]] å¹¶ä¸æŒ‡å‘å½“å‰çš„è¯æ³•ç¯å¢ƒï¼Œè€Œæ˜¯æŒ‡å‘å…¨å±€ç¯å¢ƒã€‚
ä¾‹å­ï¼š
#+begin_src js
let a = 1;
let func = new Funtion("arg", "console.log(arg+a);");
func(1); //2
//å› ä¸ºaåœ¨å…¨å±€ç¯å¢ƒï¼Œæ‰€ä»¥funcå¯ä»¥è®¿é—®
#+end_src
* setTimeout()å’ŒsetInterval()
è¯­æ³•ï¼š
#+begin_src js
let timerId = setTimeout(func|code, [delay], [arg1], [arg2], ...)
#+end_src
** clearTimeout(timerId)ï¼Œå–æ¶ˆè°ƒåº¦ã€‚ä½†æ˜¯timerIdçš„å€¼ä¸ä¼šè¢«åˆ é™¤
** clearInterval(timerId)
** å‘¨æœŸæ€§è°ƒåº¦çš„ä¸¤ç§æ–¹å¼ï¼š
*** åµŒå¥—setTimeout
#+begin_src js
  function runCode(){}
  let timerId = setTimeout(function run(){
    runCode();
    let newTimerId = setTimeout(run, 1000);
  }, 1000);
#+end_src
*** setInterval
** åƒåœ¾å›æ”¶å’Œ setInterval/setTimeout å›è°ƒï¼ˆcallbackï¼‰
*** å½“ä¸€ä¸ªå‡½æ•°ä¼ å…¥ setInterval/setTimeout æ—¶ï¼Œå°†ä¸ºå…¶åˆ›å»ºä¸€ä¸ªå†…éƒ¨å¼•ç”¨ï¼Œå¹¶ä¿å­˜åœ¨è°ƒåº¦ç¨‹åºä¸­ã€‚è¿™æ ·ï¼Œå³ä½¿è¿™ä¸ªå‡½æ•°æ²¡æœ‰å…¶ä»–å¼•ç”¨ï¼Œä¹Ÿèƒ½é˜²æ­¢åƒåœ¾å›æ”¶å™¨ï¼ˆGCï¼‰å°†å…¶å›æ”¶ã€‚
*** å‡½æ•°æ‰§è¡Œå®Œæ¯•åï¼ŒtimerIdè¿˜åœ¨
*** é›¶å»¶æ—¶å®é™…ä¸Šä¸ä¸º0
æµè§ˆå™¨ä¼šå°† setTimeout æˆ– setInterval çš„äº”å±‚æˆ–æ›´å¤šå±‚åµŒå¥—è°ƒç”¨ï¼ˆè°ƒç”¨äº”æ¬¡ä¹‹åï¼‰çš„æœ€å°å»¶æ—¶é™åˆ¶åœ¨ 4msã€‚è¿™æ˜¯å†å²é—ç•™é—®é¢˜ã€‚
å¯¹äºæœåŠ¡ç«¯çš„ JavaScriptï¼Œå°±æ²¡æœ‰è¿™ä¸ªé™åˆ¶ï¼Œå¹¶ä¸”è¿˜æœ‰å…¶ä»–è°ƒåº¦å³æ—¶å¼‚æ­¥ä»»åŠ¡çš„æ–¹å¼ã€‚ä¾‹å¦‚ Node.js çš„ setImmediateã€‚å› æ­¤ï¼Œè¿™ä¸ªæé†’åªæ˜¯é’ˆå¯¹æµè§ˆå™¨ç¯å¢ƒçš„ã€‚
#+begin_src js
let start = Date.now();
let times = [];

setTimeout(function run() {
  times.push(Date.now() - start); // ä¿å­˜å‰ä¸€ä¸ªè°ƒç”¨çš„å»¶æ—¶

  if (start + 100 < Date.now()) alert(times); // 100 æ¯«ç§’ä¹‹åï¼Œæ˜¾ç¤ºå»¶æ—¶ä¿¡æ¯
  else setTimeout(run); // å¦åˆ™é‡æ–°è°ƒåº¦
});

// è¾“å‡ºç¤ºä¾‹ï¼š
// 1,1,1,1,9,15,20,24,30,35,40,45,50,55,59,64,70,75,80,85,90,95,100
#+end_src
** ä¾‹å­
*** æ¯ç§’è¾“å‡ºä¸€æ¬¡
#+begin_src js
  let timer1s = setTimeout(function printP1s(from, to) {
    console.log(from);
    if (from !== to) {
      setTimeout(printP1s,1000,from+1,to);
    } else {
      clearTimeout(timer1s);
    }
  },1000,1,10);
  //ç”¨å‡½æ•°æŠ½è±¡åçš„å†™æ³•ï¼ˆæ›´ç®€æ´ï¼‰
  function printNumbers(from, to) {
    let current = from;

    setTimeout(function go() {
      alert(current);
      if (current < to) {
        setTimeout(go, 1000);
      }
      current++;
    }, 1000);
  }

  // ç”¨ä¾‹ï¼š
  printNumbers(5, 10);
#+end_src
* å‡½æ•°çš„é€æ˜ç¼“å­˜
#+begin_src js
  function cachingDecorator(func) {
    let cache = new Map();
    return function(x) {//ï¼ˆ5ï¼‰
      if (cache.has(x)) {
        return cache.get(x);
      }

      let result = func(x); //(1)
      cache.set(x, result);
      return result;
    };
  }
  //å¯¹äºæ™®é€šå‡½æ•°ï¼Œä¸Šè¿°ä»£ç æ˜¯ç”Ÿæ•ˆçš„
  function testFun(number) {return number+1;}
  testFun = cachingDecorator(testFun);
  testFun(5);//6
  testFun(5);//6 ç›´æ¥è°ƒç”¨äº†cacheä¸­çš„å€¼ï¼Œä¸éœ€è¦è®¡ç®—

  /* ä¸‹é¢åˆ†æä¸ºä»€ä¹ˆä¸Šè¿°ä»£ç å¯¹äºå¯¹è±¡æ–¹æ³•æ˜¯å¤±æ•ˆçš„*/
  let user = {
    firstName: "jesse",
    lastName: "yang",
    getFullName: function(){
      console.log(this); //æ–°æ·»åŠ ä¸€ä¸ªè¾“å‡ºthisçš„è¯­å¥ï¼Œæ–¹ä¾¿ç†è§£(6)
      return this.firstName+this.lastName;//(2)
    }
  }
  user.getFullName();//"jesseyang"ï¼ˆ3ï¼‰
  user.getFullName = cachingDecorator(user.getFullName); //ï¼ˆ4ï¼‰
  user.getFullName();//NaN

  /*
    (2ï¼‰è¡Œçš„ä»£ç ï¼Œè°ƒç”¨äº†thisï¼Œè¿™ä¸ªthisæ˜¯æ–¹æ³•è°ƒç”¨çš„æ—¶å€™åˆ†é…çš„.
    æœªç»è¿‡åŒ…è£…çš„æƒ…å†µä¸‹è°ƒç”¨ï¼Œï¼ˆ3ï¼‰è¡Œçš„ä»£ç è®¾å®šäº†userä¸ºthisï¼Œè°ƒç”¨ç»“æœæ­£å¸¸

    ç»è¿‡ï¼ˆ4ï¼‰è¡Œçš„åŒ…è£…åï¼Œuser.getFullNameå®é™…ä¸Šå˜æˆäº†ï¼ˆ5ï¼‰è¡Œè¿”å›çš„å‡½æ•°

    è¿™ä¸ªå‡½æ•°å¤„ç†æœªç»cacheçš„å€¼æ—¶ï¼Œä¼šè¿”å›(1)è¡Œçš„è°ƒç”¨ç»“æœã€‚ä½†æ˜¯ï¼ˆ1ï¼‰è¡Œè°ƒç”¨çš„æ—¶å€™æ²¡æœ‰ä¼ é€’this

    æ‰€ä»¥å›è¿‡å¤´ï¼Œï¼ˆ2ï¼‰è¡Œçš„ä»£ç åœ¨è¿™æ¬¡è°ƒç”¨çš„æ—¶å€™thisæ˜¯undifinedï¼Œæ‰€ä»¥å‘ç”Ÿäº†é”™è¯¯

    å¦‚æœæˆ‘ä»¬åœ¨getFullNameé‡Œé¢æ·»åŠ ä¸€ä¸ªè¾“å‡ºthisçš„è¯­å¥ï¼Œå¯ä»¥å‘ç°ï¼š

    - æœªç»åŒ…è£…çš„getFullNameï¼Œè¾“å‡ºäº†userä½œä¸ºthiså€¼
    - ç»è¿‡åŒ…è£…çš„getFullNameï¼Œè¾“å‡ºäº†undefinedï¼ˆæµè§ˆå™¨ç¯å¢ƒè¾“å‡ºwindowï¼Œå¦‚æœæ²¡æœ‰å¼€å¯ä¸¥æ ¼æ¨¡å¼ï¼‰
  ,*/

  /* ä¸‹é¢åˆ†æå¦‚ä½•æ”¹è¿›
     åªè¦åœ¨ï¼ˆ1ï¼‰è¡Œçš„ä»£ç è°ƒç”¨æ—¶åŒ¹é…åˆé€‚çš„thisè¿›å»å°±å¯ä»¥äº†
     ç”¨callæ–¹æ³•æŠŠthisä¼ é€’è¿›å»ï¼Œæ‰€ä»¥å¦‚æœæŠŠï¼ˆ1ï¼‰çš„è¯­å¥æ”¹æˆï¼š
     let result = func.call(user,x);æ‰§è¡Œç»“æœå°±æ­£ç¡®äº†

     ä½†æ˜¯è¿™æ ·å¤±å»äº†åŒ…è£…å™¨çš„æ„ä¹‰ï¼Œå› ä¸ºå¦‚æœåŒ…è£…äº†åˆ«çš„å¯¹è±¡çš„æ–¹æ³•ï¼Œè¿™ä¸ªå¯¹è±¡ä¸æ˜¯userï¼Œé‚£ä¹ˆè¿”å›å€¼ä»ç„¶æ˜¯é”™è¯¯çš„

     æ‰€ä»¥å¯ä»¥åœ¨ï¼ˆ1ï¼‰è¡Œä»£ç ä¸Šæ·»åŠ ï¼š
     let that = this;
     ç„¶åä¿®æ”¹ï¼ˆ1ï¼‰:let result = func.call(that,x);

     æ›´æ–¹ä¾¿çš„æ–¹æ³•æ˜¯ç›´æ¥let result = func.call(this,x);
     å› ä¸ºè°ƒç”¨(5)è¡Œçš„å‡½æ•°çš„æ—¶å€™ï¼Œthisè¢«è®¾å®šæˆäº†ç‚¹å·"."å‰çš„å¯¹è±¡
     é‚£ä¹ˆlet result = func.call(this.x);ä¸­çš„thiså°±æ˜¯è¿™ä¸ªç‚¹ã€‚

     é—®é¢˜è§£å†³
  ,*/
  //æ”¹è¿›çš„ä»£ç å¦‚ä¸‹ï¼š
  function cachingDecorator(func) {
    let cache = new Map();
    return function(x) {//ï¼ˆ5ï¼‰
      if (cache.has(x)) {
        return cache.get(x);
      }

      let result = func.call(this,x); //(1)
      cache.set(x, result);
      return result;
    };
  }
#+end_src
* callå€ŸåŠ©spreadè¯­æ³•å’Œrestè¯­æ³•èƒ½å¤Ÿåšå’ŒapplyåŒæ ·çš„äº‹ï¼Œä½†æ˜¯applyç»è¿‡å¼•æ“ä¼˜åŒ–ï¼Œå¤§å¤šæ•°æ—¶å€™é€Ÿåº¦ä¼šæ›´å¿«ä¸€äº›
* spreadè¯­æ³•ä¸applyçš„åŒºåˆ«ï¼šapplyä»…æ¥å—array-likeï¼Œè€Œspreadå¯ä»¥æ¥å—iterable
* å¤šå‚æ•°çš„å‡½æ•°åŒ…è£…å™¨
#+begin_src js
let worker = {
  slow(min, max) {
    alert(`Called with ${min},${max}`);
    return min + max;
  }
};

function cachingDecorator(func, hash) {
  let cache = new Map();
  return function() {
    let key = hash(arguments); // (*)
    if (cache.has(key)) {
      return cache.get(key);
    }

    let result = func.apply(this, arguments); // (**)

    cache.set(key, result);
    return result;
  };
}

function hash(args) {
  return args[0] + ',' + args[1];
}

worker.slow = cachingDecorator(worker.slow, hash);

alert( worker.slow(3, 5) ); // works
alert( "Again " + worker.slow(3, 5) ); // same (cached)
#+end_src
** mapçš„keyåªèƒ½æ˜¯ä¸€ä¸ªå€¼ï¼Œæ‰€ä»¥åšå¤šå‚æ•°å‡½æ•°åŒ…è£…å™¨çš„æ—¶å€™ï¼Œå¯ä»¥ç”¨ä¸€ä¸ªhashå‡½æ•°ï¼Œå°†å¤šå‚æ•°ç»„åˆæˆä¸€ä¸ªkeyå­˜å‚¨åœ¨mapä¸­
** !!!æ–¹æ³•å€Ÿç”¨
#+begin_src js
//argumentsä¸æ˜¯æ•°ç»„ï¼Œæ‰€ä»¥æ²¡æœ‰æ•°ç»„çš„æ–¹æ³•ï¼Œä½†æ˜¯å¯ä»¥ç”¨ä¸‹åˆ—æ–¹å¼å€Ÿç”¨æ•°ç»„çš„joinæ–¹æ³•
[].join.apply(arguments);
#+end_src
æˆ‘ä»¬ä»å¸¸è§„æ•°ç»„ [].join ä¸­è·å–ï¼ˆå€Ÿç”¨ï¼‰join æ–¹æ³•ï¼Œå¹¶ä½¿ç”¨ [].join.call åœ¨ arguments çš„ä¸Šä¸‹æ–‡ä¸­è¿è¡Œå®ƒã€‚

å®ƒä¸ºä»€ä¹ˆæœ‰æ•ˆï¼Ÿ

é‚£æ˜¯å› ä¸ºåŸç”Ÿæ–¹æ³• arr.join(glue) çš„å†…éƒ¨ç®—æ³•éå¸¸ç®€å•ã€‚

ä»è§„èŒƒä¸­å‡ ä¹â€œæŒ‰åŸæ ·â€è§£é‡Šå¦‚ä¸‹ï¼š

è®© glue æˆä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå¦‚æœæ²¡æœ‰å‚æ•°ï¼Œåˆ™ä½¿ç”¨é€—å· ","ã€‚
è®© result ä¸ºç©ºå­—ç¬¦ä¸²ã€‚
å°† this[0] é™„åŠ åˆ° resultã€‚
é™„åŠ  glue å’Œ this[1]ã€‚
é™„åŠ  glue å’Œ this[2]ã€‚
â€¦â€¦ä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ° this.length é¡¹ç›®è¢«ç²˜åœ¨ä¸€èµ·ã€‚
è¿”å› resultã€‚
å› æ­¤ï¼Œä»æŠ€æœ¯ä¸Šè®²ï¼Œå®ƒéœ€è¦ this å¹¶å°† this[0]ï¼Œthis[1] â€¦â€¦ç­‰ join åœ¨ä¸€èµ·ã€‚å®ƒçš„ç¼–å†™æ–¹å¼æ˜¯æ•…æ„å…è®¸ä»»ä½•ç±»æ•°ç»„çš„ this çš„ï¼ˆä¸æ˜¯å·§åˆï¼Œå¾ˆå¤šæ–¹æ³•éƒ½éµå¾ªè¿™ç§åšæ³•ï¼‰ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå®ƒä¹Ÿå¯ä»¥å’Œ this=arguments ä¸€èµ·ä½¿ç”¨ã€‚
* å‘¼å«è½¬ç§»
å°†ä¸€ä¸ªå‡½æ•°çš„æ‰€æœ‰å‚æ•°è¿åŒä¸Šä¸‹æ–‡ä¸€èµ·ä¼ é€’ç»™å¦ä¸€ä¸ªå‡½æ•°ç§°ä½œå‘¼å«è½¬ç§»ï¼ˆcall forwardingï¼‰
#+begin_src js
let wrapper = function() {
  return func.apply(this, arguments);
};
#+end_src
* !!!è£…é¥°å™¨ä¾‹å­
** é—´è°è£…é¥°è€…
åˆ›å»ºä¸€ä¸ªè£…é¥°è€… spy(func)ï¼Œå®ƒåº”è¯¥è¿”å›ä¸€ä¸ªåŒ…è£…å™¨ï¼Œè¯¥åŒ…è£…å™¨å°†æ‰€æœ‰å¯¹å‡½æ•°çš„è°ƒç”¨ä¿å­˜åœ¨å…¶ calls å±æ€§ä¸­ã€‚
æ¯ä¸ªè°ƒç”¨éƒ½ä¿å­˜ä¸ºä¸€ä¸ªå‚æ•°æ•°ç»„ã€‚
è¦æ±‚
#+begin_src js
function work(a, b) {
  alert( a + b ); // work æ˜¯ä¸€ä¸ªä»»æ„çš„å‡½æ•°æˆ–æ–¹æ³•
}

work = spy(work);

work(1, 2); // 3
work(4, 5); // 9

for (let args of work.calls) {
  alert( 'call:' + args.join() ); // "call:1,2", "call:4,5"
}
#+end_src

è§£ï¼š
#+begin_src js
function work(a,b){
    console.log( a + b);
  }

  function spy(func) {
    function wrapper(...args) {
      wrapper.calls.push(`call:${args.join()}`);
      return func.apply(this, args);
    }
      wrapper.calls = [];
      return wrapper;
  }

  //æµ‹è¯•ç”¨ä¾‹
  function sum(...args) {
    return args.reduce((result,number)=>result+=number);
  }

  let seq = {
    vec: [1,2,3,4,5,6,7],
    sum(){
      return this.vec.reduce((result, number)=>result+=number);
    }
  }
#+end_src

*** æ‹“å±•çŸ¥è¯†ï¼š[[http://sinonjs.org/][sinonJS]] å•å…ƒæµ‹è¯•åº“
** å»¶æ—¶è£…é¥°è€…
å°†fæ¯æ¬¡è°ƒç”¨å»¶æ—¶msæµ©æ¸º
è¦æ±‚ï¼š
#+begin_src js
function f(x) {
  alert(x);
}

// create wrappers
let f1000 = delay(f, 1000);
let f1500 = delay(f, 1500);

f1000("test"); // åœ¨ 1000ms åæ˜¾ç¤º "test"
f1500("test"); // åœ¨ 1500ms åæ˜¾ç¤º "test"
#+end_src

è§£ç­”ï¼š
#+begin_src js
  function delay(func, ms) {
    function delayFunc(...args) {
      setTimeout(()=>func.apply(this,args),ms);//(1)
    }
  }

  //è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå®é™…ä¸Šè¿”å›å€¼ä¸ä¼šè¢«æ”¶é›†
#+end_src
!!!setTimeoutä¼ é€’thisçš„å‘
æ™®é€šå‡½æ•°æ˜¯è°ƒç”¨æ—¶ç¡®å®šthisçš„ï¼Œç®­å¤´å‡½æ•°æ˜¯å£°æ˜æ—¶ç¡®å®šthisçš„
æ‰€ä»¥ï¼ˆ1ï¼‰è¡Œçš„è¯­å¥ï¼Œç®­å¤´å‡½æ•°å£°æ˜æ—¶è·å¾—äº†thisï¼Œå³dalayFuncè¢«è°ƒç”¨æ—¶çš„this
å¦‚æœç”¨functionæ–¹å¼ä¼ å…¥å›è°ƒï¼Œéœ€è¦ä½œå‡ºä¸€äº›è°ƒæ•´
#+begin_src js
function delay(f, ms) {

  return function(...args) {
    let savedThis = this; // å°† this å­˜å‚¨åˆ°ä¸­é—´å˜é‡
    setTimeout(function() {
      f.apply(savedThis, args); // åœ¨è¿™å„¿ä½¿ç”¨å®ƒ
    }, ms);
  };

}
#+end_src


æ³¨æ„è¿™é‡Œæ˜¯å¦‚ä½•ä½¿ç”¨ç®­å¤´å‡½æ•°çš„ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œç®­å¤´å‡½æ•°æ²¡æœ‰è‡ªå·±çš„ this å’Œ argumentsï¼Œæ‰€ä»¥ f.apply(this, arguments) ä»åŒ…è£…å™¨ä¸­è·å– this å’Œ argumentsã€‚

å¦‚æœæˆ‘ä»¬ä¼ é€’ä¸€ä¸ªå¸¸è§„å‡½æ•°ï¼ŒsetTimeout å°†è°ƒç”¨å®ƒä¸”ä¸å¸¦å‚æ•°å’Œ this=windowï¼ˆå‡è®¾æˆ‘ä»¬åœ¨æµè§ˆå™¨ç¯å¢ƒï¼‰ã€‚
** å»æŠ–è£…é¥°è€…
debounce(f, ms) è£…é¥°è€…çš„ç»“æœåº”è¯¥æ˜¯ä¸€ä¸ªåŒ…è£…å™¨ï¼Œè¯¥åŒ…è£…å™¨æœ€å¤šå…è®¸æ¯éš” ms æ¯«ç§’å°†è°ƒç”¨ä¼ é€’ç»™ f ä¸€æ¬¡ã€‚

æ¢å¥è¯è¯´ï¼Œå½“æˆ‘ä»¬è°ƒç”¨ â€œdebouncedâ€ å‡½æ•°æ—¶ï¼Œå®ƒä¿è¯ä¹‹åæ‰€æœ‰åœ¨è·ç¦»ä¸Šä¸€æ¬¡è°ƒç”¨çš„æ—¶é—´é—´éš”å°‘äº ms æ¯«ç§’çš„è°ƒç”¨éƒ½ä¼šè¢«å¿½ç•¥ã€‚

åœ¨å®é™…ä¸­ï¼Œå¯¹äºé‚£äº›ç”¨äºæ£€ç´¢/æ›´æ–°æŸäº›å†…å®¹çš„å‡½æ•°è€Œè¨€ï¼Œå½“æˆ‘ä»¬çŸ¥é“åœ¨çŸ­æ—¶é—´å†…ä¸ä¼šæœ‰ä»€ä¹ˆæ–°å†…å®¹çš„æ—¶å€™æ—¶ï¼Œdebounce å°±æ˜¾å¾—å¾ˆæœ‰ç”¨ï¼Œå› æ­¤æœ€å¥½ä¸è¦æµªè´¹èµ„æºã€‚

è¦æ±‚ï¼š
#+begin_src js
let f = debounce(alert, 1000);

f(1); // ç«‹å³æ‰§è¡Œ
f(2); // è¢«å¿½ç•¥

setTimeout( () => f(3), 100); // è¢«å¿½ç•¥ï¼ˆåªè¿‡å»äº† 100 msï¼‰
setTimeout( () => f(4), 1100); // è¿è¡Œ
setTimeout( () => f(5), 1500); // è¢«å¿½ç•¥ï¼ˆè·ä¸Šä¸€æ¬¡è¿è¡Œä¸è¶…è¿‡ 1000 msï¼‰
#+end_src

è§£ç­”ï¼š
#+begin_src js
    //é”™è¯¯çš„è§£æ³•ï¼š
    function debounce(func, ms) {
      let lastRunTimeStamp = Date.now();
      function wrapper(...args) {
        let now = Date.now()
        if (now-lastRunTimeStamp >= ms) {
          lastRunTimeStamp = Date.now();
          return func.apply(this, args);
        } else {
          console.log(`debounced, ${1000 - now + lastRunTimeStamp}ms left.`);
        }
      }
      return wrapper;
    }
  f = debounce(console.log, 1000);
  setTimeout( () => f(1), 1000);
  setTimeout( () => f(2), 1500);
  setTimeout( () => f(3), 2000);
  setTimeout( () => f(4), 2500);
  setTimeout( () => f(5), 3000);
  setTimeout( () => f(6), 3500);
  setTimeout( () => f(7), 4000);
  setTimeout( () => f(8), 4500);
  setTimeout( () => f(9), 5000);
  setTimeout( () => f(10), 5500);
  setTimeout( () => f(11), 6000);
  setTimeout( () => f(12), 6500);
  /*
     1
  debounced, 500ms left.
  3
  debounced, 501ms left.
  5
  debounced, 471ms left.
  7
  debounced, 503ms left.
  9
  debounced, 495ms left.
  11
  debounced, 478ms left.
  ,*/

  //è¿™ä¸ªç»“æœå’Œæµè§ˆå™¨çš„ç»“æœæ˜¯ä¸åŒçš„ï¼Œæµè§ˆå™¨çš„1000æ•´æ•°å€mså¾ˆå¤šä¼šè¢«debounceæ‰
#+end_src

æ­£ç¡®è§£æ³•ï¼š
#+begin_src js
function debounce(f, ms) {

  let isCooldown = false;

  return function() {
    if (isCooldown) return;

    f.apply(this, arguments);

    isCooldown = true;

    setTimeout(() => isCooldown = false, ms);
  };

}
#+end_src
** èŠ‚æµè£…é¥°è€…
#+begin_src js
function throttle(f, ms) {

  let isThrottled = false,
    savedArgs,
    savedThis;

  function wrapper() {

    if (isThrottled) { // (2)
      savedArgs = arguments;
      savedThis = this;
      return;
    }

    f.apply(this, arguments); // (1)

    isThrottled = true;

    setTimeout(function() {
      isThrottled = false; // (3)
      if (savedArgs) {
        wrapper.apply(savedThis, savedArgs);
        savedArgs = savedThis = null;
      }
    }, ms);
  }

  return wrapper;
}
#+end_src
* Object.keys()ã€for...oféƒ½åªèƒ½éå†å¯¹è±¡è‡ªèº«çš„å±æ€§ï¼Œfor...inå¯ä»¥éå†åŸå‹é“¾ä¸Šçš„å±æ€§
* åŸå‹é“¾çš„é¡¶ç«¯æ˜¯null
|                 | null               |                  |
|-----------------+--------------------+------------------|
|                 | Object.prototype   |                  |
| Array.prototype | Function.prototype | Number.prototype |
| [1,2,3]         | function(args){}   |                5 |
|-----------------+--------------------+------------------|
Function.prototypeæ˜¯å‡½æ•° ~Function()~ çš„ä¸€ä¸ªå¸¸è§„å±æ€§ï¼Œnew Function()å‡ºæ¥çš„å¯¹è±¡æœ‰ä¸€ä¸ª__proto__å±æ€§æŒ‡å‘Function.prototype
** æ¯ä¸ªå‡½æ•°éƒ½è‡ªå¸¦ä¸€ä¸ª.prototypeå±æ€§ã€‚è¿™ä¸ªå±æ€§æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ— è®ºæ˜¯å¦è¢«å¦è¡ŒæŒ‡å®šã€‚è¿™ä¸ªå¯¹è±¡é‡Œé¢å¸¦æœ‰ä¸€ä¸ª.constructorå±æ€§ï¼ŒæŒ‡å‘å‡½æ•°è‡ªèº«ã€‚
** åŸå‹çš„ä¾‹å­
*** ç»™å‡½æ•°æ·»åŠ ä¸€ä¸ªf.defer(ms)æ–¹æ³•
åœ¨æ‰€æœ‰å‡½æ•°çš„åŸå‹ä¸­æ·»åŠ  defer(ms) æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°†åœ¨ ms æ¯«ç§’åè¿è¡Œè¯¥å‡½æ•°ã€‚

å½“ä½ å®Œæˆæ·»åŠ åï¼Œä¸‹é¢çš„ä»£ç åº”è¯¥æ˜¯å¯æ‰§è¡Œçš„ï¼š
#+begin_src js
function f() {
  alert("Hello!");
}

f.defer(1000); // 1 ç§’åæ˜¾ç¤º "Hello!"
#+end_src

è§£ç­”ï¼š
#+begin_src js
  Function.prototype.defer = function(ms) {
    setTimeout(this, ms);
  };

  function f() {
    alert("Hello!");
  }

  f.defer(1000); // shows "Hello!" after 1 sec
#+end_src
*** å°†è£…é¥°è€…defer()æ·»åŠ åˆ°å‡½æ•°
åœ¨æ‰€æœ‰å‡½æ•°çš„åŸå‹ä¸­æ·»åŠ  defer(ms) æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªåŒ…è£…å™¨ï¼Œå°†å‡½æ•°è°ƒç”¨å»¶è¿Ÿ ms æ¯«ç§’ã€‚

ä¸‹é¢æ˜¯å®ƒåº”è¯¥å¦‚ä½•æ‰§è¡Œçš„ä¾‹å­ï¼š
#+begin_src js
  function f(a, b) {
    alert( a + b );
  }

  f.defer(1000)(1, 2); // 1 ç§’åæ˜¾ç¤º 3
#+end_src

è§£ç­”ï¼š!!!æ•™æçš„æ ‡å‡†ç­”æ¡ˆé€‚ç”¨äºå¯¹è±¡çš„æ–¹æ³•
#+begin_src js
  Function.prototype.defer = function(ms) {
    return (...args) => setTimeout(this, ms, ...args);
  }

  // æ•™ç¨‹çš„æ ‡å‡†ç­”æ¡ˆ

  Function.prototype.defer = function(ms) {
    let f = this;
    return function(...args) {
      setTimeout(() => f.apply(this, args), ms);
    }
  };

  // check it
  function f(a, b) {
    alert( a + b );
  }

  f.defer(1000)(1, 2); // 1 ç§’åæ˜¾ç¤º 3

  // æ•™ç¨‹æ ‡å‡†ç­”æ¡ˆé€‚ç”¨äºå¯¹è±¡æ–¹æ³•

  let user = {
    name: "John",
    sayHi() {
      alert(this.name);
    }
  }

  user.sayHi = user.sayHi.defer(1000);//è¿™é‡Œè¦é‡æ–°å®šä¹‰ä¸€ä¸‹user.sayHiï¼Œä¸ç„¶ä¼ ä¸è¿›å»this

  user.sayHi();
#+end_src
* åŸå‹æ–¹æ³•
** Object.create(proto[, descriptors])
!!!çœŸæ­£çš„æµ…æ‹·è´ï¼ˆå®Œå…¨ä¸€è‡´ï¼‰
#+begin_src js
  // å®Œå…¨ç›¸åŒçš„å¯¹è±¡ obj çš„æµ…æ‹·è´
  let clone = Object.create(Object.getPrototypeOf(obj), Object.getOwnPropertyDescriptors(obj));
#+end_src
** Object.getPrototypeOf(obj)
** Object.setPrototypeOf(obj,proto)
ä»¥ä¸Šä¸¤é¡¹ç›¸å½“äº__proto__çš„è®¿é—®å™¨

** "Very plain" objectsï¼ˆçº¯ç™½å¯¹è±¡ï¼‰
__proto__å±æ€§å¾ˆç‰¹åˆ«ï¼šå®ƒå¿…é¡»æ˜¯å¯¹è±¡æˆ–è€… nullã€‚å­—ç¬¦ä¸²ä¸èƒ½æˆä¸º prototypeã€‚
è¿™ä¸ªä¾‹å­ï¼š
#+begin_src js
let obj = {};

let key = prompt("What's the key?", "__proto__");
obj[key] = "some value";

alert(obj[key]); // [object Object]ï¼Œå¹¶ä¸æ˜¯ "some value"ï¼
#+end_src

æˆ‘ä»¬å¯èƒ½ä¼šå¯¹å¯¹è±¡è¿›è¡Œèµ‹å€¼æ“ä½œï¼Œç„¶ååŸå‹å¯èƒ½å°±è¢«æ›´æ”¹äº†ã€‚ç»“æœï¼Œå¯èƒ½ä¼šå¯¼è‡´å®Œå…¨æ„æƒ³ä¸åˆ°çš„ç»“æœã€‚

æœ€å¯æ€•çš„æ˜¯ â€”â€” é€šå¸¸å¼€å‘è€…å®Œå…¨ä¸ä¼šè€ƒè™‘åˆ°è¿™ä¸€ç‚¹ã€‚è¿™è®©æ­¤ç±» bug å¾ˆéš¾è¢«å‘ç°ï¼Œç”šè‡³å˜æˆæ¼æ´ï¼Œå°¤å…¶æ˜¯åœ¨ JavaScript è¢«ç”¨åœ¨æœåŠ¡ç«¯çš„æ—¶å€™ã€‚

ä¸ºé»˜è®¤æƒ…å†µä¸‹ä¸ºå‡½æ•°çš„ toString ä»¥åŠå…¶ä»–å†…å»ºæ–¹æ³•æ‰§è¡Œèµ‹å€¼æ“ä½œï¼Œä¹Ÿä¼šå‡ºç°æ„æƒ³ä¸åˆ°çš„ç»“æœã€‚

*** ä½¿ç”¨mapå¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜
*** åˆ›å»ºçº¯ç™½å¯¹è±¡ï¼ˆvery plain objectsï¼‰
#+begin_src js
let obj = Object.create(null);

let key = prompt("What's the key?", "__proto__");
obj[key] = "some value";

alert(obj[key]); // "some value"
#+end_src
** éå†å¯¹è±¡çš„å±æ€§çš„æ–¹æ³•
Object.keys(obj) / Object.values(obj) / Object.entries(obj) â€”â€” è¿”å›ä¸€ä¸ªå¯æšä¸¾çš„ç”±è‡ªèº«çš„å­—ç¬¦ä¸²å±æ€§å/å€¼/é”®å€¼å¯¹ç»„æˆçš„æ•°ç»„ã€‚
Object.getOwnPropertySymbols(obj) â€”â€” è¿”å›ä¸€ä¸ªç”±è‡ªèº«æ‰€æœ‰çš„ symbol ç±»å‹çš„é”®ç»„æˆçš„æ•°ç»„ã€‚
Object.getOwnPropertyNames(obj) â€”â€” è¿”å›ä¸€ä¸ªç”±è‡ªèº«æ‰€æœ‰çš„å­—ç¬¦ä¸²é”®ç»„æˆçš„æ•°ç»„ã€‚
Reflect.ownKeys(obj) â€”â€” è¿”å›ä¸€ä¸ªç”±è‡ªèº«æ‰€æœ‰é”®ç»„æˆçš„æ•°ç»„ã€‚
obj.hasOwnProperty(key)ï¼šå¦‚æœ obj æ‹¥æœ‰åä¸º key çš„è‡ªèº«çš„å±æ€§ï¼ˆéç»§æ‰¿è€Œæ¥çš„ï¼‰ï¼Œåˆ™è¿”å› trueã€‚
** polyfill Array.prototype.repeatçš„ä¾‹å­
#+begin_src js
  if (!String.prototype.repeat) { // å¦‚æœè¿™å„¿æ²¡æœ‰è¿™ä¸ªæ–¹æ³•
    // é‚£å°±åœ¨ prototype ä¸­æ·»åŠ å®ƒ

    String.prototype.repeat = function(n) {
      // é‡å¤ä¼ å…¥çš„å­—ç¬¦ä¸² n æ¬¡

      // å®é™…ä¸Šï¼Œå®ç°ä»£ç æ¯”è¿™ä¸ªè¦å¤æ‚ä¸€äº›ï¼ˆå®Œæ•´çš„æ–¹æ³•å¯ä»¥åœ¨è§„èŒƒä¸­æ‰¾åˆ°ï¼‰
      // ä½†å³ä½¿æ˜¯ä¸å¤Ÿå®Œç¾çš„ polyfill ä¹Ÿå¸¸å¸¸è¢«è®¤ä¸ºæ˜¯è¶³å¤Ÿå¥½çš„
      return new Array(n + 1).join(this);
    };
  }

  alert( "La".repeat(3) ); // LaLaLa
#+end_src

* classè¯­æ³•ä¸ä»…ä»…æ˜¯è¯­æ³•ç³–
** classåˆ›å»ºçš„å‡½æ•°è‡ªåŠ¨å…·æœ‰ç‰¹æ®Šçš„å†…éƒ¨å±æ€§æ ‡è®° [[FunctionKind]]:"classConstructor"ï¼Œä¸”classåˆ›å»ºçš„å‡½æ•°å¿…é¡»é€šè¿‡newè°ƒç”¨
** ç±»æ–¹æ³•ä¸å¯æšä¸¾ï¼Œé€šè¿‡classåˆ›å»ºçš„ç±»çš„æ–¹æ³•çš„enumerable descriptorè¢«è‡ªåŠ¨è®¾ä¸ºfalseï¼ˆæ— æ³•é€šè¿‡for...inæšä¸¾ï¼‰
** ç±»æ„é€ ä¸­çš„æ‰€æœ‰ä»£ç è‡ªåŠ¨è¿›å…¥ä¸¥æ ¼æ¨¡å¼ï¼Œè‡ªåŠ¨å¸¦æœ‰'use strict'
* ç±»è¡¨è¾¾å¼
** ç±»è¡¨è¾¾å¼ä¸åœ¨åŸå‹ä¸­ï¼Œå®ƒæ˜¯ä¸ºæ¯ä¸ªå®ä¾‹åˆ›å»ºçš„ï¼ˆä½†æ–¹æ³•åœ¨åŸå‹ä¸­ï¼‰
** ç±»è¡¨è¾¾å¼å¯ä»¥æœ‰ä¸€ä¸ªå‘½åï¼Œç±»ä¼¼å‘½åå‡½æ•°è¡¨è¾¾å¼
* !!!ä½¿ç”¨ç±»å­—æ®µåˆ¶ä½œç»‘å®šæ–¹æ³•
é—®é¢˜ï¼šç±»æ–¹æ³•åœ¨è¢«setTimeoutè°ƒç”¨æ—¶ä¼šå‘ç”Ÿä¸¢å¤±thisçš„æƒ…å†µï¼Œæœ¬è´¨æ˜¯å› ä¸ºsetTimeoutè°ƒç”¨æ–¹æ³•æ—¶ï¼Œç›¸å½“äºæŠŠå‡½æ•°èµ‹å€¼ç»™äº†setTimeoutçš„å‚æ•°ï¼Œè¿™æ ·ä¼šä¸¢å¤±thisã€‚åœ¨ä¼ ç»Ÿæ–¹æ³•ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä¸¤ç§æ–¹å¼è§£å†³é—®é¢˜ï¼š
å®ä¾‹ä»£ç å¦‚ä¸‹ï¼š
#+begin_src js
  class Button {
    constructor(value) {
      this.value = value;
    }

    click() {
      alert(this.value);
    }
  }

  let button = new Button("hello");

  setTimeout(button.click, 1000); // undefined
#+end_src
1. ä¼ å…¥åŒ…è£…å‡½æ•°
#+begin_src js
  setTimeout(()=>button.click(),1000); //hello
#+end_src

2. ç›´æ¥åœ¨ç±»å£°æ˜ä¸­ç»‘å®šæ–¹æ³•this
#+begin_src js
  class Button {
    constructor(value) {
      this.value = value;
      this.click = this.click.bind(this);
    }

    click() {
      alert(this.value);
    }
  }
#+end_src

ç±»è¯­æ³•å¸¦æ¥äº†ç¬¬ä¸‰ç§thisç»‘å®šçš„æ–¹å¼
#+begin_src js
  class Button {
    constructor(value) {
      this.value = value;
    }
    click = () => {        //è¿™é‡Œç”¨ç±»è¡¨è¾¾å¼åˆ›å»ºæ–¹æ³•ï¼Œæ‰€ä»¥æ¯ä¸ªButtonå¯¹è±¡éƒ½åœ¨åˆ›å»ºæ—¶è¢«åˆ›å»ºäº†ä¸€ä¸ªç‹¬ç«‹çš„clickæ–¹æ³•
      alert(this.value);   //è¿™é‡Œthisè¢«ç›´æ¥ä¸æ¯ä¸ªButtonå®ä¾‹ç»‘å®šäº†ã€‚å› ä¸ºç®­å¤´å‡½æ•°çš„thisæ˜¯åœ¨å£°æ˜æ—¶åˆ›å»ºçš„ï¼Œæ‰€ä»¥å®ä¾‹åˆ›å»ºçš„æ—¶å€™thiså·²ç»æŒ‡å‘äº†è¯¥å®ä¾‹ï¼Œæ‰€ä»¥æ— éœ€æ‹…å¿ƒä½œä¸ºsetTimeoutè¿™ç§å‡½æ•°çš„å‚æ•°æ—¶ä¼šä¸¢å¤±this
    }
  }
#+end_src
** ä¾‹å­ï¼šé‡å†™Clockç±»
#+begin_src js
class Clock {
  constructor({ template }) {
    this.template = template;
  }

  render() {
    let date = new Date();

    let hours = date.getHours();
    if (hours < 10) hours = '0' + hours;

    let mins = date.getMinutes();
    if (mins < 10) mins = '0' + mins;

    let secs = date.getSeconds();
    if (secs < 10) secs = '0' + secs;

    let output = this.template
      .replace('h', hours)
      .replace('m', mins)
      .replace('s', secs);

    console.log(output);
  }

  stop() {
    clearInterval(this.timer);
  }

  start() {
    this.render();
    this.timer = setInterval(() => this.render(), 1000);
  }
}


let clock = new Clock({template: 'h:m:s'});
clock.start();
#+end_src
* ç±»ç»§æ‰¿
è¯­æ³•ï¼š
#+begin_src js
  class Animal {
    constructor(name="Taishan") {
      this.name = name;
    }
    roar() {
      console.log(`My name is ${this.name}`);
    }
  }

  //æ–°å»ºä¸€ä¸ªå­ç±» Rabbit
  class Rabbit extends Animal {
    constructor(name="TuBage", color="White"){
      super(name); //åœ¨thisä¹‹å‰è°ƒç”¨superï¼›
      this.color = color;
    }
    roar() { //é‡å†™roaræ–¹æ³•
      super.roar(); //è°ƒç”¨çˆ¶ç±»æ–¹æ³•
      console.log(`And my fur is ${this.color}`); //æ·»åŠ æ–°çš„è¡Œä¸º
    }
  }
#+end_src
** !!!extendsè¯­æ³•çš„ä¸¤ä¸ªå½±å“
*** å°†å­ç±»prototype.__proto__è®¾å®šä¸ºçˆ¶ç±».prototype
*** å­ç±»çš„.__proto__è®¾å®šä¸ºçˆ¶ç±»
#+begin_src js
class Plant{}
class Tree extends Plant {}
Tree.prototype.__proto__ === Plant.prototype; //true
Tree.__proto__ === Plant; //true

//å¦‚æœæ˜¯function Plant(){}è¯­æ³•ï¼ŒTree.__proto__ === Function.prototype // true
#+end_src
*** æ‰€ä»¥å¦‚æœclassè¯­æ³•extendäº†Objectï¼Œé‚£ä¹ˆclasså£°æ˜çš„ç±»å¯ä»¥ç›´æ¥è°ƒç”¨Object.keys()ç­‰é™æ€æ–¹æ³•
* ~[[HomeObject]]~ å±æ€§
å‡¡æ˜¯è°ƒç”¨äº†superçš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šè¢«è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª ~[[HomeObject]]~ å±æ€§ï¼Œæ–¹æ³•åœ¨å†…éƒ¨çš„ ~[[HomeObject]]~ å±æ€§ä¸­è®°ä½äº†å®ƒä»¬çš„ç±»/å¯¹è±¡ã€‚è¿™å°±æ˜¯ super å¦‚ä½•è§£æçˆ¶æ–¹æ³•çš„ã€‚
!!!å› æ­¤ï¼Œå°†ä¸€ä¸ªå¸¦æœ‰ super çš„æ–¹æ³•ä»ä¸€ä¸ªå¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€ä¸ªå¯¹è±¡æ˜¯ä¸å®‰å…¨çš„ã€‚
#+begin_src js
let animal = {
  sayHi() {
    console.log(`I'm an animal`);
  }
};

// rabbit ç»§æ‰¿è‡ª animal
let rabbit = {
  __proto__: animal,
  sayHi() {
    super.sayHi();
  }
};

let plant = {
  sayHi() {
    console.log("I'm a plant");
  }
};

// tree ç»§æ‰¿è‡ª plant
let tree = {
  __proto__: plant,
  sayHi: rabbit.sayHi // (*)
};

tree.sayHi();  // I'm an animal (?!?)
#+end_src

* è‹¥è¦ä½¿ç”¨superï¼Œæ–¹æ³•å¿…é¡»æ˜ç¡®æŒ‡å®šä¸ºmethodï¼Œè€Œä¸æ˜¯method:function(){}
åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨éæ–¹æ³•ï¼ˆnon-methodï¼‰è¯­æ³•è¿›è¡Œäº†æ¯”è¾ƒã€‚æœªè®¾ç½® [[HomeObject]] å±æ€§ï¼Œå¹¶ä¸”ç»§æ‰¿æ— æ•ˆï¼š
#+begin_src js
let animal = {
  eat: function() { // è¿™é‡Œæ˜¯æ•…æ„è¿™æ ·å†™çš„ï¼Œè€Œä¸æ˜¯ eat() {...
    // ...
  }
};

let rabbit = {
  __proto__: animal,
  eat: function() {
    super.eat();
  }
};

rabbit.eat();  // é”™è¯¯è°ƒç”¨ superï¼ˆå› ä¸ºè¿™é‡Œæ²¡æœ‰ [[HomeObject]]ï¼‰
#+end_src
* å­—ç¬¦ä¸²çš„æ•°ç»„çš„replaceæ–¹æ³•
* é™æ€å±æ€§å’Œé™æ€æ–¹æ³•ï¼Œç”¨staticå£°æ˜ã€‚é™æ€æ–¹æ³•ä¸­çš„thisæŒ‡çš„æ˜¯ç±»æœ¬èº«ï¼ˆç±»å‡½æ•°æœ¬èº«ï¼‰
* æ‰©å±•å†…å»ºæ•°ç»„
#+begin_src js
class PowerArray extends Array {
  isEmpty() {
    return this.length === 0;
  }

  // å†…å»ºæ–¹æ³•å°†ä½¿ç”¨è¿™ä¸ªä½œä¸º constructor
  static get [Symbol.species]() {
    return Array;
  }
}
let arr = new PowerArray(1, 2, 5, 10, 50);
alert(arr.isEmpty()); // false

// filter ä½¿ç”¨ arr.constructor[Symbol.species] ä½œä¸º constructor åˆ›å»ºæ–°æ•°ç»„
let filteredArr = arr.filter(item => item >= 10);

// filteredArr ä¸æ˜¯ PowerArrayï¼Œè€Œæ˜¯ Array
alert(filteredArr.isEmpty()); // Error: filteredArr.isEmpty is not a function
#+end_src
** ä½¿ç”¨arr.filter()æ—¶ï¼Œå†…éƒ¨ä½¿ç”¨çš„æ˜¯arr.constructoræ¥åˆ›å»ºæ–°çš„ç»“æœæ•°ç»„
** !!!å¦‚æœå¸Œæœ›æ‰©å±•å†…å»ºæ•°ç»„è¿”å›åŸç”Ÿæ•°ç»„æ—¶ï¼Œä½¿ç”¨Symbol.speciesæ¥æŒ‡å®šconstructor
* å†…å»ºç±»æ²¡æœ‰é™æ€æ–¹æ³•ç»§æ‰¿
Array å’Œ Data éƒ½ç»§æ‰¿è‡ª Objectï¼Œæ‰€ä»¥å®ƒä»¬çš„å®ä¾‹éƒ½æœ‰æ¥è‡ª Object.prototype çš„æ–¹æ³•ã€‚ä½† ~Array.[[prototype]]~ å¹¶ä¸æŒ‡å‘ Objectï¼Œæ‰€ä»¥å®ƒä»¬æ²¡æœ‰ä¾‹å¦‚ Array.keys()ï¼ˆæˆ– Data.keys()ï¼‰è¿™äº›é™æ€æ–¹æ³•ã€‚
* é«˜çº§ç±»å‹æ£€æŸ¥
ç±»å‹æ£€æŸ¥çš„å‡ ç§æ–¹å¼ï¼š
|             | ç”¨äº                                                       | è¿”å›å€¼     |
|-------------+------------------------------------------------------------+------------|
| typeof      | åŸå§‹æ•°æ®ç±»å‹                                               | string     |
| {}.toString | åŸå§‹æ•°æ®ç±»å‹ï¼Œå†…å»ºå¯¹è±¡ï¼ŒåŒ…å« Symbol.toStringTag å±æ€§çš„å¯¹è±¡ | string     |
| instanceof  | å¯¹è±¡                                                       | true/false |
** ä½¿ç”¨Object.prototype.toStringæ¥æ­ç¤ºç±»å‹
ä¸ç›´æ¥ä½¿ç”¨obj.toStringçš„åŒºåˆ«æ˜¯ï¼šæœ‰æ—¶å€™æˆ‘ä»¬ä¼šè‡ªå®šä¹‰å¯¹è±¡çš„toStringçš„è¿”å›å€¼ï¼Œè¿™æ—¶å€™ä½¿ç”¨obj.toString()è¿”å›çš„å°±ä¸æ˜¯ç±»å‹ä¿¡æ¯äº†ã€‚
è¿™æ—¶å€™å¯ä»¥ä½¿ç”¨ ~Object.prototype.toString.call(obj)~ æ¥è¿”å›å¯¹è±¡çš„ç±»å‹ï¼Œä¸ä½†é€‚ç”¨äºå¯¹è±¡ç±»å‹ï¼Œä¹Ÿé€‚ç”¨äºåŸºç¡€ç±»å‹ï¼š
#+begin_src js
let s = Object.prototype.toString;

alert( s.call(123) ); // [object Number]
alert( s.call(null) ); // [object Null]
alert( s.call(alert) ); // [object Function]
#+end_src
** !!!è‡ªå®šä¹‰å¯¹è±¡ç±»å‹tagï¼šSymbol.toStringTag
#+begin_src js
let user = {
  [Symbol.toStringTag]: "User"
};

alert( {}.toString.call(user) ); // [object User]
#+end_src

è¿”å›å€¼æ˜¯ä¸€ä¸ªstringï¼Œæ„å‘³ç€å¯ä»¥ç”¨æ­£åˆ™æˆ–è€…å­—ç¬¦ä¸²æ–¹æ³•æ¥æå–ç›¸å¯¹åº”çš„å¯¹è±¡ç±»å‹çš„å­—ç¬¦ä¸²å€¼
** ä¸€ä¸ªinstanceofæ— æ•ˆçš„ä¾‹å­
#+begin_src js
function A() {}
function B() {}

A.prototype = B.prototype = {};

let a = new A();

alert( a instanceof B ); // true
#+end_src
!!!å› ä¸ºinstanceofæ“ä½œç¬¦åªå…³å¿ƒprototypeï¼Œä¸å…³å¿ƒæ„é€ å‡½æ•°
* mixinæ¨¡å¼ï¼Œå®ç°ç±»ä¼¼å¤šé‡ç»§æ‰¿çš„åŠŸèƒ½ï¼Œä½¿ç”¨Object.assign(obj,mixin)çš„è¯­æ³•
* try...catch
é¦–å…ˆï¼Œæ‰§è¡Œ try {...} ä¸­çš„ä»£ç ã€‚
å¦‚æœè¿™é‡Œæ²¡æœ‰é”™è¯¯ï¼Œåˆ™å¿½ç•¥ catch(err)ï¼šæ‰§è¡Œåˆ° try çš„æœ«å°¾å¹¶è·³è¿‡ catch ç»§ç»­æ‰§è¡Œã€‚
å¦‚æœè¿™é‡Œå‡ºç°é”™è¯¯ï¼Œåˆ™ try æ‰§è¡Œåœæ­¢ï¼Œæ§åˆ¶æµè½¬å‘ catch(err) çš„å¼€å¤´ã€‚å˜é‡ errï¼ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»»ä½•åç§°ï¼‰å°†åŒ…å«ä¸€ä¸ª error å¯¹è±¡ï¼Œè¯¥å¯¹è±¡åŒ…å«äº†æ‰€å‘ç”Ÿäº‹ä»¶çš„è¯¦ç»†ä¿¡æ¯ã€‚
* try...catchä»…å¯¹è¿è¡Œæ—¶çš„é”™è¯¯æœ‰æ•ˆï¼Œæ— æ³•å¤„ç†(parse-time)è§£ææ—¶é—´é”™è¯¯
* try...catchåŒæ­¥å·¥ä½œï¼Œå¯¹åŒ…è£¹çš„scheduledä»£ç æ— æ³•å¤„ç†
* errorå¯¹è±¡ï¼šnameï¼Œmessageï¼Œstack
* throwæŠ›å‡ºé”™è¯¯ï¼Œä¼šè¢«åé¢çš„catchæ•è·
* catchå—ä¸­å¯ä»¥é€šè¿‡åŒ…è£¹if elseè¯­å¥ï¼Œé‡æ–°æŠ›å‡ºé”™è¯¯
* finallyæ— è®ºå¦‚ä½•ä¼šè¢«æ‰§è¡Œï¼Œå³ä½¿try...catchä¸­æœ‰returnè¯­å¥ï¼Œfinallyä¹Ÿä¼šæ‰§è¡Œ
** !!!ä¸€ä¸ªfinallyçš„ä¼˜ç‚¹çš„ä¾‹å­
å¯¹æ¯”ä»¥ä¸‹ä¸¤ç§ä¾‹å­ï¼š
#+begin_src js
try {
  work work
} catch (e) {
  handle errors
} finally {
  cleanup the working space
}
//å°†cleanupè¯­å¥æ”¾åˆ°æœ«å°¾
try {
  work work
} catch (e) {
  handle errors
}
cleanup the working space
#+end_src
æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ
åŒºåˆ«åœ¨äºï¼šå¦‚æœtry...catchè¯­å¥è¢«å‡½æ•°åŒ…è£¹ï¼Œfinallyè¯­å¥ä¿è¯äº†cleanupçš„æ‰§è¡Œ
finally å­å¥é€‚ç”¨äº try..catch çš„ ä»»ä½• å‡ºå£ã€‚è¿™åŒ…æ‹¬æ˜¾å¼çš„ returnï¼Œrethrowç­‰è¡Œä¸ºã€‚
è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœæ²¡æœ‰æŠŠcleanup codeåŒ…è£¹åœ¨finallyä¸­ï¼Œcleanupæ˜¯ä¸ä¼šæ‰§è¡Œçš„
* try...catch...finallyä¸­ç”Ÿå‘½çš„å˜é‡æ˜¯å±€éƒ¨å˜é‡ï¼Œåªåœ¨å¯¹åº”çš„å—ä¸­å¯è§
* å…¨å±€errorçš„ä½œç”¨é€šå¸¸æ˜¯å°†é”™è¯¯ä¿¡æ¯å‘é€ç»™å¼€å‘è€…
* !!!classè¯­æ³•çš„constructoræœ‰nameå±æ€§
åº”ç”¨ï¼šç®€åŒ–errorç±»å£°æ˜æ—¶å¯¹äºnameå­—æ®µçš„èµ‹å€¼

ç›´æ¥ç»§æ‰¿ä¸‹å»ï¼Œæ¯ä¸ªå­ç±»éƒ½å¯ä»¥è‡ªåŠ¨å‘½å
#+begin_src js
class MyError extends Error {
  constructor(message) {
    super(message);
    this.name = this.constructor.name;
  }
}

class ValidationError extends MyError { }

class PropertyRequiredError extends ValidationError {
  constructor(property) {
    super("No property: " + property);
    this.property = property;
  }
}

// name æ˜¯å¯¹çš„
alert( new PropertyRequiredError("field").name ); // PropertyRequiredError
#+end_src
* åŒ…è£…å¼‚å¸¸
åŒ…è£…å¼‚å¸¸æ˜¯ä¸€é¡¹å¹¿æ³›åº”ç”¨çš„æŠ€æœ¯ï¼šç”¨äºå¤„ç†ä½çº§åˆ«å¼‚å¸¸å¹¶åˆ›å»ºé«˜çº§åˆ« error è€Œä¸æ˜¯å„ç§ä½çº§åˆ« error çš„å‡½æ•°ã€‚åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œä½çº§åˆ«å¼‚å¸¸æœ‰æ—¶ä¼šæˆä¸ºè¯¥å¯¹è±¡çš„å±æ€§ï¼Œä¾‹å¦‚ err.causeï¼Œä½†è¿™ä¸æ˜¯ä¸¥æ ¼è¦æ±‚çš„ã€‚
ä»¥ä¸‹ä»£ç å°†syntax errorå’Œvalidation errorï¼ˆä½çº§åˆ«é”™è¯¯ï¼‰åŒ…è£…è¿›äº†ReadErrorä¸­ï¼Œ
#+begin_src js
class ReadError extends Error {
  constructor(message, cause) {
    super(message);
    this.cause = cause;
    this.name = 'ReadError';
  }
}

class ValidationError extends Error { /*...*/ }
class PropertyRequiredError extends ValidationError { /* ... */ }

function validateUser(user) {
  if (!user.age) {
    throw new PropertyRequiredError("age");
  }

  if (!user.name) {
    throw new PropertyRequiredError("name");
  }
}

function readUser(json) {
  let user;

  try {
    user = JSON.parse(json);
  } catch (err) {
    if (err instanceof SyntaxError) {
      throw new ReadError("Syntax Error", err);
    } else {
      throw err;
    }
  }

  try {
    validateUser(user);
  } catch (err) {
    if (err instanceof ValidationError) {
      throw new ReadError("Validation Error", err);
    } else {
      throw err;
    }
  }

}

try {
  readUser('{bad json}');
} catch (e) {
  if (e instanceof ReadError) {
    alert(e);
    // Original error: SyntaxError: Unexpected token b in JSON at position 1
    alert("Original error: " + e.cause);
  } else {
    throw e;
  }
}
#+end_src
* promiseè¯­æ³•
#+begin_src js
  let promise = new Promise(function(resolve, reject) {
    //producer code;
    if (everything Ok) {
      resolve(result);
    } else {
      reject(err);
    }
  });

  promise.then(
    successFn(result); // resultæ˜¯Promiseçš„resolveçš„å‚æ•°
    failedFn(err);  // erræ˜¯Promiseçš„rejectçš„å‚æ•°
  )
    .catch(
      failedFn(err);
    )
    .finally(
      clearupCode(); //ä¸ä¼šè¢«ä¼ å…¥å‚æ•°
    );
#+end_src
!!! .then()è¿”å›çš„promiseçš„çŠ¶æ€æ˜¯resolved
#+begin_src js
let promise = new Promise((resolve,reject)=>reject("err")); //promiseçš„stateæ˜¯rejected
let promise1 = promise.then(null, str => {cosole.log(str);return str;});  //promise1çš„stateæ˜¯resolved
let promise2 = promise1.catch(console.log);                 //æ§åˆ¶å°è¾“å‡ºundefined
//å¦‚æœthençš„?onrejectedæ²¡æœ‰rethrow errorï¼Œä¸‹é¢çš„catchä¹Ÿæ¥ä¸åˆ°è¿™ä¸ªerr,å¦‚æœå†é“¾æ¥ä¸€ä¸ªthenï¼Œæ–°çš„thençš„?onfullfilledä¼šæ¥åˆ°è¿™ä¸ªè¿”å›å€¼
//å¦‚æœthençš„?onrejected rethrowäº†ä¸€ä¸ªerrorï¼Œä¸‹é¢çš„catchä¼šæ¥åˆ°è¿™ä¸ªerr
#+end_src
!!! å®ƒçš„å‚æ•° resolve å’Œ reject æ˜¯ç”± JavaScript è‡ªèº«æä¾›çš„å›è°ƒã€‚æˆ‘ä»¬çš„ä»£ç ä»…åœ¨ executor çš„å†…éƒ¨ã€‚æ¢å¥è¯è¯´ï¼Œresolveå’Œrejectä¸èƒ½æ›´æ”¹ï¼Œè¿™ä¸ªåå­—æ˜¯å›ºå®šçš„ã€‚
!!! promiseçš„then/catch/finallyæ‰§è¡Œä¸å¦åªä¸promiseå¯¹è±¡çš„stateæœ‰å…³ï¼Œå¦‚æœstateæ˜¯settledï¼ˆæ— è®ºæ˜¯resolvedè¿˜æ˜¯rejectedï¼‰ï¼Œthenéƒ½ä¼šç«‹å³æ‰§è¡Œã€‚
å¦‚æœä¸ºä¸€ä¸ªå·²ç»settledçš„promiseæ·»åŠ ä¸Šè¿°æ¶ˆè´¹è€…æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•ä¸­çš„ä»£ç éƒ½ä¼šç«‹å³æ‰§è¡Œã€‚
* promiseé“¾ï¼špromiseçš„thenä¼šè¿”å›ä¸€ä¸ªæ–°çš„Promiseå¯¹è±¡ã€‚thenå›è°ƒå‡½æ•°çš„returnå€¼ä¼šæˆä¸ºæ–°çš„Promiseå¯¹è±¡çš„settleå€¼ã€‚
** ä¼ é€’resultæˆ–è€…errorï¼Œfinallyä¼šç›´æ¥ä¼ é€’ï¼Œå®ƒçš„å›è°ƒä¸éœ€è¦å‚æ•°
** finally å¹¶ä¸æ˜¯æ„å‘³ç€è¦å¤„ç† promise çš„ç»“æœã€‚æ‰€ä»¥å®ƒå°†ç»“æœä¼ é€’äº†ä¸‹å»ã€‚ï¼ˆä¹Ÿä¸éœ€è¦resultï¼‰
* !!!setTimeout ä¸ promise
#+begin_src js
Promise.resolve('foo')
  // 1. Receive "foo", concatenate "bar" to it, and resolve that to the next then
  .then(function(string) {
    return new Promise(function(resolve, reject) {
      setTimeout(function() {
        string += 'bar';
        resolve(string);                          //**
      }, 1);
    });
  })
  // 2. receive "foobar", register a callback function to work on that string
  // and print it to the console, but not before returning the unworked on
  // string to the next then
  .then(function(string) {
    setTimeout(function() {
      string += 'baz';
      console.log(string);
    }, 1)                                        //ï¼ˆ*ï¼‰
    return string;
  })
  // 3. print helpful messages about how the code in this section will be run
  // before the string is actually processed by the mocked asynchronous code in the
  // previous then block.  
  .then(function(string) {
    console.log("Last Then:  oops... didn't bother to instantiate and return " +
                "a promise in the prior then so the sequence may be a bit " +
                "surprising");

    // Note that `string` will not have the 'baz' bit of it at this point. This 
    // is because we mocked that to happen asynchronously with a setTimeout function
    console.log(string);
  });

// logs, in order:
// Last Then: oops... didn't bother to instantiate and return a promise in the prior then so the sequence may be a bit surprising
// foobar
// foobarbaz
#+end_src

thençš„å›è°ƒå‡½æ•°ä¸­æ‰§è¡Œçš„å®é™…ä¸Šæ˜¯ä¸€ä¸ªåŒæ­¥è¿‡ç¨‹ã€‚æ„å‘³ç€ï¼Œåœ¨thençš„å›è°ƒå‡½æ•°æ‰§è¡Œæ—¶ï¼Œå…¶ä¸­çš„setTimeoutè·Ÿæ™®é€šåŒæ­¥è¿‡ç¨‹æ˜¯ä¸€æ ·çš„ã€‚setTimeoutåé¢çš„ä»£ç ä¸ä¼šç­‰å¾…setTimeoutæ‰§è¡Œå®Œæˆæ‰æ‰§è¡Œã€‚(*)è¡Œä»£ç åé¢çš„returnåœ¨ ~string+='baz'~ ä¹‹å‰å°±å‘ç”Ÿäº†ã€‚

å¦‚æœåœ¨thenè¯­å¥ä¸­æœ‰setTimeoutï¼ˆè®¡åˆ’è°ƒç”¨ï¼‰ç±»è¿‡ç¨‹ï¼Œè¦æ–°å»ºå¹¶è¿”å›ä¸€ä¸ªpromiseï¼Œåœ¨è¿™ä¸ªæ–°çš„promiseä¸­åšè®¡åˆ’è°ƒç”¨ã€‚ï¼ˆ**ï¼‰è¡Œä»£ç çš„åšæ³•ï¼Œä½¿å¾—åç»­çš„thenç­‰å¾…å…¶resolveåæ‰æ‰§è¡Œã€‚

ä¸‹é¢çš„ä»£ç æ„å»ºäº†å¼‚æ­¥è¡Œä¸ºé“¾ï¼š
#+begin_src js
new Promise(function(resolve, reject) {

  setTimeout(() => resolve(1), 1000);

}).then(function(result) {

  alert(result); // 1

  return new Promise((resolve, reject) => { // (*)
    setTimeout(() => resolve(result * 2), 1000);
  });

}).then(function(result) { // (**)

  alert(result); // 2

  return new Promise((resolve, reject) => {
    setTimeout(() => resolve(result * 2), 1000);
  });

}).then(function(result) {

  alert(result); // 4

});
#+end_src

è¿”å›çš„promiseçš„resolveå€¼æ˜¯ä¸‹ä¸€ä¸ªthençš„å›è°ƒçš„å‚æ•°ã€‚
* !!!fetchæœ‰ä¸¤æ®µ
- ç¬¬ä¸€æ®µè¿”å›ä¸€ä¸ªresponseï¼ˆpromiseå¯¹è±¡ï¼‰ï¼Œå½“è¿œç¨‹æœåŠ¡å™¨è¿”å› headerï¼ˆæ˜¯åœ¨ å…¨éƒ¨å“åº”åŠ è½½å®Œæˆå‰ï¼‰æ—¶
- åœ¨ä¸‹ä¸€ä¸ªthenä¸­è°ƒç”¨response.text()æ–¹æ³•=>è¿”å›ä¸€ä¸ªpromiseå¯¹è±¡ï¼Œç”¨jsonå­—ç¬¦ä¸²resolve
æˆ–response.json()æ–¹æ³•=>è¿”å›ä¸€ä¸ªpromiseå¯¹è±¡ï¼Œæ˜¯JSON.parse()åçš„å¯¹è±¡
** !!!ä¸€ä¸ªåŠ è½½githubå¤´åƒçš„ä¾‹å­
#+begin_src js
// å‘é€ä¸€ä¸ªå¯¹ user.json çš„è¯·æ±‚
fetch('/article/promise-chaining/user.json')
  // å°†å…¶åŠ è½½ä¸º JSON
  .then(response => response.json())
  // å‘é€ä¸€ä¸ªåˆ° GitHub çš„è¯·æ±‚
  .then(user => fetch(`https://api.github.com/users/${user.name}`))
  // å°†å“åº”åŠ è½½ä¸º JSON
  .then(response => response.json())
  // æ˜¾ç¤ºå¤´åƒå›¾ç‰‡ï¼ˆgithubUser.avatar_urlï¼‰3 ç§’ï¼ˆä¹Ÿå¯ä»¥åŠ ä¸ŠåŠ¨ç”»æ•ˆæœï¼‰
  .then(githubUser => {                        //(**)
    let img = document.createElement('img');
    img.src = githubUser.avatar_url;
    img.className = "promise-avatar-example";
    document.body.append(img);

    setTimeout(() => img.remove(), 3000); // (*)
  });
#+end_src
è¿™æ®µä»£ç çš„é—®é¢˜åœ¨ä¸Šæ–‡ä¸­setTimeoutå’Œpromiseçš„æ¢è®¨ä¸­è¯´è¿‡äº†ï¼Œï¼ˆ**ï¼‰ä¸­çš„ä»£ç æœ‰ä¸€ä¸ªå¼‚æ­¥è¿‡ç¨‹ï¼Œå¦‚æœæƒ³è¦å¯¹åŠ è½½å¤´åƒåçš„çŠ¶æ€è¿›è¡Œå¤„ç†å®é™…ä¸Šæ˜¯åšä¸åˆ°çš„ã€‚åº”è¯¥åšå¦‚ä¸‹ä¿®æ”¹ï¼ˆ*ï¼‰è¡Œçš„ä¿®æ”¹ï¼š
#+begin_src js
  fetch('/article/promise-chaining/user.json')
    .then(response=>response.json())
    .then(user=>fetch(`https://api.github.com/users/${user.name}`))
    .then(response=>response.json())
    .then(githubUser=> new Promise(resolve=>{
        let img = document.createElement('img');
        img.src = githubUser.avatar_url;
        img.className = "promise-avatar-example";
        document.body.append(img);

      setTimeout(() => {
        img.remove();
        resolve(githubUser);
      }, 3000);
      }))
    .then(githubUser => alert(`Finished showing ${githubUser.name}`));
#+end_src
** thenä¸.then.catchçš„åŒºåˆ«
#+begin_src js
promise
  .then(f1)
  .catch(f2);
//vs
promise.then(f1,f2);

//ä¸Šé¢ä¸¤ç§å†™æ³•æœ‰åŒºåˆ«ã€‚ç¬¬ä¸€ç§å†™æ³•å¦‚æœæœ‰errorï¼Œä¼šè¢«catchå¤„ç†ã€‚è€Œç¬¬äºŒç§ä¸ä¼šã€‚å› ä¸ºerroræ˜¯æ²¿ç€é“¾ä¼ é€’çš„ï¼Œç¬¬äºŒç§æ²¡æœ‰é“¾
#+end_src
* promiseçš„éšå¼try...catch
ä¸‹é¢ä¸¤æ®µä»£ç å·¥ä½œä¸Šå®Œå…¨ç›¸åŒ
#+begin_src js
new Promise((resolve, reject) => {
  throw new Error("Whoops!");  //*
}).catch(alert); // Error: Whoops!
#+end_src

#+begin_src js
new Promise((resolve, reject) => {
  reject(new Error("Whoops!"));
}).catch(alert); // Error: Whoops!
#+end_src
å¯ä»¥ç†è§£ä¸ºthrow new Errorå‘¨å›´æœ‰ä¸€ä¸ªtry...catchï¼Œå¹¶å°†å…¶å˜ä¸ºreject(new Error);
ç„¶årejectçš„errè¢«åé¢é“¾æ¥çš„catchæ•è·

æ‰€æœ‰çš„é”™è¯¯éƒ½ä¼šè¢«æ•è·ï¼Œä¾‹å¦‚ï¼š
#+begin_src js
new Promise((resolve, reject) => {
  resolve("ok");
}).then((result) => {
  blabla(); // æ²¡æœ‰è¿™ä¸ªå‡½æ•°
}).catch(alert); // ReferenceError: blabla is not defined
#+end_src
* then/catchä¸­ä¹Ÿå¯ä»¥throw errorï¼Œå¹¶ä¸”è¢«æœ€è¿‘çš„catchæ•è·
* !!! unhandledrejectionäº‹ä»¶å¤„ç†ç¨‹åº
#+begin_src js
window.addEventListener('unhandledrejection', function(event) {
  // è¿™ä¸ªäº‹ä»¶å¯¹è±¡æœ‰ä¸¤ä¸ªç‰¹æ®Šçš„å±æ€§ï¼š
  alert(event.promise); // [object Promise] - ç”Ÿæˆè¯¥å…¨å±€ error çš„ promise
  alert(event.reason); // Error: Whoops! - æœªå¤„ç†çš„ error å¯¹è±¡
 //é‡åˆ°å…¨å±€errorçš„å¤„ç†è¯­å¥
 //...
});

new Promise(function() {
  throw new Error("Whoops!");
}); // æ²¡æœ‰ç”¨æ¥å¤„ç† error çš„ catch
#+end_src
* Promiseç±»çš„é™æ€æ–¹æ³•all/allSettled/race/resolve/reject
** æ‰¹é‡æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡Promise.all()/Promise.allSettled()
è¯­æ³•ï¼š
æ¥å—ä¸€ä¸ªpromiseå¯¹è±¡æ„æˆçš„çš„æ•°ç»„ï¼Œè¿”å›ä¸€ä¸ªpromiseï¼Œå…¶resolveæ˜¯æ¯ä¸ªpromiseå¯¹è±¡resolveç»“æœç»„æˆçš„æ•°ç»„
!!!ç»“æœæ•°ç»„ä¸­å…ƒç´ çš„é¡ºåºä¸å…¶åœ¨æº promise ä¸­çš„é¡ºåºç›¸åŒã€‚å³ä½¿ç¬¬ä¸€ä¸ª promise èŠ±è´¹äº†æœ€é•¿çš„æ—¶é—´æ‰ resolveï¼Œä½†å®ƒä»æ˜¯ç»“æœæ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªã€‚
*** !!!å¦‚æœä»»æ„ä¸€ä¸ª promise è¢« rejectï¼Œç”± Promise.all è¿”å›çš„ promise å°±ä¼šç«‹å³ rejectï¼Œå¹¶ä¸”å¸¦æœ‰çš„å°±æ˜¯è¿™ä¸ª errorã€‚

å¦‚æœå…¶ä¸­ä¸€ä¸ª promise è¢« rejectï¼ŒPromise.all å°±ä¼šç«‹å³è¢« rejectï¼Œå®Œå…¨å¿½ç•¥åˆ—è¡¨ä¸­å…¶ä»–çš„ promiseã€‚å®ƒä»¬çš„ç»“æœä¹Ÿè¢«å¿½ç•¥ã€‚
*** !!!Promise.all()/Promise.allSettled()å¯ä»¥æ¥å—ä¸€ä¸ªiterableå¯¹è±¡ï¼Œå¦‚æœä»»æ„ä¸€ä¸ªå…ƒç´ ä¸æ˜¯promiseå¯¹è±¡ï¼Œå®ƒå°†è¢«â€œåŸæ ·â€è¿”å›ï¼ˆas isï¼‰
*** Promise.allSettled()åŠå…¶polyfill
Promise.allSettled ç­‰å¾…æ‰€æœ‰çš„ promise éƒ½è¢« settleï¼Œæ— è®ºç»“æœå¦‚ä½•ã€‚ç»“æœæ•°ç»„å…·æœ‰ï¼š

{status:"fulfilled", value:result} å¯¹äºæˆåŠŸçš„å“åº”ï¼Œ
{status:"rejected", reason:error} å¯¹äº errorã€‚

#+begin_src js
let urls = [
  'https://api.github.com/users/iliakan',
  'https://api.github.com/users/remy',
  'https://no-such-url'
];

Promise.allSettled(urls.map(url => fetch(url)))
  .then(results => { // (*)
    results.forEach((result, num) => {
      if (result.status == "fulfilled") {
        alert(`${urls[num]}: ${result.value.status}`);
      }
      if (result.status == "rejected") {
        alert(`${urls[num]}: ${result.reason}`);
      }
    });
  });
#+end_src
!!!Promise.allSettled() polyfill
å› ä¸ºè¿™ä¸ªæ–¹æ³•æ˜¯æ–°åŠ å…¥çš„ç‰¹æ€§ï¼Œä¸è¢«æ‰€æœ‰ç¯å¢ƒæ”¯æŒï¼Œå¦‚æœæ²¡æœ‰è¿™ä¸ªæ–¹æ³•ï¼Œå¯ä»¥polyfillä¸€ä¸ªï¼š
#+begin_src js
  //è¿™æ˜¯æˆ‘çš„ä»£ç 
  if (!Promise.allSettled) {
    Promise.allSettled = function(promises) {
      return Promise.all(promises.map(promise => promise.then(
        value => ({
          status: "fulfilled",
          value
        }),
        reason => ({
          status: "rejected",
          reason
        }))));
    };
  }
  //è¿™é‡Œæ˜¯æ•™æçš„ä»£ç 
  if(!Promise.allSettled) {
    Promise.allSettled = function(promises) {
      return Promise.all(promises.map(p => Promise.resolve(p).then(value => ({
        state: 'fulfilled',
        value
      }), reason => ({
        state: 'rejected',
        reason
      }))));
    };
  }
//!!!p => Promise.resolve(p) å°†è¾“å…¥å€¼è½¬æ¢ä¸º promiseï¼ˆä»¥é˜²ä¼ é€’äº† non-promise)ï¼Œè¿™ä¸€ç‚¹å¾ˆé‡è¦ï¼Œå› ä¸ºPromise.all/Promise.allSettledæ”¯æŒæ•°ç»„ä¸­æœ‰épromiseçš„å…ƒç´ ã€‚
#+end_src
** Promise.race([...promise...])
- æ‰§è¡Œæ•°ç»„ä¸­æ‰€æœ‰çš„promiseï¼Œåªè¦æœ‰ä¸€ä¸ªå®Œæˆäº†ï¼Œæ‰€æœ‰è¿›ä¸€æ­¥çš„ result/error éƒ½ä¼šè¢«å¿½ç•¥ã€‚
- resolveå€¼æ˜¯ä¸€ä¸ªå€¼ï¼Œä¸æ˜¯æ•°ç»„
** Promise.resolve(value) ç”¨ç»“æœ value åˆ›å»ºä¸€ä¸ª resolved çš„ promiseã€‚ 
#+begin_src js
//ç­‰åŒäºï¼š
let promise = new Promise(resolve => resolve(value));
#+end_src
* å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼ˆmicrotask queueï¼‰
#+begin_src js
  let promise = Promise.reject(new Error("Promise Failed!"));
  setTimeout(() => promise.catch(err => alert('caught')), 1000);

  // Error: Promise Failed!
  window.addEventListener('unhandledrejection', event => alert(event.reason));

  //æ”¹æ­£ï¼šè®©é”™è¯¯å¤„ç†åœ¨1000msåå¼€å§‹æ‰§è¡Œ
  let promise = Promise.reject(new Error("Promise Failed!"));
  promise.catch(err => new Promise((resolve,reject) => setTimeout(() => {
    alert('caught');
    resolve();
  }, 1000)));
  window.addEventListener('unhandledrejection', event => alert(event.reason));

  //å¦‚æœæ²¡æœ‰åœ¨catchä¸­returnä¸€ä¸ªnew Promiseï¼š
  let promise = Promise.reject(new Error("Promise Failed!"));
  promise.catch(err => setTimeout(() => {
    alert('caught');
  }, 1000));
  window.addEventListener('unhandledrejection', event => alert(event.reason));

  //ä¹Ÿæ˜¯å·¥ä½œçš„ï¼Œå› ä¸ºcatchåœ¨promiseä¹‹åå°±è¢«æ”¾è¿›äº†å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œè™½ç„¶setTimeoutä»£ç å¤„ç†å‘ç”Ÿåœ¨catchç»“æŸä¹‹åï¼Œä½†æ˜¯catchç»“æŸååªè¦æ²¡æœ‰rethrowï¼Œå°±è¿”å›äº†ä¸€ä¸ªresolveçŠ¶æ€çš„promiseï¼Œå› ä¸ºä¸ä¼šè§¦å‘'unhandledrejection'
#+end_src
!!!unhandledrejectionï¼šå¼•æ“ä¼šæ£€æŸ¥ promiseï¼Œå¦‚æœ promise ä¸­çš„ä»»æ„ä¸€ä¸ªå‡ºç° â€œrejectedâ€ çŠ¶æ€ï¼Œunhandledrejection äº‹ä»¶å°±ä¼šè¢«è§¦å‘ã€‚
* Promisification
** å®šä¹‰ä¸€ä¸ªåŒå‚å›è°ƒçš„promisify
** å®šä¹‰ä¸€ä¸ªå¤šå‚å›è°ƒçš„promisify
* generatorè¿”å›ä¸€ä¸ªå…·æœ‰.next()æ–¹æ³•çš„å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡æ˜¯iterableçš„
è¯­æ³•ï¼š
#+begin_src js
function* generatorFunc(...arg) {
  yield value;
  yield value;
}
#+end_src
** nextæ–¹æ³•äº§ç”Ÿä¸€ä¸ªå¯¹è±¡ï¼Œå…·æœ‰å¦‚ä¸‹æ ¼å¼ï¼š
{done:true, value: "value"}
{done:false, value: "value"}
** å¦‚æœä¸€ä¸ªå€¼æ˜¯ç”±returnï¼ˆè€Œä¸æ˜¯yieldï¼‰äº§ç”Ÿçš„ï¼Œè¿™ä¸ªå€¼çš„doneå±æ€§å°±æ˜¯trueï¼Œåä¹‹false
** generatorå¯¹è±¡è¿­ä»£çš„æ—¶å€™ï¼Œdone:falseå±æ€§å¯¹åº”çš„valueä¼šè¢«å¿½ç•¥
* Generator ç»„åˆï¼ˆcompositionï¼‰æ˜¯å°†ä¸€ä¸ª generator æµæ’å…¥åˆ°å¦ä¸€ä¸ª generator æµçš„è‡ªç„¶çš„æ–¹å¼ã€‚å®ƒä¸éœ€è¦ä½¿ç”¨é¢å¤–çš„å†…å­˜æ¥å­˜å‚¨ä¸­é—´ç»“æœã€‚
ä¸‹é¢çš„ä»£ç å®šä¹‰äº†ä¸¤ä¸ªgeneratorï¼Œç¬¬ä¸€ä¸ªæ˜¯äº§ç”Ÿæ•°å­—åºåˆ—çš„
ç¬¬äºŒä¸ªgeneratoræ ¹æ®æ•°å­—åºåˆ—äº§ç”Ÿstring

å¯ä»¥è§‚å¯Ÿåˆ°æœ‰ä¸‰ä¸ªforå¾ªç¯ï¼Œäº§ç”Ÿä¸åŒåŒºé—´çš„æ•°å­—
è¿™ä¸‰ä¸ªforå¾ªç¯æ¯ä¸ªéƒ½æ˜¯å¯ä»¥ç”¨å¦ä¸€generatoräº§ç”Ÿçš„

generatorç»„åˆçš„è¯­æ³•æ˜¯ï¼š
~yield* generator;~
#+begin_src js
function* generateSequence(start, end) {
  for (let i = start; i <= end; i++) yield i;
}

function* generateAlphaNum() {

  // yield* generateSequence(48, 57);
  for (let i = 48; i <= 57; i++) yield i;

  // yield* generateSequence(65, 90);
  for (let i = 65; i <= 90; i++) yield i;

  // yield* generateSequence(97, 122);
  for (let i = 97; i <= 122; i++) yield i;

}

let str = '';

for(let code of generateAlphaNum()) {
  str += String.fromCharCode(code);
}

alert(str); // 0..9A..Za..z
#+end_src
* yieldæ˜¯åŒå‘çš„
#+begin_src js
  function* generateWithTag(from, to) {
    for (let i = from; i <= to; i++) {
      let tag = yield i;                      //(1)
      console.log(`${tag} [now i = ${i}]`);   //(2)
    }
  }

  let generator = generateWithTag(1, 5);
  generator.next("init generator, i shall be 1");            //r1
  generator.next("first call, shall follow with 2").value;   //r2
  generator.next("second call, shall follow with 3").value;  //r3
  generator.next("third call, shall follow with 4").value;   //r4
  generator.next("fourth call, shall follow with 5").value;  //r5
  generator.next("fifth call, shall follow with true").done; //r6
#+end_src
ä»£ç è¿è¡Œåˆ†æï¼š
å…±è°ƒç”¨äº†å…­æ¬¡nextã€‚
r1: 1- yield 1 åœåœ¨ï¼ˆ1ï¼‰ç­‰å¾…ç»™tagå€¼ï¼›
    2- è¿”å›ç»“æœ1
    æ­¤æ—¶i=1;
r2: 1- ç»™tagå€¼ first call
    2- æ‰§è¡Œconsole.logï¼Œè¿™é‡Œè¾“å‡ºçš„æ˜¯firstcallï¼Œä½†iæ²¡å˜ï¼Œè¿˜æ˜¯1
    3- ç¬¬ä¸€ä¸ªå¾ªç¯ç»“æŸï¼Œi=2;
    4- yield 2ï¼Œåœåœ¨ï¼ˆ1ï¼‰ç­‰å¾…ç»™tagå€¼ï¼›
...
r6

å¯ä»¥çœ‹åˆ°ä¸€ä¸ªé—®é¢˜ï¼šé¦–æ¬¡å¾ªç¯ä¸­yieldä¸‹é¢çš„å†…å®¹æ˜¯åœ¨ç¬¬äºŒæ¬¡yieldæ—¶æ‰§è¡Œçš„
ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯æ¬¡å¾ªç¯ä¸­çš„å…¶å®ƒä»£ç æ˜¯åœ¨å…¶åä¸€æ¬¡nextä¸­æ‰§è¡Œçš„

å¦‚æœæˆ‘ä»¬æŠŠyieldèµ‹å€¼çš„ç­‰å·çœ‹æˆä¸€ä¸ªåˆ†ç•Œçº¿ï¼š
let [1.ä¸‹æ¬¡nextèµ‹å€¼] = yield [2.æœ¬æ¬¡çš„ç»“æœ]ï¼›
3.å…¶å®ƒä»£ç 1
4.å…¶å®ƒä»£ç 2

æ‰§è¡Œçš„é¡ºåºæ˜¯2134

* generator.throw()
#+begin_src js
function* gen() {
  try {
    let result = yield "2 + 2 = ?"; // (1)

    alert("The execution does not reach here, because the exception is thrown above");
  } catch(e) {
    alert(e); // æ˜¾ç¤ºè¿™ä¸ª error
  }
}

let generator = gen();

let question = generator.next().value;

generator.throw(new Error("The answer is not found in my database")); // (2)
#+end_src

ä¸Šé¢çš„errorè¢«æŠ›åˆ°ï¼ˆ1ï¼‰è¡Œçš„yieldï¼Œç„¶åè¢«ä¸‹é¢çš„catchæ¥ä½ã€‚å¦‚æœæ²¡æœ‰æ¥ä½ï¼Œï¼ˆ2ï¼‰è¡Œä½œä¸ºè°ƒç”¨ä»£ç å°±ä¼šå‡ºç°å¼‚å¸¸ï¼ˆgeneratorä¸­çš„erroræ‰å‡ºåˆ°è°ƒç”¨ä»£ç ä¸­ï¼‰ã€‚

å¦‚æœerroræ‰å‡ºï¼Œå¯ä»¥åœ¨æ‰å‡ºä»£ç ä¸­å¤„ç†ï¼š

#+begin_src js
function* generate() {
  let result = yield "2 + 2 = ?"; // è¿™è¡Œå‡ºç° error
}

let generator = generate();

let question = generator.next().value;

try {
  generator.throw(new Error("The answer is not found in my database"));
} catch(e) {
  alert(e); // æ˜¾ç¤ºè¿™ä¸ª error
}
#+end_src

å¦‚æœæ‰å‡ºçš„erroræ²¡æœ‰è¢«æ¥ä½ï¼ˆæ²¡æœ‰å¾—åˆ°å¤„ç†ï¼‰ï¼Œä¼šæ€æ­»è„šæœ¬
* å¼‚æ­¥è¿­ä»£
åŒæ­¥è¿­ä»£å’Œå¼‚æ­¥è¿­ä»£çš„å¼‚åŒï¼š
|                   | Iterator        | Async Iterator       |
|-------------------+-----------------+----------------------|
| iterator method   | Symbol.iterator | Symbol.asyncIterator |
| return or next()  | any             | Promise              |
| ~for loop~ operator | for...of        | for await...of       |

ä¾‹å­ï¼š
#+begin_src js
let range = {
  from: 1,
  to: 5,

  // åœ¨åˆšä½¿ç”¨ for await..of å¾ªç¯æ—¶ï¼Œfor await..of å°±ä¼šè°ƒç”¨ä¸€æ¬¡è¿™ä¸ªæ–¹æ³•
  [Symbol.asyncIterator]() { // (1)
    // ...å®ƒè¿”å› iterator objectï¼š
    // åç»­çš„æ“ä½œä¸­ï¼Œfor await..of å°†åªé’ˆå¯¹è¿™ä¸ªå¯¹è±¡
    // å¹¶ä½¿ç”¨ next() å‘å®ƒè¯·æ±‚ä¸‹ä¸€ä¸ªå€¼
    return {
      current: this.from,
      last: this.to,

      // for await..of å¾ªç¯åœ¨æ¯æ¬¡è¿­ä»£æ—¶éƒ½ä¼šè°ƒç”¨ next()
      async next() { // (2)
        // å®ƒåº”è¯¥ä»¥å¯¹è±¡ {done:.., value :...} çš„å½¢å¼è¿”å›å€¼
        // (ä¼šè¢« async è‡ªåŠ¨åŒ…è£…æˆä¸€ä¸ª promise)

        // å¯ä»¥åœ¨å†…éƒ¨ä½¿ç”¨ awaitï¼Œæ‰§è¡Œå¼‚æ­¥ä»»åŠ¡ï¼š
        await new Promise(resolve => setTimeout(resolve, 1000)); // (3)

        if (this.current <= this.last) {
          return { done: false, value: this.current++ };
        } else {
          return { done: true };
        }
      }
    };
  }
};

(async () => {

  for await (let value of range) { // (4)
    alert(value); // 1,2,3,4,5
  }

})()
#+end_src
** !!!spreadè¯­æ³•æ— æ³•å¼‚æ­¥å·¥ä½œ
~alert([...range]);~ //Error, no Symbol.iterator
å› ä¸ºspreadè¯­æ³•éœ€è¦Symbol.iteratorï¼Œä½†æ˜¯ä¸Šé¢ä¾‹å­å®šä¹‰çš„rangeåªæœ‰Symbol.asyncIterator
** !!!async generator
è¯­æ³•ï¼š
1. async function* generateSequence(start, end) {}
2. async generatorå®šä¹‰å‡½æ•°å†…éƒ¨å¯ä»¥ä½¿ç”¨awaitï¼›
3. éå†async generatoræ—¶ï¼Œä½¿ç”¨ ~for await...of~ ç»“æ„
4. !!!async generatorçš„nextæ–¹æ³•è¿”å›çš„æ˜¯promiseï¼Œæ„å‘³ç€è°ƒç”¨ ~await asyncGenerator.next()~ æ—¶ï¼Œå‰é¢è¦åŠ  ~await~ å…³é”®å­—ï¼ˆæˆ–è€…ä¹Ÿå¯ä»¥ç”¨thenï¼‰
** !!!async iterable
*** åŒæ­¥/å¼‚æ­¥ iterable çš„generatorå®šä¹‰
1. æ™®é€šgeneratorå®šä¹‰å¯è¿­ä»£å¯¹è±¡çš„Symbol.iterator
æ³¨æ„[Symbol.iterator]å‰é¢çš„æ˜Ÿå·
#+begin_src js
let range = {
  from: 1,
  to: 5,

  *[Symbol.iterator]() { // [Symbol.iterator]: function*() çš„ç®€å†™å½¢å¼
    for(let value = this.from; value <= this.to; value++) {
      yield value;
    }
  }
};

for(let value of range) {
  alert(value); // 1ï¼Œç„¶å 2ï¼Œç„¶å 3ï¼Œç„¶å 4ï¼Œç„¶å 5
#+end_src
2. å¼‚æ­¥ï¼ˆasyncï¼‰generatorå®šä¹‰å¯è¿­ä»£å¯¹è±¡
é¦–å…ˆä½¿ç”¨Symbol.asyncIterator
å…¶æ¬¡æ³¨æ„Symbol.asyncIteratorå‰é¢çš„æ˜Ÿå·
!!!æ˜Ÿå·ä»£è¡¨æ˜¯ä¸€ä¸ªgeneratorï¼ŒasyncIteratorä»£è¡¨æ˜¯ä¸€ä¸ªå¼‚æ­¥è¿­ä»£å™¨æ–¹æ³•
#+begin_src js
let range = {
  from: 1,
  to: 5,

  async *[Symbol.asyncIterator]() { // ç­‰ä»·äº [Symbol.asyncIterator]: async function*()
    for(let value = this.from; value <= this.to; value++) {

      // åœ¨ value ä¹‹é—´æš‚åœä¸€ä¼šå„¿ï¼Œç­‰å¾…ä¸€äº›ä¸œè¥¿
      await new Promise(resolve => setTimeout(resolve, 1000));

      yield value;
    }
  }
};

(async () => {

  for await (let value of range) {
    alert(value); // 1ï¼Œç„¶å 2ï¼Œç„¶å 3ï¼Œç„¶å 4ï¼Œç„¶å 5
  }

})();
#+end_src
** æ€»ç»“å¼‚æ­¥è¿­ä»£
è¿­ä»£æœ‰iterableå¯¹è¥¿é‚£ä¸ªå’Œgeneratorä¸¤ç§
* iterableå’Œasync iterable
|                        | iterable                     | async iterable                                 |
|------------------------+------------------------------+------------------------------------------------|
| æä¾›iteratorçš„å¯¹è±¡æ–¹æ³• | Symbol.iterator              | Symbol.asyncIterator                           |
| next() çš„è¿”æ²ªå€¼        | {value:..., done:true/false} | resolveæˆ{value:..., done:true/false}çš„promise |

* generatorå’Œasync generator
|                | generator                    | async generator                                |
|----------------+------------------------------+------------------------------------------------|
| å£°æ˜æ–¹å¼       | function*                    | async function*                                |
| next()çš„è¿”å›å€¼ | {value:..., done:true/false} | resolveæˆ{value:..., done:true/false}çš„promise |

